this.ckan.module("autocomplete",function(b,a){return{options:{tags:false,key:false,label:false,items:10,source:null,interval:1000,dropdownClass:"",containerClass:"",i18n:{noMatches:a("No matches found"),emptySearch:a("Start typingâ€¦"),inputTooShort:function(c){return a("Input is too short, must be at least one character").ifPlural(c.min,"Input is too short, must be at least %(min)d characters")}}},initialize:function(){b.proxyAll(this,/_on/,/format/);this.setupAutoComplete()},setupAutoComplete:function(){var d={width:"resolve",formatResult:this.formatResult,formatNoMatches:this.formatNoMatches,formatInputTooShort:this.formatInputTooShort,dropdownCssClass:this.options.dropdownClass,containerCssClass:this.options.containerClass};if(!this.el.is("select")){if(this.options.tags){d.tags=this._onQuery}else{d.query=this._onQuery;d.createSearchChoice=this.formatTerm}d.initSelection=this.formatInitialValue}var c=this.el.select2(d).data("select2");if(this.options.tags&&c&&c.search){c.search.on("keydown",this._onKeydown)}$(".select2-choice",c.container).on("click",function(){return false})},getCompletions:function(f,g){var i=this.options.source.split("?");var d=i.pop();var h=i.join("?")+encodeURIComponent(f)+d;var c=this.sandbox.client;var e={format:function(k){var j=b.extend(e,{objects:true});return{results:c.parseCompletions(k,j)}},key:this.options.key,label:this.options.label};return c.getCompletions(h,e,g)},lookup:function(c,e){var d=this;this._lastTerm=c;if(c){if(!this._debounced){this._debounced=setTimeout(function(){var f=d._lastTerm;delete d._debounced;if(d._last){d._last.abort()}d._last=d.getCompletions(f,function(g){e(d._lastResults=g)})},this.options.interval)}else{e(this._lastResults||{results:[]})}}else{e({results:[]})}},formatResult:function(f,c,e){var d=this._lastTerm||null;if(c){c.attr("data-value",f.id)}return f.text.split(d).join(d&&d.bold())},formatNoMatches:function(c){return !c?this.i18n("emptySearch"):this.i18n("noMatches")},formatInputTooShort:function(d,c){return this.i18n("inputTooShort",{min:c})},formatTerm:function(c){c=b.trim(c||"");return{id:c.replace(/,/g,"\u002C"),text:c}},formatInitialValue:function(c,f){var e=b.trim(c.val()||"");var d;if(this.options.tags){d=b.map(e.split(","),this.formatTerm)}else{d=this.formatTerm(e)}if(typeof f==="function"){f(d)}return d},_onQuery:function(c){if(c){this.lookup(c.term,c.callback)}},_onKeydown:function(c){if(c.which===188){c.preventDefault();setTimeout(function(){var d=b.Event("keydown",{which:13});b(c.target).trigger(d)},10)}}}});