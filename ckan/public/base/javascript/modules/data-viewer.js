this.ckan.module("data-viewer",function(a){return{options:{timeout:200,minHeight:400,padding:30},initialize:function(){a.proxyAll(this,/_on/);this.el.on("load",this._onLoad);this._FirefoxFix();this.sandbox.subscribe("data-viewer-error",this._onDataViewerError)},_onDataViewerError:function(c){var b=this.el.parent();$(".data-viewer-error .collapse",b).html(c);$(".data-viewer-error",b).removeClass("js-hide");this.el.hide()},_onLoad:function(){var b=this;var c=$("body").data("site-root");if(this.el.attr("src").substring(0,c.length)===c){this._recalibrate();setInterval(function(){b._recalibrate()},this.options.timeout)}else{this.el.css("height",600)}},_recalibrate:function(){var b=this.el.contents().find("body").outerHeight(true);b=Math.max(b,this.options.minHeight);this.el.css("height",b+this.options.padding)},_FirefoxFix:function(){if(/#$/.test(this.el.src)){this.el.src=this.el.src.substr(0,this.src.length-1)}else{this.el.src=this.el.src+"#"}}}});