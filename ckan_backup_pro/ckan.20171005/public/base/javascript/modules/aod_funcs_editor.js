var alreadyCreatedResource=new Array();var errorCreating="";function initializeDashboard(){var c=3;for(var g=0;g<c;g++){$("#dashboardZone"+g).attr("onclick",'activateDashboardZone("'+g+'");')}var d=8;for(var g=0;g<d;g++){$("#editorZone"+g).attr("onclick",'activateEditorZone("'+g+'");')}var b={disable_search:true};if($("#extras__1100__value")){$("#extras__1100__value").chosen(b)}if($("#groups__0__id")){$("#groups__0__id").chosen(b)}var a=function f(){var m=this[this.selectedIndex].value;var i=this.id.substr("resType".length);if(m=="vista"){toggleZoneResource(this.attributes.id.value,"vista")}else{if(m=="file.upload"){toggleZoneResource(this.attributes.id.value,"file.upload");$("#jfilestyle-"+i).trigger("click")}else{toggleZoneResource(this.attributes.id.value,"file")}}return false};if(typeof resourceCount!="undefined"){for(var k=0;k<resourceCount;k++){if($("#resType"+k)){$("#resType"+k).chosen(b).change(a)}}for(var k=resourceCount;k<(resourceCount+10);k++){if($("#resType"+k)){$("#resType"+k).chosen(b).change(a)}}for(var k=resourceCount;k<=(resourceCount+MAX_URL_LIST);k++){alreadyCreatedResource[k]=false}}if(typeof availableOrganizations!="undefined"){var h=function e(){for(var m=0;m<availableOrganizations;m++){$("#organization"+m+"_org").addClass("oculto")}$("#organization"+(this.selectedIndex+1)+"_org").removeClass("oculto");return false};$("#owner_org").chosen(b).change(h)}$("#textQueryOrgDataset").keypress(function(i){if(i.keyCode==13){submitTxtQueryOrg()}});var l=window.location.toString();var j="";urlListParamPrev=l.split("?");if(urlListParamPrev[0].indexOf("/catalogo/pizarra/info-organizacion")!=-1){activateDashboardZone(0)}if(urlListParamPrev[0].indexOf("/catalogo/pizarra/datos")!=-1){activateDashboardZone(1)}if(urlListParamPrev[0].indexOf("/catalogo/pizarra/actividad")!=-1){activateDashboardZone(2)}}var currentOptionDashboardZone=2;function activateDashboardZone(a){if(a!=currentOptionDashboardZone){$("#dashboardZone"+currentOptionDashboardZone).removeClass("blockDashboardSelected");$("#dashboardZone"+currentOptionDashboardZone).addClass("blockDashboard");$("#dashboardZonePage"+currentOptionDashboardZone).fadeOut();currentOptionDashboardZone=a;$("#dashboardZone"+currentOptionDashboardZone).removeClass("blockDashboard");$("#dashboardZone"+currentOptionDashboardZone).addClass("blockDashboardSelected");$("#dashboardZonePage"+currentOptionDashboardZone).fadeIn()}}function toggleZoneResource(b,a){$("#vistaDiv_"+b).addClass("oculto");if(a=="vista"){$("#datos_"+b).addClass("oculto");$("#uploadFile_"+b).addClass("oculto");$("#vista_"+b).removeClass("oculto");resetSelect(b)}else{if(a=="file.upload"){$("#datos_"+b).addClass("oculto");$("#uploadFile_"+b).removeClass("oculto");$("#vista_"+b).addClass("oculto");resetSelect(b)}else{$("#datos_"+b).removeClass("oculto");$("#uploadFile_"+b).addClass("oculto");$("#vista_"+b).addClass("oculto");resetSelect(b)}}}var currentOptionEditorZone=0;function activateEditorZone(a){if(a!=currentOptionEditorZone){$("#editorZone"+currentOptionEditorZone).removeClass("blockEditorSelected");$("#editorZone"+currentOptionEditorZone).addClass("blockEditor");$("#editorZonePage"+currentOptionEditorZone).fadeOut();currentOptionEditorZone=a;$("#editorZone"+currentOptionEditorZone).removeClass("blockEditor");$("#editorZone"+currentOptionEditorZone).addClass("blockEditorSelected");$("#editorZonePage"+currentOptionEditorZone).fadeIn()}}function initializeEditor(){if(document.getElementById("autocomplete_eurovoc")){var a=function(){if(window.confirm("Está a punto de salir del editor. Si no ha guardado los cambios realizados, se perderán. Confirme que realmente desea salir.")){return true}else{return false}};$("#tab_organizacion").click(a);$("#tab_datos").click(a);$("#tab_actividad").click(a);$(".tips").powerTip({followMouse:true});initializeAutocompletes();$("#extras__3099__value").on("input",function(b){if($("#extras__3099__value").val()!=""){$("#extras__3098__value").prop("checked",true)}})}}function activateFileUploadForm(){$(".jfilestyle").each(function(){var b=$(this),a={buttonText:b.attr("data-buttonText"),input:b.attr("data-input")==="false"?false:true,icon:b.attr("data-icon")==="false"?false:true,size:b.attr("data-size"),iconName:b.attr("data-iconName"),theme:b.attr("data-theme")};b.jfilestyle(a)})}function initializeAutocompletes(){var e={"á":"a","é":"e","í":"i","ó":"o","ú":"u","Á":"A","É":"E","Í":"I","Ó":"O","Ú":"U","ü":"u"};var b=function(j){var g="";for(var h=0;h<j.length;h++){g+=e[j.charAt(h)]||j.charAt(h)}return g};$("#autocomplete_eurovoc").keypress(function(g){if(g.keyCode==13){addTag()}});$("#autocomplete_eurovoc").autocomplete({source:function(i,h){var g="/eurovoc_autocomplete?start=0&rows=1000&wt=json&q=search_text_es:"+$("#autocomplete_eurovoc").val()+"*";$.ajax({dataType:"json",url:g}).done(function(k){var j=new Array();$.each(k.response.docs,function(l,m){j.push({id:m.term,label:m.term,value:m.term})});return h(j)})}}).data("ui-autocomplete")._renderItem=function(g,h){return $("<li>").append("<a>"+h.label+"</a>").appendTo(g)};$("input:radio[name=typeSpatial]").change(function(g){$("#spatial_provincia").val("");$("#spatial_comarca").val("");$("#spatial_municipio").val("");$("#spatial_otro").val("")});$("#spatial_provincia").keypress(function(g){$("input:radio[name=typeSpatial]")[1].checked=true});$("#spatial_provincia").autocomplete({source:function(h,g){var i=new RegExp($.ui.autocomplete.escapeRegex(h.term),"i");g($.grep(prov,function(j){j=j.label||j.value||j;return i.test(j)||i.test(b(j))}))},change:function(h,i){var g=false;if(!i.item){var j=new RegExp("^"+$.ui.autocomplete.escapeRegex($(this).val())+"$","i");for(value in prov){if(j.test(prov[value])){g=true;$(this).val(prov[value]);break}}if(!g){$(this).val("");return false}}}}).data("ui-autocomplete")._renderItem=function(g,h){return $("<li>").append("<a>"+h.label+"</a>").appendTo(g)};$("#spatial_comarca").keypress(function(g){$("input:radio[name=typeSpatial]")[2].checked=true});$("#spatial_comarca").autocomplete({source:function(h,g){var i=new RegExp($.ui.autocomplete.escapeRegex(h.term),"i");g($.grep(comarca,function(j){j=j.label||j.value||j;return i.test(j)||i.test(b(j))}).slice(0,10))},change:function(h,i){var g=false;if(!i.item){var j=new RegExp("^"+$.ui.autocomplete.escapeRegex($(this).val())+"$","i");for(value in comarca){if(j.test(comarca[value])){g=true;$(this).val(comarca[value]);break}}if(!g){$(this).val("");return false}}}}).data("ui-autocomplete")._renderItem=function(g,h){return $("<li>").append("<a>"+h.label+"</a>").appendTo(g)};$("#spatial_municipio").keypress(function(g){$("input:radio[name=typeSpatial]")[3].checked=true});$("#spatial_municipio").autocomplete({source:function(h,g){var i=new RegExp($.ui.autocomplete.escapeRegex(h.term),"i");g($.grep(munis,function(j){j=j.label||j.value||j;return i.test(j)||i.test(b(j))}).slice(0,10))},change:function(h,i){var g=false;if(!i.item){var j=new RegExp("^"+$.ui.autocomplete.escapeRegex($(this).val())+"$","i");for(value in munis){if(j.test(munis[value])){g=true;$(this).val(munis[value]);break}}if(!g){$(this).val("");return false}}}}).data("ui-autocomplete")._renderItem=function(g,h){return $("<li>").append("<a>"+h.label+"</a>").appendTo(g)};$("#spatial_otro").keypress(function(g){$("input:radio[name=typeSpatial]")[4].checked=true});var d=["extras__4010","extras__4020"];for(var f in d){for(var a=0;a<MAX_URL_LIST;a++){$("#"+d[f]+a+"__value").keypress(function(g){if(g.keyCode==13){addURL_keypress(this.id)}})}}var c={disable_search:false,default_single_text:"Hola"};for(var a=0;a<(resourceCount+10);a++){if($("#mimetypeSelect"+a)){$("#mimetypeSelect"+a).chosen(c).default_single_text="Hola"}if($("#mimetype_innerSelect"+a)){$("#mimetype_innerSelect"+a).chosen(c).default_single_text="Hola"}}}function checkMetadataEditor(){var a=false;errorCreating="Problemas creando el conjunto de datos.";if(!checkMandatoryFields()){a=true}if(!checkSpatial()){a=true}if(!checkTemporal("TemporalFrom","extras__1101__value","inicial")){a=true}if(!checkTemporal("TemporalUntil","extras__1102__value","final")){a=true}if(!a){disEnableTemporalItems(true);return true}else{alert(errorCreating)}return false}function hideBlankElements(){var c=["extras__4000","extras__4001","extras__4002"];for(var d in b){if($("#"+b[d]+"__value").val()==""){$("#"+b[d]+"__block").addClass("oculto")}}var b=["extras__4010","extras__4020"];for(var d in b){for(var a=0;a<MAX_URL_LIST;a++){if($("#"+b[d]+a+"__value").val()==""){$("#"+b[d]+a+"__block").addClass("oculto")}}}}function addTag(){if($("#autocomplete_eurovoc").val()!=""){var a="";if($("#field-tags").val()!=""){a=$("#field-tags").val()+","}$("#field-tags").val(a+$("#autocomplete_eurovoc").val());$("#field-tags").trigger("change");$("#autocomplete_eurovoc").val("")}}function checkTemporal(d,a,h){var c="";var e=$("#"+d+"_year").val();var i=$("#"+d+"_month").val();var k=$("#"+d+"_day").val();var b=$("#"+d+"_hour").val();var f=$("#"+d+"_min").val();var g=$("#"+d+"_sec").val();if(i.length==1){i="0"+i}if(k.length==1){k="0"+k}if(b.length==1){b="0"+b}if(f.length==1){f="0"+f}if(g.length==1){g="0"+g}if(e!=""){c=e;if(i!=""){c+="-"+i;if(k!=""){c+="-"+k;if(b!=""){c+="T"+b;if(f!=""){c+=":"+f;if(g!=""){c+=":"+g}}}}}}if(c!=""){if(moment(c).isValid()){if(c.indexOf("T")!=-1){var j=new Date(c).getTimezoneOffset();if(j==0){c=c+"Z"}else{if(j<0){c=c+"+0"+Math.abs(j/60)+":00"}else{c=c+"-0"+Math.abs(j/60)+":00"}}}$("#"+a).val(c);return true}else{errorCreating+="La fecha "+h+" no es válida. ";return false}}else{$("#"+a).val(c);return true}}function disEnableTemporalItems(a){$("input:radio[name=typeSpatial]").attr("disabled",a);disEnableTemporal("TemporalFrom","extras__1101__value",a);disEnableTemporal("TemporalUntil","extras__1102__value",a)}function disEnableTemporal(c,a,b){$("#"+c+"_day").attr("disabled",b);$("#"+c+"_month").attr("disabled",b);$("#"+c+"_year").attr("disabled",b);$("#"+c+"_hour").attr("disabled",b);$("#"+c+"_min").attr("disabled",b);$("#"+c+"_sec").attr("disabled",b);$("#"+a).attr("disabled",!b)}function checkSpatial(){var b=$("input:radio[name=typeSpatial]:checked").val();if(b=="Aragón"){$("#extras__2000__value").val(b);$("#extras__2001__value").val("Aragón");$("#extras__2002__value").val("http://opendata.aragon.es/recurso/territorio/ComunidadAutonoma/Aragón");$("#extras__2003__value").val("Aragón")}else{if(b=="Provincia"){var a=$("#spatial_provincia").val();if(a!=""){$("#extras__2000__value").val(b);$("#extras__2001__value").val(a);$("#extras__2002__value").val("http://opendata.aragon.es/recurso/territorio/Provincia/"+a);$("#extras__2003__value").val(a)}else{errorCreating+='Incluya un valor válido de provincia en "Cobertura geográfica". ';return false}}else{if(b=="Comarca"){var a=$("#spatial_comarca").val();if(a!=""){if(aragopCom[a]){$("#extras__2000__value").val(b);$("#extras__2001__value").val(a);$("#extras__2002__value").val("http://opendata.aragon.es/recurso/territorio/Comarca/"+aragopCom[a]);$("#extras__2003__value").val(aragopCom[a])}else{errorCreating+='Incluya un valor válido de comarca en "Cobertura geográfica". ';return false}}else{errorCreating+='Incluya un valor válido de comarca en "Cobertura geográfica". ';return false}}else{if(b=="Municipio"){var a=$("#spatial_municipio").val();if(a!=""){if(aragopMun[a]){$("#extras__2000__value").val(b);$("#extras__2001__value").val(a);$("#extras__2002__value").val("http://opendata.aragon.es/recurso/territorio/Municipio/"+aragopMun[a]);$("#extras__2003__value").val(aragopMun[a])}else{errorCreating+='Incluya un valor válido de municipio en "Cobertura geográfica". ';return false}}else{errorCreating+='Incluya un valor válido de municipio en "Cobertura geográfica". ';return false}}else{if(b=="Otro"){var a=$("#spatial_otro").val();if(a!=""){$("#extras__2000__value").val(b);$("#extras__2001__value").val(a);$("#extras__2002__value").val("");$("#extras__2003__value").val(a)}else{errorCreating+='Incluya un valor para otro en "Cobertura geográfica". ';return false}}}}}}return true}var MAX_URL_LIST=9;function removeURL(d,a){var c=parseInt(a);var b=false;if(c<MAX_URL_LIST){if($("#"+d+(c+1)+"__value").val()!=""){b=true}}while(b){$("#"+d+c+"__value").val($("#"+d+(c+1)+"__value").val());c++;b=false;if(c<MAX_URL_LIST){if($("#"+d+(c+1)+"__value").val()!=""){b=true}}}$("#"+d+c+"__value").val("");if(c!=0){$("#"+d+c+"__block").addClass("oculto")}}function addURL_keypress(a){var b=parseInt(a.substr(8).substr(0,5));if((b%(MAX_URL_LIST+1))<MAX_URL_LIST){if($("#"+a.substr(0,8)+(b+1)+"__value").val()==""){$("#"+a.substr(0,8)+(b+1)+"__block").removeClass("oculto");$("#"+a.substr(0,8)+(b+1)+"__value").focus()}}}function addURL(c){var b=true;for(var a=0;a<=MAX_URL_LIST;a++){if($("#"+c+a+"__value").val()==""){$("#"+c+a+"__block").removeClass("oculto");$("#"+c+a+"__value").focus();b=false;break}}if(b){alert("No es posible incluir más valores para este campo")}}function disEnableCheckboxes(a){$(":checkbox:not(:checked)").each(function(){var b=this.id.replace(/__value/g,"__key");if("#"+b){$("#"+b).attr("disabled",a)}})}function removeExistingResource(b,a){var c=window.confirm("¿Está seguro que desea borrar el recurso?");if(c){showPleaseWait();$.ajax({async:false,type:"POST",url:b,success:function(d){alert("Recurso borrado correctamente");$("#existing_resource"+a).addClass("oculto");changedResource[a]=false;alreadyCreatedResource[a]=false;hideModalDialog()},error:function(d){alert("Problemas borrado el recurso. Envíe un email a opendata@aragon.es");hideModalDialog()}})}}function isBlankResource(a){if($("#nameRes"+a).val()==""){if($("#resType"+a)[0].selectedIndex==0){if($("#urlText_resType"+a).val()==""){return true}}else{return true}}return false}function removeNewResource(a){var c=parseInt(a);var b=false;if(c<MAX_URL_LIST){if(!isBlankResource(c+1)){b=true}}while(b){shiftResource(c);c++;b=false;if(c<MAX_URL_LIST){if(!isBlankResource(c+1)){b=true}}}clearResource(c)}function shiftResource(a){$("#nameRes"+a).val($("#nameRes"+(a+1)).val());$("#resType"+a)[0].selectedIndex=$("#resType"+(a+1))[0].selectedIndex;$("#urlText_resType"+a).val($("#urlText_resType"+(a+1)).val())}function clearResource(a){$("#new_resource"+a).addClass("oculto");$("#nameRes"+a).val("");$("#resType"+a)[0].selectedIndex=0;$("#urlText_resType"+a).val("")}function addResource(){activateFileUploadForm();var b=true;for(var a=resourceCount;a<=(resourceCount+MAX_URL_LIST);a++){if(isBlankResource(a)){$("#new_resource"+a).removeClass("oculto");b=false;break}}if(b){alert("No es posible incluir más valores para este campo")}}function changesOnResource(a){changedResource[a]=true}function correctUrl(a){var d=document.getElementById("resType"+a);var c=d[d.selectedIndex].value;if(c=="vista"){var b=document.getElementById("vistas_value_resType"+a).value;$("#vista_id_resType"+a).val(b);$("#url_resType"+a).val("http://"+document.location.host+"/catalogo/dataset/showVista?id="+b)}else{if(c=="file.upload"){$("#url_resType"+a).val($("#uploadUrl_resType"+a).val());$("#vista_id_resType"+a).attr("disabled",true);$("#uploadUrl_resType"+a).attr("disabled",true)}else{if($("#urlText_resType"+a).val()!=""){$("#url_resType"+a).val($("#urlText_resType"+a).val());$("#vista_id_resType"+a).attr("disabled",true);$("#urlText_resType"+a).attr("disabled",true)}else{return false}}}return true}function updateFormat(a){var d=document.getElementById("mimetypeSelect"+a);var b=d[d.selectedIndex].value;var e=document.getElementById("mimetype_innerSelect"+a);var c=e[e.selectedIndex].value;if(c!=""){$("#format"+a).val(e[e.selectedIndex].label)}else{$("#format"+a).val(d[d.selectedIndex].label)}}function updateResources(){for(var a=0;a<resourceCount;a++){if(changedResource[a]){var c=document.getElementById("resType"+a);var b=c[c.selectedIndex].value;if(b=="vista"){if(correctUrl(a)){updateFormat(a);var d="/catalogo/new_resource/"+$("#field-name").val();$.ajax({async:false,url:d,type:"POST",data:$("#resourceForm"+a).serialize(),success:function(e){$("#uploadUrl_resType"+a).attr("disabled",false);$("#urlText_resType"+a).attr("disabled",false);$("#resourceForm"+a)[0].action="/catalogo/"+$("#field-name").val()+"/resource_edit/"+e;$("#removeResourceButton"+a).attr("href","javascript:removeExistingResource('/catalogo/"+$("#field-name").val()+"/resource_delete/"+e+"', '"+a+"');");alreadyCreatedResource[a]=true},error:function(e){$("#uploadUrl_resType"+a).attr("disabled",false);$("#urlText_resType"+a).attr("disabled",false);alert("Problemas creando el nuevo recurso")}})}}else{if(correctUrl(a)){updateFormat(a);$.ajax({async:false,url:$("#resourceForm"+a)[0].action,type:"POST",data:$("#resourceForm"+a).serialize(),success:function(e){$("#uploadUrl_resType"+a).attr("disabled",false);$("#urlText_resType"+a).attr("disabled",false)},error:function(e){$("#uploadUrl_resType"+a).attr("disabled",false);$("#urlText_resType"+a).attr("disabled",false);alert("Problemas actualizando recurso")}})}else{alert("La URL del recurso no puede dejarse vacía")}}changedResource[a]=false}}}function createNewResources(){for(var a=resourceCount;a<=(resourceCount+MAX_URL_LIST);a++){if(changedResource[a]){if(!isBlankResource(a)){if(!alreadyCreatedResource[a]){if(correctUrl(a)){updateFormat(a);var b="/catalogo/new_resource/"+$("#field-name").val();$.ajax({async:false,url:b,type:"POST",data:$("#resourceForm"+a).serialize(),success:function(c){$("#uploadUrl_resType"+a).attr("disabled",false);$("#urlText_resType"+a).attr("disabled",false);$("#resourceForm"+a)[0].action="/catalogo/"+$("#field-name").val()+"/resource_edit/"+c;$("#removeResourceButton"+a).attr("href","javascript:removeExistingResource('/catalogo/"+$("#field-name").val()+"/resource_delete/"+c+"', '"+a+"');");alreadyCreatedResource[a]=true},error:function(c){$("#uploadUrl_resType"+a).attr("disabled",false);$("#urlText_resType"+a).attr("disabled",false);alert("Problemas creando el nuevo recurso")}})}else{alert("La URL del recurso no puede dejarse vacía")}}else{if($("#urlText_resType"+a).val()!=""){$.ajax({async:false,url:$("#resourceForm"+a)[0].action,type:"POST",data:$("#resourceForm"+a).serialize(),success:function(c){$("#uploadUrl_resType"+a).attr("disabled",false);$("#urlText_resType"+a).attr("disabled",false)},error:function(c){;$("#uploadUrl_resType"+a).attr("disabled",false);$("#urlText_resType"+a).attr("disabled",false);alert("Problemas creando el nuevo recurso")}})}else{alert("La URL del recurso no puede dejarse vacía")}}}changedResource[a]=false}}}function checkMandatoryFields(){var a=true;if($("#field-title").val()==""){errorCreating+="Es obligatorio incluir título. ";a=false}if($("#field-notes").val()==""){errorCreating+="Es obligatorio incluir descripción. ";a=false}return a}function confirmRemove(a){showModalDialog('<p class="letraGrande">¿Está seguro que desea borrar el conjunto de datos?</p><ul style="padding:10px;"><li><button onclick="javascript:removeConfirmed(\''+a+'\');">Aceptar</button><button onclick="javascript:removeCancelled();">Cancelar</button> </li></ul><p>ATENCIÓN, si presiona &quot;Aceptar&quot; el conjunto de datos se borrará y dejará de ser accesible para los usuarios.</p><p>Recuerde que el acceso a los datos públicos es un derecho que tenemos todos los ciudadanos</p>')}function removeConfirmed(a){hideModalDialog();showPleaseWait();$("#metadataEditorForm").attr("action",a);$("#metadataEditorForm").submit()}function removeCancelled(){hideModalDialog()}function sendContent(c){var d="¿Está seguro que desea actualizar el conjunto de datos y finalizar la edición?";if(c){d="¿Está seguro que desea actualizar el conjunto de datos y seguir editando?"}var b=window.confirm(d);if(b){if((resourceCount==0)&&(isBlankResource(0))){if(!window.confirm("Parece que no ha definido ficheros de datos y debería haber al menos uno. ¿Desea continuar?")){return}}if(checkMetadataEditor()){disEnableCheckboxes(true);hideBlankElements();disEnableAllItemsForm(true);if(isEditing){if(isSysAdmin){var a="Al modificar el título, cambiará la url de acceso. ¿Desea que se modifique? Si pulsa aceptar, se modificará. Si pulsa cancelar, se mantendrá la anterior";if(!window.confirm(a)){alert("Ok, mantenemos la anterior");$("#field-name").val($("#field-previous-name").val())}}else{$("#field-name").val($("#field-previous-name").val())}}showPleaseWait();$("#metadataEditorForm").attr("target","hiddenIframe");$.ajax({async:false,type:"POST",data:$("#metadataEditorForm").serialize(),success:function(e){if(c){disEnableAllItemsForm(false);disEnableCheckboxes(false);disEnableTemporalItems(false)}},error:function(e){alert("Problemas actualizando el conjunto de datos. Envíe un email a opendata@aragon.es")}});updateResources();createNewResources();if(!c){$("#metadataEditorForm").attr("action","/catalogo/"+$("#field-name").val());$("#metadataEditorForm").attr("target","_top");$("#metadataEditorForm").submit()}else{$.ajax({url:"/catalogo/api/action/package_show?id="+$("#field-name").val(),async:false,type:"POST",dataType:"json",success:function(g){document.getElementById("extrasMaxPositionZone").innerHTML="";var f=1;var e="";$.each(g.result["extras"],function(h,i){var j=i.key;if(j.indexOf("_maxPosition")!=-1){e+='<input id="extras__4040'+f+'__key" type="hidden" value="'+j+'" name="extras__4040'+f+'__key" autocomplete="off">';e+='<input id="extras__4040'+f+'__value" type="text" placeholder="" value="'+i.value+'" name="extras__4040'+f+'__value" autocomplete="off">';f++}});document.getElementById("extrasMaxPositionZone").innerHTML=e},error:function(e){alert("Problemas actualizando el conjunto de datos. Envíe un email a opendata@aragon.es")}})}hideModalDialog()}}}function showPleaseWait(){showModalDialog('<p class="letraGrande">Cargando...</p> <p class="letraGrande">Espere por favor</p><img src="/public/i/loadingAODiconWhite.gif" width="100">')}function showModalDialog(a){var b='<div style="z-index: 22222; background-color: #888888; width: 100%; height: 100%; position: fixed; top: 0px; left: 0px; opacity: 0.4;" id="modalDialogDiv"></div><div style="float:right;width:100%;top: 40%;position:fixed;z-index:22222;" id="modalDialogText">  <div style="float:left;left:50%;position:relative;width:200px"><div style="z-index: 22222; right: 50%; float: right; width: 400px; padding: 20px; opacity: 1 ! important; background-color: #73A5BD; color: rgb(255, 255, 255);">'+a+"</div>  </div></div>";$(b).appendTo("body")}function hideModalDialog(){$("#modalDialogDiv").remove();$("#modalDialogText").remove()}function loadComboboxesVistas(){if(document.getElementById("autocomplete_eurovoc")){$.ajax({url:"/catalogo/cargarVistasUsuario/",async:false,data:"user="+currentUser,dataType:"json",success:function(d){$.each(d,function(g,h){for(var f=0;f<(resourceCount+10);f++){if($("#vistas_value_resType"+f)){if(h[0]==currentViewResource[f]){$("#vistas_value_resType"+f).append('<option value="'+h[0]+'" selected>'+h[1]+"</option>")}else{$("#vistas_value_resType"+f).append('<option value="'+h[0]+'">'+h[1]+"</option>")}}}});var b={disable_search:true};var e=function c(){};for(var a=0;a<resourceCount;a++){if($("#vistas_value_resType"+a)){$("#vistas_value_resType"+a).chosen(b).change(e)}}for(var a=resourceCount;a<(resourceCount+10);a++){if($("#vistas_value_resType"+a)){$("#vistas_value_resType"+a).chosen(b).change(e)}}},error:function(a,c,b){alert("No se ha podido obtener la lista de vistas a bases de datos")}})}}function resetSelect(c){try{var b=document.getElementById("vistas_value_"+c);b.selectedIndex=-1;b.value=-1;limpiarPantalla(c)}catch(a){}}function limpiarPantalla(b){try{document.getElementById("filtro_"+b).value="";document.getElementById("botonesDiv_"+b).innerHTML="";document.getElementById("vistaDiv_"+b).innerHTML=""}catch(a){}}function cargarVista(f,h){var a=document.getElementById("vistaDiv_"+h);var e=document.getElementById("botonesDiv_"+h);var d=this;var c=document.getElementById("vistas_value_"+h).value;if(c==-1){alert("Debe seleccionar una vista de las disponibles")}else{try{var b=document.getElementById("filtro_"+h).value}catch(g){var b=""}$.ajax({async:false,url:"/catalogo/vista/"+c,data:"filtro="+b+";completa="+f,dataType:"json",success:function(j){if(j.length!=0){var i='<table style="width:100%;border: 1px solid black;margin-top:20px;margin-bottom:20px;border-collapse:collapse;">';$.each(j,function(l,m){i=i+'<tr style="border= 1px solid black;">';$.each(m,function(n,o){if(l==0){i=i+'<td style="border: 1px solid black; font-weight: bold;">'+o+"</td>"}else{if(l%2!=0){i=i+'<td style="border: 1px solid black; background-color:#76a1b8;">'+o+"</td>"}else{i=i+'<td style="border:1px solid black;">'+o+"</td>"}}});i=i+"</tr>"});i=i+"</table>";if(f){var k=window.open();k.document.open();k.document.write(i)}else{$("#vistaDiv_"+h).removeClass("oculto");e.innerHTML='<label style="float:left; margin-top: 4px;" class="field_opt" for="filtro">Filtro:&nbsp;&nbsp;</label><input style="float:left;width:300px;height: 25px;" id="filtro_'+h+'" name="filtro_'+h+'" type="text" class="input-small" value="'+b+'"/><input style="float:left;" type="button" onClick="cargarVista(false,\''+h+'\')" class="recuadroRecto" value="Filtrar" />';a.innerHTML=i+'<input name="execute" onClick="cargarVista(true,\''+h+'\')" class="recuadroRecto" value="Ver todos los resultados" />'}}else{a.innerHTML='<div style="clear:both"> </div><span>No se han encontrado resultados</span>'}},error:function(i,k,j){}})}}function checkUserInfoRequired(){if($("#field-password-confirm").val()==""){return false}if($("#field-password").val()==""){return false}if($("#field-current-password").val()==""){return false}if($("#field-username-email").val()==""){return false}return true}function checkOrganizationInfoRequired(){return true}function updateOrganizationInfo(){if(checkOrganizationInfoRequired()){showPleaseWait();if($("#field-previous-email").val()!=$("#field-username-email").val()){$.ajax({async:false,url:$("#updateEmailForm")[0].action,type:"POST",data:$("#updateEmailForm").serialize(),success:function(a){if(a!="OK"){alert("Problemas actualizando la información del email de contacto: "+a)}},error:function(a){alert("Problemas actualizando el email de contacto de la organización")}})}$.ajax({async:false,url:$("#updateOrganizationForm")[0].action,type:"POST",data:$("#updateOrganizationForm").serialize(),success:function(a){if(a=="OK"){alert("Actualización completada con éxito")}hideModalDialog()},error:function(a){alert("Problemas actualizando la información de la organización");hideModalDialog()}})}}function updateUserInfo(){if(checkUserInfoRequired()){showPleaseWait();$("#field-email-for-password").val($("#field-username-email").val());$.ajax({async:false,url:$("#updatePasswordForm")[0].action,type:"POST",data:$("#updatePasswordForm").serialize(),success:function(a){if(a=="OK"){alert("Actualización completada con éxito")}else{alert("Problemas actualizando la información de usuario: "+a)}$("#field-password-confirm").val("");$("#field-password").val("");$("#field-current-password").val("");hideModalDialog()},error:function(a){alert("Problemas actualizando la información de usuario");hideModalDialog()}})}else{alert("Debe rellenar todos los campos")}}function submitTxtQueryOrg(){$("#textQueryOrgDataset").val(encodeURI($("#textQueryOrgDataset").val()));$("#orgDatasetQueryForm").submit()};


