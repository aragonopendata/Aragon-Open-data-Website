(function(g){var h=true;g.fn.truncate=function(j){var k=g.extend({},g.fn.truncate.defaults,j);var i=this.map(function(){var n=g.trim(a(g(this).text())).length;if(n<=k.max_length){return}var o=k.max_length-k.more.length-k.link_prefix.length-k.link_suffix.length;var m=e(this,o);var l=g(this).hide();m.insertAfter(l);c(m).append(k.ellipses+k.link_prefix+'<a href="#more" class="'+k.css_more_class+'">'+k.more+"</a>"+k.link_suffix);b(l).append(k.link_prefix+'<a href="#less" class="'+k.css_less_class+'">'+k.less+"</a>"+k.link_suffix);m.find("a:last").click(function(p){p.preventDefault();m.hide();l.show();m.trigger({type:"expand.truncate",relatedTarget:l[0]})});l.find("a:last").click(function(p){p.preventDefault();m.show();l.hide();m.trigger({type:"collapse.truncate",relatedTarget:l[0]})});return m[0]});return this.pushStack(i)};g.fn.truncate.defaults={max_length:100,more:"more",less:"less",ellipses:"â€¦",css_more_class:"truncator-link truncator-more",css_less_class:"truncator-link truncator-less",link_prefix:" (",link_suffix:")"};function e(i,j){return(i.nodeType==3)?f(i,j):d(i,j)}function d(i,l){var i=g(i);var k=i.clone().empty();var j;i.contents().each(function(){var m=l-k.text().length;if(m==0){return}j=e(this,m);if(j){k.append(j)}});return k}function f(i,k){var j=a(i.data);if(h){j=j.replace(/^ /,"")}h=!!j.match(/ $/);var j=j.slice(0,k);j=g("<div/>").text(j).html();return j}function a(i){return i.replace(/\s+/g," ")}function c(k){var i=g(k);var j=i.children(":last");if(!j){return k}var l=j.css("display");if(!l||l=="inline"){return i}return c(j)}function b(k){var i=g(k);var j=i.children(":last");if(j&&j.is("p")){return j}return k}})(jQuery);