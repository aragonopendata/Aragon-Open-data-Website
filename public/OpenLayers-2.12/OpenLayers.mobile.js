var OpenLayers={VERSION_NUMBER:"Release 2.12",singleFile:!0,_getScriptLocation:function(){for(var h=/(^|(.*?\/))(OpenLayers[^\/]*?\.js)(\?|$)/,g=document.getElementsByTagName("script"),l,k="",j=0,i=g.length;j<i;j++){if(l=g[j].getAttribute("src")){if(l=l.match(h)){k=l[1];break}}}return function(){return k}}(),ImgPath:""};OpenLayers.String={startsWith:function(d,c){return 0==d.indexOf(c)},contains:function(d,c){return -1!=d.indexOf(c)},trim:function(b){return b.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(g){for(var g=g.split("-"),f=g[0],j=1,i=g.length;j<i;j++){var h=g[j],f=f+(h.charAt(0).toUpperCase()+h.substring(1))}return f},format:function(e,d,f){d||(d=window);return e.replace(OpenLayers.String.tokenRegEx,function(b,k){for(var j,i=k.split(/\.+/),c=0;c<i.length;c++){0==c&&(j=d),j=j[i[c]]}"function"==typeof j&&(j=f?j.apply(null,f):j());return"undefined"==typeof j?"undefined":j})},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(b){return OpenLayers.String.numberRegEx.test(b)},numericIf:function(b){return OpenLayers.String.isNumeric(b)?parseFloat(b):b}};OpenLayers.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(e,d){var f=0;0<d&&(f=parseFloat(e.toPrecision(d)));return f},format:function(h,g,l,k){g="undefined"!=typeof g?g:0;l="undefined"!=typeof l?l:OpenLayers.Number.thousandsSeparator;k="undefined"!=typeof k?k:OpenLayers.Number.decimalSeparator;null!=g&&(h=parseFloat(h.toFixed(g)));var j=h.toString().split(".");1==j.length&&null==g&&(g=0);h=j[0];if(l){for(var i=/(-?[0-9]+)([0-9]{3})/;i.test(h);){h=h.replace(i,"$1"+l+"$2")}}0==g?g=h:(l=1<j.length?j[1]:"0",null!=g&&(l+=Array(g-l.length+1).join("0")),g=h+k+l);return g}};OpenLayers.Function={bind:function(e,d){var f=Array.prototype.slice.apply(arguments,[2]);return function(){var a=f.concat(Array.prototype.slice.apply(arguments,[0]));return e.apply(d,a)}},bindAsEventListener:function(d,c){return function(a){return d.call(c,a||window.event)}},False:function(){return !1},True:function(){return !0},Void:function(){}};OpenLayers.Array={filter:function(i,h,n){var m=[];if(Array.prototype.filter){m=i.filter(h,n)}else{var l=i.length;if("function"!=typeof h){throw new TypeError}for(var k=0;k<l;k++){if(k in i){var j=i[k];h.call(n,j,k,i)&&m.push(j)}}}return m}};OpenLayers.Class=function(){var f=arguments.length,e=arguments[0],h=arguments[f-1],g="function"==typeof h.initialize?h.initialize:function(){e.prototype.initialize.apply(this,arguments)};1<f?(f=[g,e].concat(Array.prototype.slice.call(arguments).slice(1,f-1),h),OpenLayers.inherit.apply(null,f)):g.prototype=h;return g};OpenLayers.inherit=function(g,f){var j=function(){};j.prototype=f.prototype;g.prototype=new j;var i,h,j=2;for(i=arguments.length;j<i;j++){h=arguments[j],"function"===typeof h&&(h=h.prototype),OpenLayers.Util.extend(g.prototype,h)}};OpenLayers.Util=OpenLayers.Util||{};OpenLayers.Util.extend=function(f,e){f=f||{};if(e){for(var h in e){var g=e[h];void 0!==g&&(f[h]=g)}!("function"==typeof window.Event&&e instanceof window.Event)&&(e.hasOwnProperty&&e.hasOwnProperty("toString"))&&(f.toString=e.toString)}return f};OpenLayers.Bounds=OpenLayers.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(f,e,h,g){OpenLayers.Util.isArray(f)&&(g=f[3],h=f[2],e=f[1],f=f[0]);null!=f&&(this.left=OpenLayers.Util.toFloat(f));null!=e&&(this.bottom=OpenLayers.Util.toFloat(e));null!=h&&(this.right=OpenLayers.Util.toFloat(h));null!=g&&(this.top=OpenLayers.Util.toFloat(g))},clone:function(){return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top)},equals:function(d){var c=!1;null!=d&&(c=this.left==d.left&&this.right==d.right&&this.top==d.top&&this.bottom==d.bottom);return c},toString:function(){return[this.left,this.bottom,this.right,this.top].join()},toArray:function(b){return !0===b?[this.bottom,this.left,this.top,this.right]:[this.left,this.bottom,this.right,this.top]},toBBOX:function(h,g){null==h&&(h=6);var l=Math.pow(10,h),k=Math.round(this.left*l)/l,j=Math.round(this.bottom*l)/l,i=Math.round(this.right*l)/l,l=Math.round(this.top*l)/l;return !0===g?j+","+k+","+l+","+i:k+","+j+","+i+","+l},toGeometry:function(){return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])])},getWidth:function(){return this.right-this.left},getHeight:function(){return this.top-this.bottom},getSize:function(){return new OpenLayers.Size(this.getWidth(),this.getHeight())},getCenterPixel:function(){return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)},getCenterLonLat:function(){this.centerLonLat||(this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2));return this.centerLonLat},scale:function(f,e){null==e&&(e=this.getCenterLonLat());var h,g;"OpenLayers.LonLat"==e.CLASS_NAME?(h=e.lon,g=e.lat):(h=e.x,g=e.y);return new OpenLayers.Bounds((this.left-h)*f+h,(this.bottom-g)*f+g,(this.right-h)*f+h,(this.top-g)*f+g)},add:function(d,c){if(null==d||null==c){throw new TypeError("Bounds.add cannot receive null values")}return new OpenLayers.Bounds(this.left+d,this.bottom+c,this.right+d,this.top+c)},extend:function(d){var c=null;if(d){switch(d.CLASS_NAME){case"OpenLayers.LonLat":c=new OpenLayers.Bounds(d.lon,d.lat,d.lon,d.lat);break;case"OpenLayers.Geometry.Point":c=new OpenLayers.Bounds(d.x,d.y,d.x,d.y);break;case"OpenLayers.Bounds":c=d}if(c){this.centerLonLat=null;if(null==this.left||c.left<this.left){this.left=c.left}if(null==this.bottom||c.bottom<this.bottom){this.bottom=c.bottom}if(null==this.right||c.right>this.right){this.right=c.right}if(null==this.top||c.top>this.top){this.top=c.top}}}},containsLonLat:function(f,e){"boolean"===typeof e&&(e={inclusive:e});var e=e||{},h=this.contains(f.lon,f.lat,e.inclusive),g=e.worldBounds;g&&!h&&(h=g.getWidth(),g=Math.round((f.lon-(g.left+g.right)/2)/h),h=this.containsLonLat({lon:f.lon-g*h,lat:f.lat},{inclusive:e.inclusive}));return h},containsPixel:function(d,c){return this.contains(d.x,d.y,c)},contains:function(f,e,h){null==h&&(h=!0);if(null==f||null==e){return !1}var f=OpenLayers.Util.toFloat(f),e=OpenLayers.Util.toFloat(e),g=!1;return g=h?f>=this.left&&f<=this.right&&e>=this.bottom&&e<=this.top:f>this.left&&f<this.right&&e>this.bottom&&e<this.top},intersectsBounds:function(i,h){"boolean"===typeof h&&(h={inclusive:h});h=h||{};if(h.worldBounds){var n=this.wrapDateLine(h.worldBounds),i=i.wrapDateLine(h.worldBounds)}else{n=this}null==h.inclusive&&(h.inclusive=!0);var m=!1,l=n.left==i.right||n.right==i.left||n.top==i.bottom||n.bottom==i.top;if(h.inclusive||!l){var m=i.top>=n.bottom&&i.top<=n.top||n.top>i.bottom&&n.top<i.top,l=i.left>=n.left&&i.left<=n.right||n.left>=i.left&&n.left<=i.right,k=i.right>=n.left&&i.right<=n.right||n.right>=i.left&&n.right<=i.right,m=(i.bottom>=n.bottom&&i.bottom<=n.top||n.bottom>=i.bottom&&n.bottom<=i.top||m)&&(l||k)}if(h.worldBounds&&!m){var j=h.worldBounds,l=j.getWidth(),k=!j.containsBounds(n),j=!j.containsBounds(i);k&&!j?(i=i.add(-l,0),m=n.intersectsBounds(i,{inclusive:h.inclusive})):j&&!k&&(n=n.add(-l,0),m=i.intersectsBounds(n,{inclusive:h.inclusive}))}return m},containsBounds:function(h,g,l){null==g&&(g=!1);null==l&&(l=!0);var k=this.contains(h.left,h.bottom,l),j=this.contains(h.right,h.bottom,l),i=this.contains(h.left,h.top,l),h=this.contains(h.right,h.top,l);return g?k||j||i||h:k&&j&&i&&h},determineQuadrant:function(e){var d="",f=this.getCenterLonLat(),d=d+(e.lat<f.lat?"b":"t");return d+=e.lon<f.lon?"l":"r"},transform:function(h,g){this.centerLonLat=null;var l=OpenLayers.Projection.transform({x:this.left,y:this.bottom},h,g),k=OpenLayers.Projection.transform({x:this.right,y:this.bottom},h,g),j=OpenLayers.Projection.transform({x:this.left,y:this.top},h,g),i=OpenLayers.Projection.transform({x:this.right,y:this.top},h,g);this.left=Math.min(l.x,j.x);this.bottom=Math.min(l.y,k.y);this.right=Math.max(k.x,i.x);this.top=Math.max(j.y,i.y);return this},wrapDateLine:function(h,g){var g=g||{},l=g.leftTolerance||0,k=g.rightTolerance||0,j=this.clone();if(h){for(var i=h.getWidth();j.left<h.left&&j.right-k<=h.left;){j=j.add(i,0)}for(;j.left+l>=h.right&&j.right>h.right;){j=j.add(-i,0)}l=j.left+l;l<h.right&&(l>h.left&&j.right-k>h.right)&&(j=j.add(-i,0))}return j},CLASS_NAME:"OpenLayers.Bounds"});OpenLayers.Bounds.fromString=function(e,d){var f=e.split(",");return OpenLayers.Bounds.fromArray(f,d)};OpenLayers.Bounds.fromArray=function(d,c){return !0===c?new OpenLayers.Bounds(d[1],d[0],d[3],d[2]):new OpenLayers.Bounds(d[0],d[1],d[2],d[3])};OpenLayers.Bounds.fromSize=function(b){return new OpenLayers.Bounds(0,b.h,b.w,0)};OpenLayers.Bounds.oppositeQuadrant=function(d){var c;c=""+("t"==d.charAt(0)?"b":"t");return c+="l"==d.charAt(1)?"r":"l"};OpenLayers.Element={visible:function(b){return"none"!=OpenLayers.Util.getElement(b).style.display},toggle:function(){for(var f=0,e=arguments.length;f<e;f++){var h=OpenLayers.Util.getElement(arguments[f]),g=OpenLayers.Element.visible(h)?"none":"";h.style.display=g}},remove:function(b){b=OpenLayers.Util.getElement(b);b.parentNode.removeChild(b)},getHeight:function(b){b=OpenLayers.Util.getElement(b);return b.offsetHeight},hasClass:function(e,d){var f=e.className;return !!f&&RegExp("(^|\\s)"+d+"(\\s|$)").test(f)},addClass:function(d,c){OpenLayers.Element.hasClass(d,c)||(d.className+=(d.className?" ":"")+c);return d},removeClass:function(e,d){var f=e.className;f&&(e.className=OpenLayers.String.trim(f.replace(RegExp("(^|\\s+)"+d+"(\\s+|$)")," ")));return e},toggleClass:function(d,c){OpenLayers.Element.hasClass(d,c)?OpenLayers.Element.removeClass(d,c):OpenLayers.Element.addClass(d,c);return d},getStyle:function(f,e){var f=OpenLayers.Util.getElement(f),h=null;if(f&&f.style){h=f.style[OpenLayers.String.camelize(e)];h||(document.defaultView&&document.defaultView.getComputedStyle?h=(h=document.defaultView.getComputedStyle(f,null))?h.getPropertyValue(e):null:f.currentStyle&&(h=f.currentStyle[OpenLayers.String.camelize(e)]));var g=["left","top","right","bottom"];window.opera&&(-1!=OpenLayers.Util.indexOf(g,e)&&"static"==OpenLayers.Element.getStyle(f,"position"))&&(h="auto")}return"auto"==h?null:h}};OpenLayers.LonLat=OpenLayers.Class({lon:0,lat:0,initialize:function(d,c){OpenLayers.Util.isArray(d)&&(c=d[1],d=d[0]);this.lon=OpenLayers.Util.toFloat(d);this.lat=OpenLayers.Util.toFloat(c)},toString:function(){return"lon="+this.lon+",lat="+this.lat},toShortString:function(){return this.lon+", "+this.lat},clone:function(){return new OpenLayers.LonLat(this.lon,this.lat)},add:function(d,c){if(null==d||null==c){throw new TypeError("LonLat.add cannot receive null values")}return new OpenLayers.LonLat(this.lon+OpenLayers.Util.toFloat(d),this.lat+OpenLayers.Util.toFloat(c))},equals:function(d){var c=!1;null!=d&&(c=this.lon==d.lon&&this.lat==d.lat||isNaN(this.lon)&&isNaN(this.lat)&&isNaN(d.lon)&&isNaN(d.lat));return c},transform:function(e,d){var f=OpenLayers.Projection.transform({x:this.lon,y:this.lat},e,d);this.lon=f.x;this.lat=f.y;return this},wrapDateLine:function(d){var c=this.clone();if(d){for(;c.lon<d.left;){c.lon+=d.getWidth()}for(;c.lon>d.right;){c.lon-=d.getWidth()}}return c},CLASS_NAME:"OpenLayers.LonLat"});OpenLayers.LonLat.fromString=function(b){b=b.split(",");return new OpenLayers.LonLat(b[0],b[1])};OpenLayers.LonLat.fromArray=function(d){var c=OpenLayers.Util.isArray(d);return new OpenLayers.LonLat(c&&d[0],c&&d[1])};OpenLayers.Pixel=OpenLayers.Class({x:0,y:0,initialize:function(d,c){this.x=parseFloat(d);this.y=parseFloat(c)},toString:function(){return"x="+this.x+",y="+this.y},clone:function(){return new OpenLayers.Pixel(this.x,this.y)},equals:function(d){var c=!1;null!=d&&(c=this.x==d.x&&this.y==d.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(d.x)&&isNaN(d.y));return c},distanceTo:function(b){return Math.sqrt(Math.pow(this.x-b.x,2)+Math.pow(this.y-b.y,2))},add:function(d,c){if(null==d||null==c){throw new TypeError("Pixel.add cannot receive null values")}return new OpenLayers.Pixel(this.x+d,this.y+c)},offset:function(d){var c=this.clone();d&&(c=this.add(d.x,d.y));return c},CLASS_NAME:"OpenLayers.Pixel"});OpenLayers.Size=OpenLayers.Class({w:0,h:0,initialize:function(d,c){this.w=parseFloat(d);this.h=parseFloat(c)},toString:function(){return"w="+this.w+",h="+this.h},clone:function(){return new OpenLayers.Size(this.w,this.h)},equals:function(d){var c=!1;null!=d&&(c=this.w==d.w&&this.h==d.h||isNaN(this.w)&&isNaN(this.h)&&isNaN(d.w)&&isNaN(d.h));return c},CLASS_NAME:"OpenLayers.Size"});OpenLayers.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(b){alert(b)},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"OpenLayers.Console"};(function(){for(var e=document.getElementsByTagName("script"),d=0,f=e.length;d<f;++d){if(-1!=e[d].src.indexOf("firebug.js")&&console){OpenLayers.Util.extend(OpenLayers.Console,console);break}}})();OpenLayers.Lang={code:null,defaultCode:"en",getCode:function(){OpenLayers.Lang.code||OpenLayers.Lang.setCode();return OpenLayers.Lang.code},setCode:function(e){var d;e||(e="msie"==OpenLayers.BROWSER_NAME?navigator.userLanguage:navigator.language);e=e.split("-");e[0]=e[0].toLowerCase();"object"==typeof OpenLayers.Lang[e[0]]&&(d=e[0]);if(e[1]){var f=e[0]+"-"+e[1].toUpperCase();"object"==typeof OpenLayers.Lang[f]&&(d=f)}d||(OpenLayers.Console.warn("Failed to find OpenLayers.Lang."+e.join("-")+" dictionary, falling back to default language"),d=OpenLayers.Lang.defaultCode);OpenLayers.Lang.code=d},translate:function(e,d){var f=OpenLayers.Lang[OpenLayers.Lang.getCode()];(f=f&&f[e])||(f=e);d&&(f=OpenLayers.String.format(f,d));return f}};OpenLayers.i18n=OpenLayers.Lang.translate;OpenLayers.Util=OpenLayers.Util||{};OpenLayers.Util.getElement=function(){for(var f=[],e=0,h=arguments.length;e<h;e++){var g=arguments[e];"string"==typeof g&&(g=document.getElementById(g));if(1==arguments.length){return g}f.push(g)}return f};OpenLayers.Util.isElement=function(b){return !!(b&&1===b.nodeType)};OpenLayers.Util.isArray=function(b){return"[object Array]"===Object.prototype.toString.call(b)};"undefined"===typeof window.$&&(window.$=OpenLayers.Util.getElement);OpenLayers.Util.removeItem=function(e,d){for(var f=e.length-1;f>=0;f--){e[f]==d&&e.splice(f,1)}return e};OpenLayers.Util.indexOf=function(f,e){if(typeof f.indexOf=="function"){return f.indexOf(e)}for(var h=0,g=f.length;h<g;h++){if(f[h]==e){return h}}return -1};OpenLayers.Util.modifyDOMElement=function(j,i,p,o,n,m,l,k){if(i){j.id=i}if(p){j.style.left=p.x+"px";j.style.top=p.y+"px"}if(o){j.style.width=o.w+"px";j.style.height=o.h+"px"}if(n){j.style.position=n}if(m){j.style.border=m}if(l){j.style.overflow=l}if(parseFloat(k)>=0&&parseFloat(k)<1){j.style.filter="alpha(opacity="+k*100+")";j.style.opacity=k}else{if(parseFloat(k)==1){j.style.filter="";j.style.opacity=""}}};OpenLayers.Util.createDiv=function(r,q,p,o,n,m,l,k){var j=document.createElement("div");if(o){j.style.backgroundImage="url("+o+")"}r||(r=OpenLayers.Util.createUniqueID("OpenLayersDiv"));n||(n="absolute");OpenLayers.Util.modifyDOMElement(j,r,q,p,n,m,l,k);return j};OpenLayers.Util.createImage=function(r,q,p,o,n,m,l,k){var j=document.createElement("img");r||(r=OpenLayers.Util.createUniqueID("OpenLayersDiv"));n||(n="relative");OpenLayers.Util.modifyDOMElement(j,r,q,p,n,m,null,l);if(k){j.style.display="none";q=function(){j.style.display="";OpenLayers.Event.stopObservingElement(j)};OpenLayers.Event.observe(j,"load",q);OpenLayers.Event.observe(j,"error",q)}j.style.alt=r;j.galleryImg="no";if(o){j.src=o}return j};OpenLayers.IMAGE_RELOAD_ATTEMPTS=0;OpenLayers.Util.alphaHackNeeded=null;OpenLayers.Util.alphaHack=function(){if(OpenLayers.Util.alphaHackNeeded==null){var e=navigator.appVersion.split("MSIE"),e=parseFloat(e[1]),d=false;try{d=!!document.body.filters}catch(f){}OpenLayers.Util.alphaHackNeeded=d&&e>=5.5&&e<7}return OpenLayers.Util.alphaHackNeeded};OpenLayers.Util.modifyAlphaImageDiv=function(r,q,p,o,n,m,l,k,j){OpenLayers.Util.modifyDOMElement(r,q,p,o,m,null,null,j);q=r.childNodes[0];if(n){q.src=n}OpenLayers.Util.modifyDOMElement(q,r.id+"_innerImage",null,o,"relative",l);if(OpenLayers.Util.alphaHack()){if(r.style.display!="none"){r.style.display="inline-block"}k==null&&(k="scale");r.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+q.src+"', sizingMethod='"+k+"')";if(parseFloat(r.style.opacity)>=0&&parseFloat(r.style.opacity)<1){r.style.filter=r.style.filter+(" alpha(opacity="+r.style.opacity*100+")")}q.style.filter="alpha(opacity=0)"}};OpenLayers.Util.createAlphaImageDiv=function(t,s,r,q,p,o,n,m,l){var k=OpenLayers.Util.createDiv(),l=OpenLayers.Util.createImage(null,null,null,null,null,null,null,l);l.className="olAlphaImg";k.appendChild(l);OpenLayers.Util.modifyAlphaImageDiv(k,t,s,r,q,p,o,n,m);return k};OpenLayers.Util.upperCaseObject=function(e){var d={},f;for(f in e){d[f.toUpperCase()]=e[f]}return d};OpenLayers.Util.applyDefaults=function(f,e){var f=f||{},h=typeof window.Event=="function"&&e instanceof window.Event,g;for(g in e){if(f[g]===void 0||!h&&e.hasOwnProperty&&e.hasOwnProperty(g)&&!f.hasOwnProperty(g)){f[g]=e[g]}}if(!h&&e&&e.hasOwnProperty&&e.hasOwnProperty("toString")&&!f.hasOwnProperty("toString")){f.toString=e.toString}return f};OpenLayers.Util.getParameterString=function(j){var i=[],p;for(p in j){var o=j[p];if(o!=null&&typeof o!="function"){if(typeof o=="object"&&o.constructor==Array){for(var n=[],m,l=0,k=o.length;l<k;l++){m=o[l];n.push(encodeURIComponent(m===null||m===void 0?"":m))}o=n.join(",")}else{o=encodeURIComponent(o)}i.push(encodeURIComponent(p)+"="+o)}}return i.join("&")};OpenLayers.Util.urlAppend=function(f,e){var h=f;if(e){var g=(f+" ").split(/[?&]/),h=h+(g.pop()===" "?e:g.length?"&"+e:"?"+e)}return h};OpenLayers.Util.getImagesLocation=function(){return OpenLayers.ImgPath||OpenLayers._getScriptLocation()+"img/"};OpenLayers.Util.getImageLocation=function(b){return OpenLayers.Util.getImagesLocation()+b};OpenLayers.Util.Try=function(){for(var g=null,f=0,j=arguments.length;f<j;f++){var i=arguments[f];try{g=i();break}catch(h){}}return g};OpenLayers.Util.getXmlNodeValue=function(d){var c=null;OpenLayers.Util.Try(function(){c=d.text;if(!c){c=d.textContent}if(!c){c=d.firstChild.nodeValue}},function(){c=d.textContent});return c};OpenLayers.Util.mouseLeft=function(e,d){for(var f=e.relatedTarget?e.relatedTarget:e.toElement;f!=d&&f!=null;){f=f.parentNode}return f!=d};OpenLayers.Util.DEFAULT_PRECISION=14;OpenLayers.Util.toFloat=function(d,c){if(c==null){c=OpenLayers.Util.DEFAULT_PRECISION}typeof d!=="number"&&(d=parseFloat(d));return c===0?d:parseFloat(d.toPrecision(c))};OpenLayers.Util.rad=function(b){return b*Math.PI/180};OpenLayers.Util.deg=function(b){return b*180/Math.PI};OpenLayers.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563};OpenLayers.Util.distVincenty=function(N,M){for(var L=OpenLayers.Util.VincentyConstants,K=L.a,J=L.b,L=L.f,I=OpenLayers.Util.rad(M.lon-N.lon),H=Math.atan((1-L)*Math.tan(OpenLayers.Util.rad(N.lat))),G=Math.atan((1-L)*Math.tan(OpenLayers.Util.rad(M.lat))),F=Math.sin(H),H=Math.cos(H),E=Math.sin(G),G=Math.cos(G),D=I,B=2*Math.PI,C=20;Math.abs(D-B)>1e-12&&--C>0;){var A=Math.sin(D),z=Math.cos(D),x=Math.sqrt(G*A*G*A+(H*E-F*G*z)*(H*E-F*G*z));if(x==0){return 0}var z=F*E+H*G*z,y=Math.atan2(x,z),w=Math.asin(H*G*A/x),v=Math.cos(w)*Math.cos(w),A=z-2*F*E/v,u=L/16*v*(4+L*(4-3*v)),B=D,D=I+(1-u)*L*Math.sin(w)*(y+u*x*(A+u*z*(-1+2*A*A)))}if(C==0){return NaN}K=v*(K*K-J*J)/(J*J);L=K/1024*(256+K*(-128+K*(74-47*K)));return(J*(1+K/16384*(4096+K*(-768+K*(320-175*K))))*(y-L*x*(A+L/4*(z*(-1+2*A*A)-L/6*A*(-3+4*x*x)*(-3+4*A*A))))).toFixed(3)/1000};OpenLayers.Util.destinationVincenty=function(N,M,L){for(var K=OpenLayers.Util,J=K.VincentyConstants,I=J.a,H=J.b,G=J.f,J=N.lon,N=N.lat,F=K.rad(M),M=Math.sin(F),F=Math.cos(F),N=(1-G)*Math.tan(K.rad(N)),E=1/Math.sqrt(1+N*N),D=N*E,B=Math.atan2(N,F),N=E*M,C=1-N*N,I=C*(I*I-H*H)/(H*H),A=1+I/16384*(4096+I*(-768+I*(320-175*I))),z=I/1024*(256+I*(-128+I*(74-47*I))),I=L/(H*A),x=2*Math.PI;Math.abs(I-x)>1e-12;){var y=Math.cos(2*B+I),w=Math.sin(I),v=Math.cos(I),u=z*w*(y+z/4*(v*(-1+2*y*y)-z/6*y*(-3+4*w*w)*(-3+4*y*y))),x=I,I=L/(H*A)+u}L=D*w-E*v*F;H=Math.atan2(D*v+E*w*F,(1-G)*Math.sqrt(N*N+L*L));M=Math.atan2(w*M,E*v-D*w*F);F=G/16*C*(4+G*(4-3*C));y=M-(1-F)*G*N*(I+F*w*(y+F*v*(-1+2*y*y)));Math.atan2(N,-L);return new OpenLayers.LonLat(J+K.deg(y),K.deg(H))};OpenLayers.Util.getParameters=function(j){var j=j===null||j===void 0?window.location.href:j,i="";if(OpenLayers.String.contains(j,"?")){var i=j.indexOf("?")+1,p=OpenLayers.String.contains(j,"#")?j.indexOf("#"):j.length,i=j.substring(i,p)}for(var j={},i=i.split(/[&;]/),p=0,o=i.length;p<o;++p){var n=i[p].split("=");if(n[0]){var m=n[0];try{m=decodeURIComponent(m)}catch(l){m=unescape(m)}n=(n[1]||"").replace(/\+/g," ");try{n=decodeURIComponent(n)}catch(k){n=unescape(n)}n=n.split(",");n.length==1&&(n=n[0]);j[m]=n}}return j};OpenLayers.Util.lastSeqID=0;OpenLayers.Util.createUniqueID=function(b){b==null&&(b="id_");OpenLayers.Util.lastSeqID=OpenLayers.Util.lastSeqID+1;return b+OpenLayers.Util.lastSeqID};OpenLayers.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.3701,km:39370.1,dd:4374754,yd:36};OpenLayers.INCHES_PER_UNIT["in"]=OpenLayers.INCHES_PER_UNIT.inches;OpenLayers.INCHES_PER_UNIT.degrees=OpenLayers.INCHES_PER_UNIT.dd;OpenLayers.INCHES_PER_UNIT.nmi=1852*OpenLayers.INCHES_PER_UNIT.m;OpenLayers.METERS_PER_INCH=0.0254000508001016;OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{Inch:OpenLayers.INCHES_PER_UNIT.inches,Meter:1/OpenLayers.METERS_PER_INCH,Foot:0.3048006096012192/OpenLayers.METERS_PER_INCH,IFoot:0.3048/OpenLayers.METERS_PER_INCH,ClarkeFoot:0.3047972651151/OpenLayers.METERS_PER_INCH,SearsFoot:0.30479947153867626/OpenLayers.METERS_PER_INCH,GoldCoastFoot:0.3047997101815088/OpenLayers.METERS_PER_INCH,IInch:0.0254/OpenLayers.METERS_PER_INCH,MicroInch:0.0000254/OpenLayers.METERS_PER_INCH,Mil:2.54e-8/OpenLayers.METERS_PER_INCH,Centimeter:0.01/OpenLayers.METERS_PER_INCH,Kilometer:1000/OpenLayers.METERS_PER_INCH,Yard:0.9144018288036576/OpenLayers.METERS_PER_INCH,SearsYard:0.914398414616029/OpenLayers.METERS_PER_INCH,IndianYard:0.9143985307444408/OpenLayers.METERS_PER_INCH,IndianYd37:0.91439523/OpenLayers.METERS_PER_INCH,IndianYd62:0.9143988/OpenLayers.METERS_PER_INCH,IndianYd75:0.9143985/OpenLayers.METERS_PER_INCH,IndianFoot:0.30479951/OpenLayers.METERS_PER_INCH,IndianFt37:0.30479841/OpenLayers.METERS_PER_INCH,IndianFt62:0.3047996/OpenLayers.METERS_PER_INCH,IndianFt75:0.3047995/OpenLayers.METERS_PER_INCH,Mile:1609.3472186944373/OpenLayers.METERS_PER_INCH,IYard:0.9144/OpenLayers.METERS_PER_INCH,IMile:1609.344/OpenLayers.METERS_PER_INCH,NautM:1852/OpenLayers.METERS_PER_INCH,"Lat-66":110943.31648893273/OpenLayers.METERS_PER_INCH,"Lat-83":110946.25736872235/OpenLayers.METERS_PER_INCH,Decimeter:0.1/OpenLayers.METERS_PER_INCH,Millimeter:0.001/OpenLayers.METERS_PER_INCH,Dekameter:10/OpenLayers.METERS_PER_INCH,Decameter:10/OpenLayers.METERS_PER_INCH,Hectometer:100/OpenLayers.METERS_PER_INCH,GermanMeter:1.0000135965/OpenLayers.METERS_PER_INCH,CaGrid:0.999738/OpenLayers.METERS_PER_INCH,ClarkeChain:20.1166194976/OpenLayers.METERS_PER_INCH,GunterChain:20.11684023368047/OpenLayers.METERS_PER_INCH,BenoitChain:20.116782494375872/OpenLayers.METERS_PER_INCH,SearsChain:20.11676512155/OpenLayers.METERS_PER_INCH,ClarkeLink:0.201166194976/OpenLayers.METERS_PER_INCH,GunterLink:0.2011684023368047/OpenLayers.METERS_PER_INCH,BenoitLink:0.20116782494375873/OpenLayers.METERS_PER_INCH,SearsLink:0.2011676512155/OpenLayers.METERS_PER_INCH,Rod:5.02921005842012/OpenLayers.METERS_PER_INCH,IntnlChain:20.1168/OpenLayers.METERS_PER_INCH,IntnlLink:0.201168/OpenLayers.METERS_PER_INCH,Perch:5.02921005842012/OpenLayers.METERS_PER_INCH,Pole:5.02921005842012/OpenLayers.METERS_PER_INCH,Furlong:201.1684023368046/OpenLayers.METERS_PER_INCH,Rood:3.778266898/OpenLayers.METERS_PER_INCH,CapeFoot:0.3047972615/OpenLayers.METERS_PER_INCH,Brealey:375/OpenLayers.METERS_PER_INCH,ModAmFt:0.304812252984506/OpenLayers.METERS_PER_INCH,Fathom:1.8288/OpenLayers.METERS_PER_INCH,"NautM-UK":1853.184/OpenLayers.METERS_PER_INCH,"50kilometers":50000/OpenLayers.METERS_PER_INCH,"150kilometers":150000/OpenLayers.METERS_PER_INCH});OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{mm:OpenLayers.INCHES_PER_UNIT.Meter/1000,cm:OpenLayers.INCHES_PER_UNIT.Meter/100,dm:100*OpenLayers.INCHES_PER_UNIT.Meter,km:1000*OpenLayers.INCHES_PER_UNIT.Meter,kmi:OpenLayers.INCHES_PER_UNIT.nmi,fath:OpenLayers.INCHES_PER_UNIT.Fathom,ch:OpenLayers.INCHES_PER_UNIT.IntnlChain,link:OpenLayers.INCHES_PER_UNIT.IntnlLink,"us-in":OpenLayers.INCHES_PER_UNIT.inches,"us-ft":OpenLayers.INCHES_PER_UNIT.Foot,"us-yd":OpenLayers.INCHES_PER_UNIT.Yard,"us-ch":OpenLayers.INCHES_PER_UNIT.GunterChain,"us-mi":OpenLayers.INCHES_PER_UNIT.Mile,"ind-yd":OpenLayers.INCHES_PER_UNIT.IndianYd37,"ind-ft":OpenLayers.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/OpenLayers.METERS_PER_INCH});OpenLayers.DOTS_PER_INCH=72;OpenLayers.Util.normalizeScale=function(b){return b>1?1/b:b};OpenLayers.Util.getResolutionFromScale=function(e,d){var f;if(e){d==null&&(d="degrees");f=1/(OpenLayers.Util.normalizeScale(e)*OpenLayers.INCHES_PER_UNIT[d]*OpenLayers.DOTS_PER_INCH)}return f};OpenLayers.Util.getScaleFromResolution=function(d,c){c==null&&(c="degrees");return d*OpenLayers.INCHES_PER_UNIT[c]*OpenLayers.DOTS_PER_INCH};OpenLayers.Util.pagePosition=function(g){var f=[0,0],j=OpenLayers.Util.getViewportElement();if(!g||g==window||g==j){return f}var i=OpenLayers.IS_GECKO&&document.getBoxObjectFor&&OpenLayers.Element.getStyle(g,"position")=="absolute"&&(g.style.top==""||g.style.left==""),h=null;if(g.getBoundingClientRect){g=g.getBoundingClientRect();h=j.scrollTop;f[0]=g.left+j.scrollLeft;f[1]=g.top+h}else{if(document.getBoxObjectFor&&!i){g=document.getBoxObjectFor(g);j=document.getBoxObjectFor(j);f[0]=g.screenX-j.screenX;f[1]=g.screenY-j.screenY}else{f[0]=g.offsetLeft;f[1]=g.offsetTop;h=g.offsetParent;if(h!=g){for(;h;){f[0]=f[0]+h.offsetLeft;f[1]=f[1]+h.offsetTop;h=h.offsetParent}}j=OpenLayers.BROWSER_NAME;if(j=="opera"||j=="safari"&&OpenLayers.Element.getStyle(g,"position")=="absolute"){f[1]=f[1]-document.body.offsetTop}for(h=g.offsetParent;h&&h!=document.body;){f[0]=f[0]-h.scrollLeft;if(j!="opera"||h.tagName!="TR"){f[1]=f[1]-h.scrollTop}h=h.offsetParent}}}return f};OpenLayers.Util.getViewportElement=function(){var b=arguments.callee.viewportElement;if(b==void 0){b=OpenLayers.BROWSER_NAME=="msie"&&document.compatMode!="CSS1Compat"?document.body:document.documentElement;arguments.callee.viewportElement=b}return b};OpenLayers.Util.isEquivalentUrl=function(f,e,h){h=h||{};OpenLayers.Util.applyDefaults(h,{ignoreCase:true,ignorePort80:true,ignoreHash:true});var f=OpenLayers.Util.createUrlObject(f,h),e=OpenLayers.Util.createUrlObject(e,h),g;for(g in f){if(g!=="args"&&f[g]!=e[g]){return false}}for(g in f.args){if(f.args[g]!=e.args[g]){return false}delete e.args[g]}for(g in e.args){return false}return true};OpenLayers.Util.createUrlObject=function(g,f){f=f||{};if(!/^\w+:\/\//.test(g)){var j=window.location,i=j.port?":"+j.port:"",i=j.protocol+"//"+j.host.split(":").shift()+i;if(g.indexOf("/")===0){g=i+g}else{j=j.pathname.split("/");j.pop();g=i+j.join("/")+"/"+g}}f.ignoreCase&&(g=g.toLowerCase());j=document.createElement("a");j.href=g;i={};i.host=j.host.split(":").shift();i.protocol=j.protocol;i.port=f.ignorePort80?j.port=="80"||j.port=="0"?"":j.port:j.port==""||j.port=="0"?"80":j.port;i.hash=f.ignoreHash||j.hash==="#"?"":j.hash;var h=j.search;if(!h){h=g.indexOf("?");h=h!=-1?g.substr(h):""}i.args=OpenLayers.Util.getParameters(h);i.pathname=j.pathname.charAt(0)=="/"?j.pathname:"/"+j.pathname;return i};OpenLayers.Util.removeTail=function(e){var d=null,d=e.indexOf("?"),f=e.indexOf("#");return d=d==-1?f!=-1?e.substr(0,f):e:f!=-1?e.substr(0,Math.min(d,f)):e.substr(0,d)};OpenLayers.IS_GECKO=function(){var b=navigator.userAgent.toLowerCase();return b.indexOf("webkit")==-1&&b.indexOf("gecko")!=-1}();OpenLayers.CANVAS_SUPPORTED=function(){var b=document.createElement("canvas");return !(!b.getContext||!b.getContext("2d"))}();OpenLayers.BROWSER_NAME=function(){var d="",c=navigator.userAgent.toLowerCase();c.indexOf("opera")!=-1?d="opera":c.indexOf("msie")!=-1?d="msie":c.indexOf("safari")!=-1?d="safari":c.indexOf("mozilla")!=-1&&(d=c.indexOf("firefox")!=-1?"firefox":"mozilla");return d}();OpenLayers.Util.getBrowserName=function(){return OpenLayers.BROWSER_NAME};OpenLayers.Util.getRenderedDimensions=function(v,u,t){var s,r,q=document.createElement("div");q.style.visibility="hidden";for(var p=t&&t.containerElement?t.containerElement:document.body,o=false,n=null,m=p;m&&m.tagName.toLowerCase()!="body";){var l=OpenLayers.Element.getStyle(m,"position");if(l=="absolute"){o=true;break}else{if(l&&l!="static"){break}}m=m.parentNode}if(o&&(p.clientHeight===0||p.clientWidth===0)){n=document.createElement("div");n.style.visibility="hidden";n.style.position="absolute";n.style.overflow="visible";n.style.width=document.body.clientWidth+"px";n.style.height=document.body.clientHeight+"px";n.appendChild(q)}q.style.position="absolute";if(u){if(u.w){s=u.w;q.style.width=s+"px"}else{if(u.h){r=u.h;q.style.height=r+"px"}}}if(t&&t.displayClass){q.className=t.displayClass}u=document.createElement("div");u.innerHTML=v;u.style.overflow="visible";if(u.childNodes){v=0;for(t=u.childNodes.length;v<t;v++){if(u.childNodes[v].style){u.childNodes[v].style.overflow="visible"}}}q.appendChild(u);n?p.appendChild(n):p.appendChild(q);if(!s){s=parseInt(u.scrollWidth);q.style.width=s+"px"}r||(r=parseInt(u.scrollHeight));q.removeChild(u);if(n){n.removeChild(q);p.removeChild(n)}else{p.removeChild(q)}return new OpenLayers.Size(s,r)};OpenLayers.Util.getScrollbarWidth=function(){var e=OpenLayers.Util._scrollbarWidth;if(e==null){var d=null,f=null,d=e=0,d=document.createElement("div");d.style.position="absolute";d.style.top="-1000px";d.style.left="-1000px";d.style.width="100px";d.style.height="50px";d.style.overflow="hidden";f=document.createElement("div");f.style.width="100%";f.style.height="200px";d.appendChild(f);document.body.appendChild(d);e=f.offsetWidth;d.style.overflow="scroll";d=f.offsetWidth;document.body.removeChild(document.body.lastChild);OpenLayers.Util._scrollbarWidth=e-d;e=OpenLayers.Util._scrollbarWidth}return e};OpenLayers.Util.getFormattedLonLat=function(h,g,l){l||(l="dms");var h=(h+540)%360-180,k=Math.abs(h),j=Math.floor(k),i=k=(k-j)/(1/60),k=Math.floor(k),i=Math.round((i-k)/(1/60)*10),i=i/10;if(i>=60){i=i-60;k=k+1;if(k>=60){k=k-60;j=j+1}}j<10&&(j="0"+j);j=j+"\u00b0";if(l.indexOf("dm")>=0){k<10&&(k="0"+k);j=j+(k+"'");if(l.indexOf("dms")>=0){i<10&&(i="0"+i);j=j+(i+'"')}}return j=g=="lon"?j+(h<0?OpenLayers.i18n("W"):OpenLayers.i18n("E")):j+(h<0?OpenLayers.i18n("S"):OpenLayers.i18n("N"))};OpenLayers.Event={observers:!1,KEY_SPACE:32,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(b){return b.target||b.srcElement},isSingleTouch:function(b){return b.touches&&1==b.touches.length},isMultiTouch:function(b){return b.touches&&1<b.touches.length},isLeftClick:function(b){return b.which&&1==b.which||b.button&&1==b.button},isRightClick:function(b){return b.which&&3==b.which||b.button&&2==b.button},stop:function(d,c){c||(d.preventDefault?d.preventDefault():d.returnValue=!1);d.stopPropagation?d.stopPropagation():d.cancelBubble=!0},findElement:function(e,d){for(var f=OpenLayers.Event.element(e);f.parentNode&&(!f.tagName||f.tagName.toUpperCase()!=d.toUpperCase());){f=f.parentNode}return f},observe:function(g,f,j,i){g=OpenLayers.Util.getElement(g);i=i||!1;if("keypress"==f&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||g.attachEvent)){f="keydown"}this.observers||(this.observers={});if(!g._eventCacheID){var h="eventCacheID_";g.id&&(h=g.id+"_"+h);g._eventCacheID=OpenLayers.Util.createUniqueID(h)}h=g._eventCacheID;this.observers[h]||(this.observers[h]=[]);this.observers[h].push({element:g,name:f,observer:j,useCapture:i});g.addEventListener?g.addEventListener(f,j,i):g.attachEvent&&g.attachEvent("on"+f,j)},stopObservingElement:function(b){b=OpenLayers.Util.getElement(b)._eventCacheID;this._removeElementObservers(OpenLayers.Event.observers[b])},_removeElementObservers:function(e){if(e){for(var d=e.length-1;0<=d;d--){var f=e[d];OpenLayers.Event.stopObserving.apply(this,[f.element,f.name,f.observer,f.useCapture])}}},stopObserving:function(r,q,p,o){var o=o||!1,r=OpenLayers.Util.getElement(r),n=r._eventCacheID;if("keypress"==q&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||r.detachEvent)){q="keydown"}var m=!1,l=OpenLayers.Event.observers[n];if(l){for(var k=0;!m&&k<l.length;){var j=l[k];if(j.name==q&&j.observer==p&&j.useCapture==o){l.splice(k,1);0==l.length&&delete OpenLayers.Event.observers[n];m=!0;break}k++}}m&&(r.removeEventListener?r.removeEventListener(q,p,o):r&&r.detachEvent&&r.detachEvent("on"+q,p));return m},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var b in OpenLayers.Event.observers){OpenLayers.Event._removeElementObservers.apply(this,[OpenLayers.Event.observers[b]])}OpenLayers.Event.observers=!1}},CLASS_NAME:"OpenLayers.Event"};OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,!1);OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:"mouseover mouseout mousedown mouseup mousemove click dblclick rightclick dblrightclick resize focus blur touchstart touchmove touchend keydown".split(" "),listeners:null,object:null,element:null,eventHandler:null,fallThrough:null,includeXY:!1,extensions:null,extensionCount:null,clearMouseListener:null,initialize:function(g,f,j,i,h){OpenLayers.Util.extend(this,h);this.object=g;this.fallThrough=i;this.listeners={};this.extensions={};this.extensionCount={};null!=f&&this.attachToElement(f)},destroy:function(){for(var b in this.extensions){"boolean"!==typeof this.extensions[b]&&this.extensions[b].destroy()}this.extensions=null;this.element&&(OpenLayers.Event.stopObservingElement(this.element),this.element.hasScrollEvent&&OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener));this.eventHandler=this.fallThrough=this.object=this.listeners=this.element=null},addEventType:function(){},attachToElement:function(e){this.element?OpenLayers.Event.stopObservingElement(this.element):(this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this),this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this));this.element=e;for(var d=0,f=this.BROWSER_EVENTS.length;d<f;d++){OpenLayers.Event.observe(e,this.BROWSER_EVENTS[d],this.eventHandler)}OpenLayers.Event.observe(e,"dragstart",OpenLayers.Event.stop)},on:function(d){for(var c in d){"scope"!=c&&d.hasOwnProperty(c)&&this.register(c,d.scope,d[c])}},register:function(g,f,j,i){g in OpenLayers.Events&&!this.extensions[g]&&(this.extensions[g]=new OpenLayers.Events[g](this));if(null!=j){null==f&&(f=this.object);var h=this.listeners[g];h||(h=[],this.listeners[g]=h,this.extensionCount[g]=0);f={obj:f,func:j};i?(h.splice(this.extensionCount[g],0,f),"object"===typeof i&&i.extension&&this.extensionCount[g]++):h.push(f)}},registerPriority:function(e,d,f){this.register(e,d,f,!0)},un:function(d){for(var c in d){"scope"!=c&&d.hasOwnProperty(c)&&this.unregister(c,d.scope,d[c])}},unregister:function(g,f,j){null==f&&(f=this.object);g=this.listeners[g];if(null!=g){for(var i=0,h=g.length;i<h;i++){if(g[i].obj==f&&g[i].func==j){g.splice(i,1);break}}}},remove:function(b){null!=this.listeners[b]&&(this.listeners[b]=[])},triggerEvent:function(h,g){var l=this.listeners[h];if(l&&0!=l.length){null==g&&(g={});g.object=this.object;g.element=this.element;g.type||(g.type=h);for(var l=l.slice(),k,j=0,i=l.length;j<i&&!(k=l[j],k=k.func.apply(k.obj,[g]),void 0!=k&&!1==k);j++){}this.fallThrough||OpenLayers.Event.stop(g,!0);return k}},handleBrowserEvent:function(j){var i=j.type,p=this.listeners[i];if(p&&0!=p.length){if((p=j.touches)&&p[0]){for(var o=0,n=0,m=p.length,l,k=0;k<m;++k){l=p[k],o+=l.clientX,n+=l.clientY}j.clientX=o/m;j.clientY=n/m}this.includeXY&&(j.xy=this.getMousePosition(j));this.triggerEvent(i,j)}},clearMouseCache:function(){this.element.scrolls=null;this.element.lefttop=null;var b=document.body;if(b&&(!(0!=b.scrollTop||0!=b.scrollLeft)||!navigator.userAgent.match(/iPhone/i))){this.element.offsets=null}},getMousePosition:function(d){this.includeXY?this.element.hasScrollEvent||(OpenLayers.Event.observe(window,"scroll",this.clearMouseListener),this.element.hasScrollEvent=!0):this.clearMouseCache();if(!this.element.scrolls){var c=OpenLayers.Util.getViewportElement();this.element.scrolls=[c.scrollLeft,c.scrollTop]}this.element.lefttop||(this.element.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0]);this.element.offsets||(this.element.offsets=OpenLayers.Util.pagePosition(this.element));return new OpenLayers.Pixel(d.clientX+this.element.scrolls[0]-this.element.offsets[0]-this.element.lefttop[0],d.clientY+this.element.scrolls[1]-this.element.offsets[1]-this.element.lefttop[1])},CLASS_NAME:"OpenLayers.Events"});OpenLayers.Events.buttonclick=OpenLayers.Class({target:null,events:"mousedown mouseup click dblclick touchstart touchmove touchend keydown".split(" "),startRegEx:/^mousedown|touchstart$/,cancelRegEx:/^touchmove$/,completeRegEx:/^mouseup|touchend$/,initialize:function(b){this.target=b;for(b=this.events.length-1;0<=b;--b){this.target.register(this.events[b],this,this.buttonClick,{extension:!0})}},destroy:function(){for(var b=this.events.length-1;0<=b;--b){this.target.unregister(this.events[b],this,this.buttonClick)}delete this.target},getPressedButton:function(e){var d=3,f;do{if(OpenLayers.Element.hasClass(e,"olButton")){f=e;break}e=e.parentNode}while(0<--d&&e);return f},buttonClick:function(e){var d=!0,f=OpenLayers.Event.element(e);if(f&&(OpenLayers.Event.isLeftClick(e)||!~e.type.indexOf("mouse"))){if(f=this.getPressedButton(f)){if("keydown"===e.type){switch(e.keyCode){case OpenLayers.Event.KEY_RETURN:case OpenLayers.Event.KEY_SPACE:this.target.triggerEvent("buttonclick",{buttonElement:f}),OpenLayers.Event.stop(e),d=!1}}else{this.startEvt&&(this.completeRegEx.test(e.type)&&(d=OpenLayers.Util.pagePosition(f),this.target.triggerEvent("buttonclick",{buttonElement:f,buttonXY:{x:this.startEvt.clientX-d[0],y:this.startEvt.clientY-d[1]}})),this.cancelRegEx.test(e.type)&&delete this.startEvt,OpenLayers.Event.stop(e),d=!1)}this.startRegEx.test(e.type)&&(this.startEvt=e,OpenLayers.Event.stop(e),d=!1)}else{delete this.startEvt}}return d}});OpenLayers.Control=OpenLayers.Class({id:null,map:null,div:null,type:null,allowSelection:!1,displayClass:"",title:"",autoActivate:!1,active:null,handler:null,eventListeners:null,events:null,initialize:function(b){this.displayClass=this.CLASS_NAME.replace("OpenLayers.","ol").replace(/\./g,"");OpenLayers.Util.extend(this,b);this.events=new OpenLayers.Events(this);if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"))},destroy:function(){this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy(),this.events=null);this.eventListeners=null;this.handler&&(this.handler.destroy(),this.handler=null);if(this.handlers){for(var b in this.handlers){this.handlers.hasOwnProperty(b)&&"function"==typeof this.handlers[b].destroy&&this.handlers[b].destroy()}this.handlers=null}this.map&&(this.map.removeControl(this),this.map=null);this.div=null},setMap:function(b){this.map=b;this.handler&&this.handler.setMap(b)},draw:function(b){if(null==this.div&&(this.div=OpenLayers.Util.createDiv(this.id),this.div.className=this.displayClass,this.allowSelection||(this.div.className+=" olControlNoSelect",this.div.setAttribute("unselectable","on",0),this.div.onselectstart=OpenLayers.Function.False),""!=this.title)){this.div.title=this.title}null!=b&&(this.position=b.clone());this.moveTo(this.position);return this.div},moveTo:function(b){null!=b&&null!=this.div&&(this.div.style.left=b.x+"px",this.div.style.top=b.y+"px")},activate:function(){if(this.active){return !1}this.handler&&this.handler.activate();this.active=!0;this.map&&OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active");this.events.triggerEvent("activate");return !0},deactivate:function(){return this.active?(this.handler&&this.handler.deactivate(),this.active=!1,this.map&&OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("deactivate"),!0):!1},CLASS_NAME:"OpenLayers.Control"});OpenLayers.Control.TYPE_BUTTON=1;OpenLayers.Control.TYPE_TOGGLE=2;OpenLayers.Control.TYPE_TOOL=3;OpenLayers.Geometry=OpenLayers.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.bounds=this.id=null},clone:function(){return new OpenLayers.Geometry},setBounds:function(b){b&&(this.bounds=b.clone())},clearBounds:function(){this.bounds=null;this.parent&&this.parent.clearBounds()},extendBounds:function(b){this.getBounds()?this.bounds.extend(b):this.setBounds(b)},getBounds:function(){null==this.bounds&&this.calculateBounds();return this.bounds},calculateBounds:function(){},distanceTo:function(){},getVertices:function(){},atPoint:function(f,e,h){var g=!1;null!=this.getBounds()&&null!=f&&(e=null!=e?e:0,h=null!=h?h:0,g=(new OpenLayers.Bounds(this.bounds.left-e,this.bounds.bottom-h,this.bounds.right+e,this.bounds.top+h)).containsLonLat(f));return g},getLength:function(){return 0},getArea:function(){return 0},getCentroid:function(){return null},toString:function(){return OpenLayers.Format&&OpenLayers.Format.WKT?OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this)):Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Geometry"});OpenLayers.Geometry.fromWKT=function(f){var e;if(OpenLayers.Format&&OpenLayers.Format.WKT){var h=OpenLayers.Geometry.fromWKT.format;h||(h=new OpenLayers.Format.WKT,OpenLayers.Geometry.fromWKT.format=h);f=h.read(f);if(f instanceof OpenLayers.Feature.Vector){e=f.geometry}else{if(OpenLayers.Util.isArray(f)){e=f.length;for(var h=Array(e),g=0;g<e;++g){h[g]=f[g].geometry}e=new OpenLayers.Geometry.Collection(h)}}}return e};OpenLayers.Geometry.segmentsIntersect=function(x,w,v){var u=v&&v.point,v=v&&v.tolerance,t=!1,s=x.x1-w.x1,r=x.y1-w.y1,q=x.x2-x.x1,p=x.y2-x.y1,o=w.y2-w.y1,n=w.x2-w.x1,l=o*q-n*p,o=n*r-o*s,r=q*r-p*s;0==l?0==o&&0==r&&(t=!0):(s=o/l,l=r/l,0<=s&&(1>=s&&0<=l&&1>=l)&&(u?(q=x.x1+s*q,l=x.y1+s*p,t=new OpenLayers.Geometry.Point(q,l)):t=!0));if(v){if(t){if(u){x=[x,w];w=0;x:for(;2>w;++w){s=x[w];for(p=1;3>p;++p){if(q=s["x"+p],l=s["y"+p],u=Math.sqrt(Math.pow(q-t.x,2)+Math.pow(l-t.y,2)),u<v){t.x=q;t.y=l;break x}}}}}else{x=[x,w];w=0;x:for(;2>w;++w){q=x[w];l=x[(w+1)%2];for(p=1;3>p;++p){if(s={x:q["x"+p],y:q["y"+p]},r=OpenLayers.Geometry.distanceToSegment(s,l),r.distance<v){t=u?new OpenLayers.Geometry.Point(s.x,s.y):!0;break x}}}}}return t};OpenLayers.Geometry.distanceToSegment=function(v,u){var t=v.x,s=v.y,r=u.x1,q=u.y1,p=u.x2,o=u.y2,n=p-r,m=o-q,l=(n*(t-r)+m*(s-q))/(Math.pow(n,2)+Math.pow(m,2));0>=l||(1<=l?(r=p,q=o):(r+=l*n,q+=l*m));return{distance:Math.sqrt(Math.pow(r-t,2)+Math.pow(q-s,2)),x:r,y:q}};OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,{components:null,componentTypes:null,initialize:function(b){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.components=[];null!=b&&this.addComponents(b)},destroy:function(){this.components.length=0;this.components=null;OpenLayers.Geometry.prototype.destroy.apply(this,arguments)},clone:function(){for(var a=eval("new "+this.CLASS_NAME+"()"),b=0,c=this.components.length;b<c;b++){a.addComponent(this.components[b].clone())}OpenLayers.Util.applyDefaults(a,this);return a},getComponentsString:function(){for(var e=[],d=0,f=this.components.length;d<f;d++){e.push(this.components[d].toShortString())}return e.join(",")},calculateBounds:function(){this.bounds=null;var f=new OpenLayers.Bounds,e=this.components;if(e){for(var h=0,g=e.length;h<g;h++){f.extend(e[h].getBounds())}}null!=f.left&&(null!=f.bottom&&null!=f.right&&null!=f.top)&&this.setBounds(f)},addComponents:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var d=0,f=e.length;d<f;d++){this.addComponent(e[d])}},addComponent:function(f,e){var h=!1;if(f&&(null==this.componentTypes||-1<OpenLayers.Util.indexOf(this.componentTypes,f.CLASS_NAME))){if(null!=e&&e<this.components.length){var h=this.components.slice(0,e),g=this.components.slice(e,this.components.length);h.push(f);this.components=h.concat(g)}else{this.components.push(f)}f.parent=this;this.clearBounds();h=!0}return h},removeComponents:function(e){var d=!1;OpenLayers.Util.isArray(e)||(e=[e]);for(var f=e.length-1;0<=f;--f){d=this.removeComponent(e[f])||d}return d},removeComponent:function(b){OpenLayers.Util.removeItem(this.components,b);this.clearBounds();return !0},getLength:function(){for(var e=0,d=0,f=this.components.length;d<f;d++){e+=this.components[d].getLength()}return e},getArea:function(){for(var e=0,d=0,f=this.components.length;d<f;d++){e+=this.components[d].getArea()}return e},getGeodesicArea:function(f){for(var e=0,h=0,g=this.components.length;h<g;h++){e+=this.components[h].getGeodesicArea(f)}return e},getCentroid:function(r){if(!r){return this.components.length&&this.components[0].getCentroid()}r=this.components.length;if(!r){return !1}for(var q=[],p=[],o=0,n=Number.MAX_VALUE,m,l=0;l<r;++l){m=this.components[l];var k=m.getArea();m=m.getCentroid(!0);!isNaN(k)&&(!isNaN(m.x)&&!isNaN(m.y))&&(q.push(k),o+=k,n=k<n&&0<k?k:n,p.push(m))}r=q.length;if(0===o){for(l=0;l<r;++l){q[l]=1}o=q.length}else{for(l=0;l<r;++l){q[l]/=n}o/=n}for(var j=n=0,l=0;l<r;++l){m=p[l],k=q[l],n+=m.x*k,j+=m.y*k}return new OpenLayers.Geometry.Point(n/o,j/o)},getGeodesicLength:function(f){for(var e=0,h=0,g=this.components.length;h<g;h++){e+=this.components[h].getGeodesicLength(f)}return e},move:function(f,e){for(var h=0,g=this.components.length;h<g;h++){this.components[h].move(f,e)}},rotate:function(f,e){for(var h=0,g=this.components.length;h<g;++h){this.components[h].rotate(f,e)}},resize:function(f,e,h){for(var g=0;g<this.components.length;++g){this.components[g].resize(f,e,h)}return this},distanceTo:function(r,q){for(var p=!(q&&!1===q.edge)&&q&&q.details,o,n,m,l=Number.POSITIVE_INFINITY,k=0,j=this.components.length;k<j&&!(o=this.components[k].distanceTo(r,q),m=p?o.distance:o,m<l&&(l=m,n=o,0==l));++k){}return n},equals:function(f){var e=!0;if(!f||!f.CLASS_NAME||this.CLASS_NAME!=f.CLASS_NAME){e=!1}else{if(!OpenLayers.Util.isArray(f.components)||f.components.length!=this.components.length){e=!1}else{for(var h=0,g=this.components.length;h<g;++h){if(!this.components[h].equals(f.components[h])){e=!1;break}}}}return e},transform:function(f,e){if(f&&e){for(var h=0,g=this.components.length;h<g;h++){this.components[h].transform(f,e)}this.bounds=null}return this},intersects:function(f){for(var e=!1,h=0,g=this.components.length;h<g&&!(e=f.intersects(this.components[h]));++h){}return e},getVertices:function(f){for(var e=[],h=0,g=this.components.length;h<g;++h){Array.prototype.push.apply(e,this.components[h].getVertices(f))}return e},CLASS_NAME:"OpenLayers.Geometry.Collection"});OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,initialize:function(d,c){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.x=parseFloat(d);this.y=parseFloat(c)},clone:function(b){null==b&&(b=new OpenLayers.Geometry.Point(this.x,this.y));OpenLayers.Util.applyDefaults(b,this);return b},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y)},distanceTo:function(j,i){var p=!(i&&!1===i.edge)&&i&&i.details,o,n,m,l,k;j instanceof OpenLayers.Geometry.Point?(n=this.x,m=this.y,l=j.x,k=j.y,o=Math.sqrt(Math.pow(n-l,2)+Math.pow(m-k,2)),o=!p?o:{x0:n,y0:m,x1:l,y1:k,distance:o}):(o=j.distanceTo(this,i),p&&(o={x0:o.x1,y0:o.y1,x1:o.x0,y1:o.y0,distance:o.distance}));return o},equals:function(d){var c=!1;null!=d&&(c=this.x==d.x&&this.y==d.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(d.x)&&isNaN(d.y));return c},toShortString:function(){return this.x+", "+this.y},move:function(d,c){this.x+=d;this.y+=c;this.clearBounds()},rotate:function(f,e){var f=f*(Math.PI/180),h=this.distanceTo(e),g=f+Math.atan2(this.y-e.y,this.x-e.x);this.x=e.x+h*Math.cos(g);this.y=e.y+h*Math.sin(g);this.clearBounds()},getCentroid:function(){return new OpenLayers.Geometry.Point(this.x,this.y)},resize:function(e,d,f){this.x=d.x+e*(void 0==f?1:f)*(this.x-d.x);this.y=d.y+e*(this.y-d.y);this.clearBounds();return this},intersects:function(d){var c=!1;return c="OpenLayers.Geometry.Point"==d.CLASS_NAME?this.equals(d):d.intersects(this)},transform:function(d,c){d&&c&&(OpenLayers.Projection.transform(this,d,c),this.bounds=null);return this},getVertices:function(){return[this]},CLASS_NAME:"OpenLayers.Geometry.Point"});OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Point"],addPoint:function(d,c){this.addComponent(d,c)},removePoint:function(b){this.removeComponent(b)},CLASS_NAME:"OpenLayers.Geometry.MultiPoint"});OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{componentTypes:["OpenLayers.Geometry.Point"],getLength:function(){var e=0;if(this.components&&1<this.components.length){for(var d=1,f=this.components.length;d<f;d++){e+=this.components[d-1].distanceTo(this.components[d])}}return e},getGeodesicLength:function(h){var g=this;if(h){var l=new OpenLayers.Projection("EPSG:4326");l.equals(h)||(g=this.clone().transform(h,l))}h=0;if(g.components&&1<g.components.length){for(var k,j=1,i=g.components.length;j<i;j++){l=g.components[j-1],k=g.components[j],h+=OpenLayers.Util.distVincenty({lon:l.x,lat:l.y},{lon:k.x,lat:k.y})}}return 1000*h},CLASS_NAME:"OpenLayers.Geometry.Curve"});OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{removeComponent:function(d){var c=this.components&&2<this.components.length;c&&OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);return c},intersects:function(D){var C=!1,B=D.CLASS_NAME;if("OpenLayers.Geometry.LineString"==B||"OpenLayers.Geometry.LinearRing"==B||"OpenLayers.Geometry.Point"==B){var A=this.getSortedSegments(),D="OpenLayers.Geometry.Point"==B?[{x1:D.x,y1:D.y,x2:D.x,y2:D.y}]:D.getSortedSegments(),z,y,x,w,v,u,t,r=0,s=A.length;D:for(;r<s;++r){B=A[r];z=B.x1;y=B.x2;x=B.y1;w=B.y2;var q=0,p=D.length;for(;q<p;++q){v=D[q];if(v.x1>y){break}if(!(v.x2<z)&&(u=v.y1,t=v.y2,!(Math.min(u,t)>Math.max(x,w))&&!(Math.max(u,t)<Math.min(x,w))&&OpenLayers.Geometry.segmentsIntersect(B,v))){C=!0;break D}}}}else{C=D.intersects(this)}return C},getSortedSegments:function(){for(var g=this.components.length-1,f=Array(g),j,i,h=0;h<g;++h){j=this.components[h],i=this.components[h+1],f[h]=j.x<i.x?{x1:j.x,y1:j.y,x2:i.x,y2:i.y}:{x1:i.x,y1:i.y,x2:j.x,y2:j.y}}return f.sort(function(d,c){return d.x1-c.x1})},splitWithSegment:function(J,I){for(var H=!(I&&!1===I.edge),G=I&&I.tolerance,F=[],E=this.getVertices(),D=[],C=[],B=!1,A,z,x,y={point:!0,tolerance:G},w=null,v=0,t=E.length-2;v<=t;++v){if(G=E[v],D.push(G.clone()),A=E[v+1],z={x1:G.x,y1:G.y,x2:A.x,y2:A.y},z=OpenLayers.Geometry.segmentsIntersect(J,z,y),z instanceof OpenLayers.Geometry.Point&&((x=z.x===J.x1&&z.y===J.y1||z.x===J.x2&&z.y===J.y2||z.equals(G)||z.equals(A)?!0:!1)||H)){z.equals(C[C.length-1])||C.push(z.clone()),!(0===v&&z.equals(G))&&!z.equals(A)&&(B=!0,z.equals(G)||D.push(z),F.push(new OpenLayers.Geometry.LineString(D)),D=[z.clone()])}}B&&(D.push(A.clone()),F.push(new OpenLayers.Geometry.LineString(D)));if(0<C.length){var u=J.x1<J.x2?1:-1,s=J.y1<J.y2?1:-1,w={lines:F,points:C.sort(function(d,c){return u*d.x-u*c.x||s*d.y-s*c.y})}}return w},split:function(N,M){var L=null,K=M&&M.mutual,J,I,H,G;if(N instanceof OpenLayers.Geometry.LineString){var F=this.getVertices(),E,D,B,C,A,z=[];H=[];for(var x=0,y=F.length-2;x<=y;++x){E=F[x];D=F[x+1];B={x1:E.x,y1:E.y,x2:D.x,y2:D.y};G=G||[N];K&&z.push(E.clone());for(var w=0;w<G.length;++w){if(C=G[w].splitWithSegment(B,M)){if(A=C.lines,0<A.length&&(A.unshift(w,1),Array.prototype.splice.apply(G,A),w+=A.length-2),K){for(var v=0,u=C.points.length;v<u;++v){A=C.points[v],A.equals(E)||(z.push(A),H.push(new OpenLayers.Geometry.LineString(z)),z=A.equals(D)?[]:[A.clone()])}}}}}K&&(0<H.length&&0<z.length)&&(z.push(D.clone()),H.push(new OpenLayers.Geometry.LineString(z)))}else{L=N.splitWith(this,M)}G&&1<G.length?I=!0:G=[];H&&1<H.length?J=!0:H=[];if(I||J){L=K?[H,G]:G}return L},splitWith:function(d,c){return d.split(this,c)},getVertices:function(b){return !0===b?[this.components[0],this.components[this.components.length-1]]:!1===b?this.components.slice(1,this.components.length-1):this.components.slice()},distanceTo:function(H,G){var F=!(G&&!1===G.edge)&&G&&G.details,E,D={},C=Number.POSITIVE_INFINITY;if(H instanceof OpenLayers.Geometry.Point){for(var B=this.getSortedSegments(),A=H.x,z=H.y,y,x=0,v=B.length;x<v;++x){if(y=B[x],E=OpenLayers.Geometry.distanceToSegment(H,y),E.distance<C){if(C=E.distance,D=E,0===C){break}}else{if(y.x2>A&&(z>y.y1&&z<y.y2||z<y.y1&&z>y.y2)){break}}}D=F?{distance:D.distance,x0:D.x,y0:D.y,x1:A,y1:z}:D.distance}else{if(H instanceof OpenLayers.Geometry.LineString){var B=this.getSortedSegments(),A=H.getSortedSegments(),w,u,t=A.length,r={point:!0},x=0,v=B.length;H:for(;x<v;++x){z=B[x];y=z.x1;u=z.y1;for(var s=0;s<t;++s){if(E=A[s],w=OpenLayers.Geometry.segmentsIntersect(z,E,r)){C=0;D={distance:0,x0:w.x,y0:w.y,x1:w.x,y1:w.y};break H}else{E=OpenLayers.Geometry.distanceToSegment({x:y,y:u},E),E.distance<C&&(C=E.distance,D={distance:C,x0:y,y0:u,x1:E.x,y1:E.y})}}}F||(D=D.distance);0!==C&&z&&(E=H.distanceTo(new OpenLayers.Geometry.Point(z.x2,z.y2),G),x=F?E.distance:E,x<C&&(D=F?{distance:C,x0:E.x1,y0:E.y1,x1:E.x0,y1:E.y0}:x))}else{D=H.distanceTo(this,G),F&&(D={distance:D.distance,x0:D.x1,y0:D.y1,x1:D.x0,y1:D.y0})}}return D},simplify:function(g){if(this&&null!==this){var f=this.getVertices();if(3>f.length){return this}var j=function(w,v,u,t){for(var s=0,r=0,p=v,q;p<u;p++){q=w[v];var e=w[u],c=w[p],c=Math.abs(0.5*(q.x*e.y+e.x*c.y+c.x*q.y-e.x*q.y-c.x*e.y-q.x*c.y));q=Math.sqrt(Math.pow(q.x-e.x,2)+Math.pow(q.y-e.y,2));q=2*(c/q);q>s&&(s=q,r=p)}s>t&&r!=v&&(h.push(r),j(w,v,r,t),j(w,r,u,t))},i=f.length-1,h=[];h.push(0);for(h.push(i);f[0].equals(f[i]);){i--,h.push(i)}j(f,0,i,g);g=[];h.sort(function(d,c){return d-c});for(i=0;i<h.length;i++){g.push(f[h[i]])}return new OpenLayers.Geometry.LineString(g)}return this},CLASS_NAME:"OpenLayers.Geometry.LineString"});OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],addComponent:function(f,e){var h=!1,g=this.components.pop();if(null!=e||!f.equals(g)){h=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments)}OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[this.components[0]]);return h},removeComponent:function(d){var c=this.components&&3<this.components.length;c&&(this.components.pop(),OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments),OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[this.components[0]]));return c},move:function(f,e){for(var h=0,g=this.components.length;h<g-1;h++){this.components[h].move(f,e)}},rotate:function(f,e){for(var h=0,g=this.components.length;h<g-1;++h){this.components[h].rotate(f,e)}},resize:function(g,f,j){for(var i=0,h=this.components.length;i<h-1;++i){this.components[i].resize(g,f,j)}return this},transform:function(f,e){if(f&&e){for(var h=0,g=this.components.length;h<g-1;h++){this.components[h].transform(f,e)}this.bounds=null}return this},getCentroid:function(){if(this.components&&2<this.components.length){for(var g=0,f=0,j=0;j<this.components.length-1;j++){var i=this.components[j],h=this.components[j+1],g=g+(i.x+h.x)*(i.x*h.y-h.x*i.y),f=f+(i.y+h.y)*(i.x*h.y-h.x*i.y)}j=-1*this.getArea();return new OpenLayers.Geometry.Point(g/(6*j),f/(6*j))}return null},getArea:function(){var g=0;if(this.components&&2<this.components.length){for(var f=g=0,j=this.components.length;f<j-1;f++){var i=this.components[f],h=this.components[f+1],g=g+(i.x+h.x)*(h.y-i.y)}g=-g/2}return g},getGeodesicArea:function(h){var g=this;if(h){var l=new OpenLayers.Projection("EPSG:4326");l.equals(h)||(g=this.clone().transform(h,l))}h=0;l=g.components&&g.components.length;if(2<l){for(var k,j,i=0;i<l-1;i++){k=g.components[i],j=g.components[i+1],h+=OpenLayers.Util.rad(j.x-k.x)*(2+Math.sin(OpenLayers.Util.rad(k.y))+Math.sin(OpenLayers.Util.rad(j.y)))}h=40680631590769*h/2}return h},containsPoint:function(v){for(var u=OpenLayers.Number.limitSigDigs,t=u(v.x,14),v=u(v.y,14),s=this.components.length-1,r,q,p,o,n,m=0,l=0;l<s;++l){if(r=this.components[l],p=u(r.x,14),r=u(r.y,14),q=this.components[l+1],o=u(q.x,14),q=u(q.y,14),r==q){if(v==r&&(p<=o&&t>=p&&t<=o||p>=o&&t<=p&&t>=o)){m=-1;break}}else{n=u((v-q)*((o-p)/(q-r))+o,14);if(n==t&&(r<q&&v>=r&&v<=q||r>q&&v<=r&&v>=q)){m=-1;break}n<=t||p!=o&&(n<Math.min(p,o)||n>Math.max(p,o))||(r<q&&v>=r&&v<q||r>q&&v<r&&v>=q)&&++m}}return -1==m?1:!!(m&1)},intersects:function(f){var e=!1;if("OpenLayers.Geometry.Point"==f.CLASS_NAME){e=this.containsPoint(f)}else{if("OpenLayers.Geometry.LineString"==f.CLASS_NAME){e=f.intersects(this)}else{if("OpenLayers.Geometry.LinearRing"==f.CLASS_NAME){e=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[f])}else{for(var h=0,g=f.components.length;h<g&&!(e=f.components[h].intersects(this));++h){}}}}return e},getVertices:function(b){return !0===b?[]:this.components.slice(0,this.components.length-1)},CLASS_NAME:"OpenLayers.Geometry.LinearRing"});OpenLayers.Animation=function(g){var f=!(!g.requestAnimationFrame&&!g.webkitRequestAnimationFrame&&!g.mozRequestAnimationFrame&&!g.oRequestAnimationFrame&&!g.msRequestAnimationFrame),j=function(){var a=g.requestAnimationFrame||g.webkitRequestAnimationFrame||g.mozRequestAnimationFrame||g.oRequestAnimationFrame||g.msRequestAnimationFrame||function(c){g.setTimeout(c,16)};return function(e,b){a.apply(g,[e,b])}}(),i=0,h={};return{isNative:f,requestFrame:j,start:function(d,c,l){var c=0<c?c:Number.POSITIVE_INFINITY,k=++i,e=+new Date;h[k]=function(){h[k]&&+new Date-e<=c?(d(),h[k]&&j(h[k],l)):delete h[k]};j(h[k],l);return k},stop:function(b){delete h[b]}}}(window);OpenLayers.Tween=OpenLayers.Class({easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,animationId:null,playing:!1,initialize:function(b){this.easing=b?b:OpenLayers.Easing.Expo.easeOut},start:function(f,e,h,g){this.playing=!0;this.begin=f;this.finish=e;this.duration=h;this.callbacks=g.callbacks;this.time=0;OpenLayers.Animation.stop(this.animationId);this.animationId=null;this.callbacks&&this.callbacks.start&&this.callbacks.start.call(this,this.begin);this.animationId=OpenLayers.Animation.start(OpenLayers.Function.bind(this.play,this))},stop:function(){this.playing&&(this.callbacks&&this.callbacks.done&&this.callbacks.done.call(this,this.finish),OpenLayers.Animation.stop(this.animationId),this.animationId=null,this.playing=!1)},play:function(){var f={},e;for(e in this.begin){var h=this.begin[e],g=this.finish[e];if(null==h||null==g||isNaN(h)||isNaN(g)){throw new TypeError("invalid value for Tween")}f[e]=this.easing.apply(this,[this.time,h,g-h,this.duration])}this.time++;this.callbacks&&this.callbacks.eachStep&&this.callbacks.eachStep.call(this,f);this.time>this.duration&&this.stop()},CLASS_NAME:"OpenLayers.Tween"});OpenLayers.Easing={CLASS_NAME:"OpenLayers.Easing"};OpenLayers.Easing.Linear={easeIn:function(f,e,h,g){return h*f/g+e},easeOut:function(f,e,h,g){return h*f/g+e},easeInOut:function(f,e,h,g){return h*f/g+e},CLASS_NAME:"OpenLayers.Easing.Linear"};OpenLayers.Easing.Expo={easeIn:function(f,e,h,g){return 0==f?e:h*Math.pow(2,10*(f/g-1))+e},easeOut:function(f,e,h,g){return f==g?e+h:h*(-Math.pow(2,-10*f/g)+1)+e},easeInOut:function(f,e,h,g){return 0==f?e:f==g?e+h:1>(f/=g/2)?h/2*Math.pow(2,10*(f-1))+e:h/2*(-Math.pow(2,-10*--f)+2)+e},CLASS_NAME:"OpenLayers.Easing.Expo"};OpenLayers.Easing.Quad={easeIn:function(f,e,h,g){return h*(f/=g)*f+e},easeOut:function(f,e,h,g){return -h*(f/=g)*(f-2)+e},easeInOut:function(f,e,h,g){return 1>(f/=g/2)?h/2*f*f+e:-h/2*(--f*(f-2)-1)+e},CLASS_NAME:"OpenLayers.Easing.Quad"};OpenLayers.Projection=OpenLayers.Class({proj:null,projCode:null,titleRegEx:/\+title=[^\+]*/,initialize:function(d,c){OpenLayers.Util.extend(this,c);this.projCode=d;window.Proj4js&&(this.proj=new Proj4js.Proj(d))},getCode:function(){return this.proj?this.proj.srsCode:this.projCode},getUnits:function(){return this.proj?this.proj.units:null},toString:function(){return this.getCode()},equals:function(d){var c=!1;d&&(d instanceof OpenLayers.Projection||(d=new OpenLayers.Projection(d)),window.Proj4js&&this.proj.defData&&d.proj.defData?c=this.proj.defData.replace(this.titleRegEx,"")==d.proj.defData.replace(this.titleRegEx,""):d.getCode&&(c=this.getCode(),d=d.getCode(),c=c==d||!!OpenLayers.Projection.transforms[c]&&OpenLayers.Projection.transforms[c][d]===OpenLayers.Projection.nullTransform));return c},destroy:function(){delete this.proj;delete this.projCode},CLASS_NAME:"OpenLayers.Projection"});OpenLayers.Projection.transforms={};OpenLayers.Projection.defaults={"EPSG:4326":{units:"degrees",maxExtent:[-180,-90,180,90],yx:!0},"CRS:84":{units:"degrees",maxExtent:[-180,-90,180,90]},"EPSG:900913":{units:"m",maxExtent:[-20037508.34,-20037508.34,20037508.34,20037508.34]}};OpenLayers.Projection.addTransform=function(f,e,h){if(h===OpenLayers.Projection.nullTransform){var g=OpenLayers.Projection.defaults[f];g&&!OpenLayers.Projection.defaults[e]&&(OpenLayers.Projection.defaults[e]=g)}OpenLayers.Projection.transforms[f]||(OpenLayers.Projection.transforms[f]={});OpenLayers.Projection.transforms[f][e]=h};OpenLayers.Projection.transform=function(f,e,h){if(e&&h){if(e instanceof OpenLayers.Projection||(e=new OpenLayers.Projection(e)),h instanceof OpenLayers.Projection||(h=new OpenLayers.Projection(h)),e.proj&&h.proj){f=Proj4js.transform(e.proj,h.proj,f)}else{var e=e.getCode(),h=h.getCode(),g=OpenLayers.Projection.transforms;if(g[e]&&g[e][h]){g[e][h](f)}}}return f};OpenLayers.Projection.nullTransform=function(b){return b};(function(){function i(b){b.x=180*b.x/m;b.y=180/Math.PI*(2*Math.atan(Math.exp(b.y/m*Math.PI))-Math.PI/2);return b}function h(b){b.x=b.x*m/180;b.y=Math.log(Math.tan((90+b.y)*Math.PI/360))/Math.PI*m;return b}function n(w,v){var u=OpenLayers.Projection.addTransform,t=OpenLayers.Projection.nullTransform,s,r,p,b,a;s=0;for(r=v.length;s<r;++s){p=v[s];u(w,p,h);u(p,w,i);for(a=s+1;a<r;++a){b=v[a],u(p,b,t),u(b,p,t)}}}var m=20037508.34,l=["EPSG:900913","EPSG:3857","EPSG:102113","EPSG:102100"],k=["CRS:84","urn:ogc:def:crs:EPSG:6.6:4326","EPSG:4326"],j;for(j=l.length-1;0<=j;--j){n(l[j],k)}for(j=k.length-1;0<=j;--j){n(k[j],l)}})();OpenLayers.Map=OpenLayers.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1000},id:null,fractionalZoom:!1,events:null,allOverlays:!1,div:null,dragging:!1,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,options:null,tileSize:null,projection:"EPSG:4326",units:null,resolutions:null,maxResolution:null,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:!0,panTween:null,eventListeners:null,panMethod:OpenLayers.Easing.Expo.easeOut,panDuration:50,paddingForPopups:null,minPx:null,maxPx:null,initialize:function(h,g){1===arguments.length&&"object"===typeof h&&(h=(g=h)&&g.div);this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT);this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15);this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css";this.options=OpenLayers.Util.extend({},g);OpenLayers.Util.extend(this,g);OpenLayers.Util.applyDefaults(this,OpenLayers.Projection.defaults[this.projection instanceof OpenLayers.Projection?this.projection.projCode:this.projection]);this.maxExtent&&!(this.maxExtent instanceof OpenLayers.Bounds)&&(this.maxExtent=new OpenLayers.Bounds(this.maxExtent));this.minExtent&&!(this.minExtent instanceof OpenLayers.Bounds)&&(this.minExtent=new OpenLayers.Bounds(this.minExtent));this.restrictedExtent&&!(this.restrictedExtent instanceof OpenLayers.Bounds)&&(this.restrictedExtent=new OpenLayers.Bounds(this.restrictedExtent));this.center&&!(this.center instanceof OpenLayers.LonLat)&&(this.center=new OpenLayers.LonLat(this.center));this.layers=[];this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_");this.div=OpenLayers.Util.getElement(h);this.div||(this.div=document.createElement("div"),this.div.style.height="1px",this.div.style.width="1px");OpenLayers.Element.addClass(this.div,"olMap");var l=this.id+"_OpenLayers_ViewPort";this.viewPortDiv=OpenLayers.Util.createDiv(l,null,null,null,"relative",null,"hidden");this.viewPortDiv.style.width="100%";this.viewPortDiv.style.height="100%";this.viewPortDiv.className="olMapViewport";this.div.appendChild(this.viewPortDiv);this.events=new OpenLayers.Events(this,this.viewPortDiv,null,this.fallThrough,{includeXY:!0});l=this.id+"_OpenLayers_Container";this.layerContainerDiv=OpenLayers.Util.createDiv(l);this.layerContainerDiv.style.width="100px";this.layerContainerDiv.style.height="100px";this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1;this.viewPortDiv.appendChild(this.layerContainerDiv);this.updateSize();if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}9>parseFloat(navigator.appVersion.split("MSIE")[1])?this.events.register("resize",this,this.updateSize):(this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this),OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy));if(this.theme){for(var l=!0,k=document.getElementsByTagName("link"),j=0,i=k.length;j<i;++j){if(OpenLayers.Util.isEquivalentUrl(k.item(j).href,this.theme)){l=!1;break}}l&&(l=document.createElement("link"),l.setAttribute("rel","stylesheet"),l.setAttribute("type","text/css"),l.setAttribute("href",this.theme),document.getElementsByTagName("head")[0].appendChild(l))}null==this.controls&&(this.controls=[],null!=OpenLayers.Control&&(OpenLayers.Control.Navigation?this.controls.push(new OpenLayers.Control.Navigation):OpenLayers.Control.TouchNavigation&&this.controls.push(new OpenLayers.Control.TouchNavigation),OpenLayers.Control.Zoom?this.controls.push(new OpenLayers.Control.Zoom):OpenLayers.Control.PanZoom&&this.controls.push(new OpenLayers.Control.PanZoom),OpenLayers.Control.ArgParser&&this.controls.push(new OpenLayers.Control.ArgParser),OpenLayers.Control.Attribution&&this.controls.push(new OpenLayers.Control.Attribution)));j=0;for(i=this.controls.length;j<i;j++){this.addControlToMap(this.controls[j])}this.popups=[];this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this);OpenLayers.Event.observe(window,"unload",this.unloadDestroy);g&&g.layers&&(delete this.center,this.addLayers(g.layers),g.center&&!this.getCenter()&&this.setCenter(g.center,g.zoom))},getViewport:function(){return this.viewPortDiv},render:function(b){this.div=OpenLayers.Util.getElement(b);OpenLayers.Element.addClass(this.div,"olMap");this.viewPortDiv.parentNode.removeChild(this.viewPortDiv);this.div.appendChild(this.viewPortDiv);this.updateSize()},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy){return !1}this.panTween&&(this.panTween.stop(),this.panTween=null);OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy);this.unloadDestroy=null;this.updateSizeDestroy?OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy):this.events.unregister("resize",this,this.updateSize);this.paddingForPopups=null;if(null!=this.controls){for(var b=this.controls.length-1;0<=b;--b){this.controls[b].destroy()}this.controls=null}if(null!=this.layers){for(b=this.layers.length-1;0<=b;--b){this.layers[b].destroy(!1)}this.layers=null}this.viewPortDiv&&this.div.removeChild(this.viewPortDiv);this.viewPortDiv=null;this.eventListeners&&(this.events.un(this.eventListeners),this.eventListeners=null);this.events.destroy();this.options=this.events=null},setOptions:function(d){var c=this.minPx&&d.restrictedExtent!=this.restrictedExtent;OpenLayers.Util.extend(this,d);c&&this.moveTo(this.getCachedCenter(),this.zoom,{forceZoomChange:!0})},getTileSize:function(){return this.tileSize},getBy:function(f,e,h){var g="function"==typeof h.test;return OpenLayers.Array.filter(this[f],function(b){return b[e]==h||g&&h.test(b[e])})},getLayersBy:function(d,c){return this.getBy("layers",d,c)},getLayersByName:function(b){return this.getLayersBy("name",b)},getLayersByClass:function(b){return this.getLayersBy("CLASS_NAME",b)},getControlsBy:function(d,c){return this.getBy("controls",d,c)},getControlsByClass:function(b){return this.getControlsBy("CLASS_NAME",b)},getLayer:function(g){for(var f=null,j=0,i=this.layers.length;j<i;j++){var h=this.layers[j];if(h.id==g){f=h;break}}return f},setLayerZIndex:function(d,c){d.setZIndex(this.Z_INDEX_BASE[d.isBaseLayer?"BaseLayer":"Overlay"]+5*c)},resetLayersZIndex:function(){for(var d=0,c=this.layers.length;d<c;d++){this.setLayerZIndex(this.layers[d],d)}},addLayer:function(e){for(var d=0,f=this.layers.length;d<f;d++){if(this.layers[d]==e){return !1}}if(!1===this.events.triggerEvent("preaddlayer",{layer:e})){return !1}this.allOverlays&&(e.isBaseLayer=!1);e.div.className="olLayerDiv";e.div.style.overflow="";this.setLayerZIndex(e,this.layers.length);e.isFixed?this.viewPortDiv.appendChild(e.div):this.layerContainerDiv.appendChild(e.div);this.layers.push(e);e.setMap(this);e.isBaseLayer||this.allOverlays&&!this.baseLayer?null==this.baseLayer?this.setBaseLayer(e):e.setVisibility(!1):e.redraw();this.events.triggerEvent("addlayer",{layer:e});e.events.triggerEvent("added",{map:this,layer:e});e.afterAdd();return !0},addLayers:function(e){for(var d=0,f=e.length;d<f;d++){this.addLayer(e[d])}},removeLayer:function(g,f){if(!1!==this.events.triggerEvent("preremovelayer",{layer:g})){null==f&&(f=!0);g.isFixed?this.viewPortDiv.removeChild(g.div):this.layerContainerDiv.removeChild(g.div);OpenLayers.Util.removeItem(this.layers,g);g.removeMap(this);g.map=null;if(this.baseLayer==g&&(this.baseLayer=null,f)){for(var j=0,i=this.layers.length;j<i;j++){var h=this.layers[j];if(h.isBaseLayer||this.allOverlays){this.setBaseLayer(h);break}}}this.resetLayersZIndex();this.events.triggerEvent("removelayer",{layer:g});g.events.triggerEvent("removed",{map:this,layer:g})}},getNumLayers:function(){return this.layers.length},getLayerIndex:function(b){return OpenLayers.Util.indexOf(this.layers,b)},setLayerIndex:function(f,e){var h=this.getLayerIndex(f);0>e?e=0:e>this.layers.length&&(e=this.layers.length);if(h!=e){this.layers.splice(h,1);this.layers.splice(e,0,f);for(var h=0,g=this.layers.length;h<g;h++){this.setLayerZIndex(this.layers[h],h)}this.events.triggerEvent("changelayer",{layer:f,property:"order"});this.allOverlays&&(0===e?this.setBaseLayer(f):this.baseLayer!==this.layers[0]&&this.setBaseLayer(this.layers[0]))}},raiseLayer:function(e,d){var f=this.getLayerIndex(e)+d;this.setLayerIndex(e,f)},setBaseLayer:function(e){if(e!=this.baseLayer&&-1!=OpenLayers.Util.indexOf(this.layers,e)){var d=this.getCachedCenter(),f=OpenLayers.Util.getResolutionFromScale(this.getScale(),e.units);null!=this.baseLayer&&!this.allOverlays&&this.baseLayer.setVisibility(!1);this.baseLayer=e;if(!this.allOverlays||this.baseLayer.visibility){this.baseLayer.setVisibility(!0),!1===this.baseLayer.inRange&&this.baseLayer.redraw()}null!=d&&(e=this.getZoomForResolution(f||this.resolution,!0),this.setCenter(d,e,!1,!0));this.events.triggerEvent("changebaselayer",{layer:this.baseLayer})}},addControl:function(d,c){this.controls.push(d);this.addControlToMap(d,c)},addControls:function(g,f){for(var j=1===arguments.length?[]:f,i=0,h=g.length;i<h;i++){this.addControl(g[i],j[i]?j[i]:null)}},addControlToMap:function(e,d){e.outsideViewport=null!=e.div;this.displayProjection&&!e.displayProjection&&(e.displayProjection=this.displayProjection);e.setMap(this);var f=e.draw(d);f&&!e.outsideViewport&&(f.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length,this.viewPortDiv.appendChild(f));e.autoActivate&&e.activate()},getControl:function(g){for(var f=null,j=0,i=this.controls.length;j<i;j++){var h=this.controls[j];if(h.id==g){f=h;break}}return f},removeControl:function(b){b&&b==this.getControl(b.id)&&(b.div&&b.div.parentNode==this.viewPortDiv&&this.viewPortDiv.removeChild(b.div),OpenLayers.Util.removeItem(this.controls,b))},addPopup:function(e,d){if(d){for(var f=this.popups.length-1;0<=f;--f){this.removePopup(this.popups[f])}}e.map=this;this.popups.push(e);if(f=e.draw()){f.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length,this.layerContainerDiv.appendChild(f)}},removePopup:function(d){OpenLayers.Util.removeItem(this.popups,d);if(d.div){try{this.layerContainerDiv.removeChild(d.div)}catch(c){}}d.map=null},getSize:function(){var b=null;null!=this.size&&(b=this.size.clone());return b},updateSize:function(){var d=this.getCurrentSize();if(d&&!isNaN(d.h)&&!isNaN(d.w)){this.events.clearMouseCache();var c=this.getSize();null==c&&(this.size=c=d);if(!d.equals(c)){this.size=d;d=0;for(c=this.layers.length;d<c;d++){this.layers[d].onMapResize()}d=this.getCachedCenter();null!=this.baseLayer&&null!=d&&(c=this.getZoom(),this.zoom=null,this.setCenter(d,c))}}},getCurrentSize:function(){var b=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);if(0==b.w&&0==b.h||isNaN(b.w)&&isNaN(b.h)){b.w=this.div.offsetWidth,b.h=this.div.offsetHeight}if(0==b.w&&0==b.h||isNaN(b.w)&&isNaN(b.h)){b.w=parseInt(this.div.style.width),b.h=parseInt(this.div.style.height)}return b},calculateBounds:function(f,e){var h=null;null==f&&(f=this.getCachedCenter());null==e&&(e=this.getResolution());if(null!=f&&null!=e){var h=this.size.w*e/2,g=this.size.h*e/2,h=new OpenLayers.Bounds(f.lon-h,f.lat-g,f.lon+h,f.lat+g)}return h},getCenter:function(){var d=null,c=this.getCachedCenter();c&&(d=c.clone());return d},getCachedCenter:function(){!this.center&&this.size&&(this.center=this.getLonLatFromViewPortPx({x:this.size.w/2,y:this.size.h/2}));return this.center},getZoom:function(){return this.zoom},pan:function(f,e,h){h=OpenLayers.Util.applyDefaults(h,{animate:!0,dragging:!1});if(h.dragging){(0!=f||0!=e)&&this.moveByPx(f,e)}else{var g=this.getViewPortPxFromLonLat(this.getCachedCenter()),f=g.add(f,e);if(this.dragging||!f.equals(g)){g=this.getLonLatFromViewPortPx(f),h.animate?this.panTo(g):(this.moveTo(g),this.dragging&&(this.dragging=!1,this.events.triggerEvent("moveend")))}}},panTo:function(g){if(this.panMethod&&this.getExtent().scale(this.panRatio).containsLonLat(g)){this.panTween||(this.panTween=new OpenLayers.Tween(this.panMethod));var f=this.getCachedCenter();if(!g.equals(f)){var f=this.getPixelFromLonLat(f),j=this.getPixelFromLonLat(g),i=0,h=0;this.panTween.start({x:0,y:0},{x:j.x-f.x,y:j.y-f.y},this.panDuration,{callbacks:{eachStep:OpenLayers.Function.bind(function(b){this.moveByPx(b.x-i,b.y-h);i=Math.round(b.x);h=Math.round(b.y)},this),done:OpenLayers.Function.bind(function(){this.moveTo(g);this.dragging=false;this.events.triggerEvent("moveend")},this)}})}}else{this.setCenter(g)}},setCenter:function(f,e,h,g){this.panTween&&this.panTween.stop();this.moveTo(f,e,{dragging:h,forceZoomChange:g})},moveByPx:function(r,q){var p=this.size.w/2,o=this.size.h/2,n=p+r,m=o+q,l=this.baseLayer.wrapDateLine,k=0,j=0;this.restrictedExtent&&(k=p,j=o,l=!1);r=l||n<=this.maxPx.x-k&&n>=this.minPx.x+k?Math.round(r):0;q=m<=this.maxPx.y-j&&m>=this.minPx.y+j?Math.round(q):0;if(r||q){this.dragging||(this.dragging=!0,this.events.triggerEvent("movestart"));this.center=null;r&&(this.layerContainerDiv.style.left=parseInt(this.layerContainerDiv.style.left)-r+"px",this.minPx.x-=r,this.maxPx.x-=r);q&&(this.layerContainerDiv.style.top=parseInt(this.layerContainerDiv.style.top)-q+"px",this.minPx.y-=q,this.maxPx.y-=q);o=0;for(n=this.layers.length;o<n;++o){if(p=this.layers[o],p.visibility&&(p===this.baseLayer||p.inRange)){p.moveByPx(r,q),p.events.triggerEvent("move")}}this.events.triggerEvent("move")}},adjustZoom:function(g){var f=this.baseLayer.resolutions,j=this.getMaxExtent().getWidth()/this.size.w;if(this.getResolutionForZoom(g)>j){for(var i=g|0,h=f.length;i<h;++i){if(f[i]<=j){g=i;break}}}return g},moveTo:function(t,s,r){null!=t&&!(t instanceof OpenLayers.LonLat)&&(t=new OpenLayers.LonLat(t));r||(r={});null!=s&&(s=parseFloat(s),this.fractionalZoom||(s=Math.round(s)));if(this.baseLayer.wrapDateLine){var q=s,s=this.adjustZoom(s);s!==q&&(t=this.getCenter())}var q=r.dragging||this.dragging,p=r.forceZoomChange;!this.getCachedCenter()&&!this.isValidLonLat(t)&&(t=this.maxExtent.getCenterLonLat(),this.center=t.clone());if(null!=this.restrictedExtent){null==t&&(t=this.center);null==s&&(s=this.getZoom());var o=this.getResolutionForZoom(s),o=this.calculateBounds(t,o);if(!this.restrictedExtent.containsBounds(o)){var n=this.restrictedExtent.getCenterLonLat();o.getWidth()>this.restrictedExtent.getWidth()?t=new OpenLayers.LonLat(n.lon,t.lat):o.left<this.restrictedExtent.left?t=t.add(this.restrictedExtent.left-o.left,0):o.right>this.restrictedExtent.right&&(t=t.add(this.restrictedExtent.right-o.right,0));o.getHeight()>this.restrictedExtent.getHeight()?t=new OpenLayers.LonLat(t.lon,n.lat):o.bottom<this.restrictedExtent.bottom?t=t.add(0,this.restrictedExtent.bottom-o.bottom):o.top>this.restrictedExtent.top&&(t=t.add(0,this.restrictedExtent.top-o.top))}}p=p||this.isValidZoomLevel(s)&&s!=this.getZoom();o=this.isValidLonLat(t)&&!t.equals(this.center);if(p||o||q){q||this.events.triggerEvent("movestart");o&&(!p&&this.center&&this.centerLayerContainer(t),this.center=t.clone());t=p?this.getResolutionForZoom(s):this.getResolution();if(p||null==this.layerContainerOrigin){this.layerContainerOrigin=this.getCachedCenter();this.layerContainerDiv.style.left="0px";this.layerContainerDiv.style.top="0px";var o=this.getMaxExtent({restricted:!0}),m=o.getCenterLonLat(),n=this.center.lon-m.lon,m=m.lat-this.center.lat,l=Math.round(o.getWidth()/t),k=Math.round(o.getHeight()/t);this.minPx={x:(this.size.w-l)/2-n/t,y:(this.size.h-k)/2-m/t};this.maxPx={x:this.minPx.x+Math.round(o.getWidth()/t),y:this.minPx.y+Math.round(o.getHeight()/t)}}p&&(this.zoom=s,this.resolution=t);t=this.getExtent();this.baseLayer.visibility&&(this.baseLayer.moveTo(t,p,r.dragging),r.dragging||this.baseLayer.events.triggerEvent("moveend",{zoomChanged:p}));t=this.baseLayer.getExtent();for(s=this.layers.length-1;0<=s;--s){if(o=this.layers[s],o!==this.baseLayer&&!o.isBaseLayer&&(n=o.calculateInRange(),o.inRange!=n&&((o.inRange=n)||o.display(!1),this.events.triggerEvent("changelayer",{layer:o,property:"visibility"})),n&&o.visibility)){o.moveTo(t,p,r.dragging),r.dragging||o.events.triggerEvent("moveend",{zoomChanged:p})}}this.events.triggerEvent("move");q||this.events.triggerEvent("moveend");if(p){s=0;for(r=this.popups.length;s<r;s++){this.popups[s].updatePosition()}this.events.triggerEvent("zoomend")}}},centerLayerContainer:function(g){var f=this.getViewPortPxFromLonLat(this.layerContainerOrigin),j=this.getViewPortPxFromLonLat(g);if(null!=f&&null!=j){var i=parseInt(this.layerContainerDiv.style.left),g=parseInt(this.layerContainerDiv.style.top),h=Math.round(f.x-j.x),f=Math.round(f.y-j.y);this.layerContainerDiv.style.left=h+"px";this.layerContainerDiv.style.top=f+"px";i-=h;g-=f;this.minPx.x-=i;this.maxPx.x-=i;this.minPx.y-=g;this.maxPx.y-=g}},isValidZoomLevel:function(b){return null!=b&&0<=b&&b<this.getNumZoomLevels()},isValidLonLat:function(d){var c=!1;null!=d&&(c=this.getMaxExtent(),c=c.containsLonLat(d,{worldBounds:this.baseLayer.wrapDateLine&&c}));return c},getProjection:function(){var b=this.getProjectionObject();return b?b.getCode():null},getProjectionObject:function(){var b=null;null!=this.baseLayer&&(b=this.baseLayer.projection);return b},getMaxResolution:function(){var b=null;null!=this.baseLayer&&(b=this.baseLayer.maxResolution);return b},getMaxExtent:function(d){var c=null;d&&d.restricted&&this.restrictedExtent?c=this.restrictedExtent:null!=this.baseLayer&&(c=this.baseLayer.maxExtent);return c},getNumZoomLevels:function(){var b=null;null!=this.baseLayer&&(b=this.baseLayer.numZoomLevels);return b},getExtent:function(){var b=null;null!=this.baseLayer&&(b=this.baseLayer.getExtent());return b},getResolution:function(){var b=null;null!=this.baseLayer?b=this.baseLayer.getResolution():!0===this.allOverlays&&0<this.layers.length&&(b=this.layers[0].getResolution());return b},getUnits:function(){var b=null;null!=this.baseLayer&&(b=this.baseLayer.units);return b},getScale:function(){var b=null;null!=this.baseLayer&&(b=this.getResolution(),b=OpenLayers.Util.getScaleFromResolution(b,this.baseLayer.units));return b},getZoomForExtent:function(e,d){var f=null;null!=this.baseLayer&&(f=this.baseLayer.getZoomForExtent(e,d));return f},getResolutionForZoom:function(d){var c=null;this.baseLayer&&(c=this.baseLayer.getResolutionForZoom(d));return c},getZoomForResolution:function(e,d){var f=null;null!=this.baseLayer&&(f=this.baseLayer.getZoomForResolution(e,d));return f},zoomTo:function(b){this.isValidZoomLevel(b)&&this.setCenter(null,b)},zoomIn:function(){this.zoomTo(this.getZoom()+1)},zoomOut:function(){this.zoomTo(this.getZoom()-1)},zoomToExtent:function(e,d){e instanceof OpenLayers.Bounds||(e=new OpenLayers.Bounds(e));var f=e.getCenterLonLat();if(this.baseLayer.wrapDateLine){f=this.getMaxExtent();for(e=e.clone();e.right<e.left;){e.right+=f.getWidth()}f=e.getCenterLonLat().wrapDateLine(f)}this.setCenter(f,this.getZoomForExtent(e,d))},zoomToMaxExtent:function(b){this.zoomToExtent(this.getMaxExtent({restricted:b?b.restricted:!0}))},zoomToScale:function(g,f){var j=OpenLayers.Util.getResolutionFromScale(g,this.baseLayer.units),i=this.size.w*j/2,j=this.size.h*j/2,h=this.getCachedCenter();this.zoomToExtent(new OpenLayers.Bounds(h.lon-i,h.lat-j,h.lon+i,h.lat+j),f)},getLonLatFromViewPortPx:function(d){var c=null;null!=this.baseLayer&&(c=this.baseLayer.getLonLatFromViewPortPx(d));return c},getViewPortPxFromLonLat:function(d){var c=null;null!=this.baseLayer&&(c=this.baseLayer.getViewPortPxFromLonLat(d));return c},getLonLatFromPixel:function(b){return this.getLonLatFromViewPortPx(b)},getPixelFromLonLat:function(b){b=this.getViewPortPxFromLonLat(b);b.x=Math.round(b.x);b.y=Math.round(b.y);return b},getGeodesicPixelSize:function(h){var g=h?this.getLonLatFromPixel(h):this.getCachedCenter()||new OpenLayers.LonLat(0,0),l=this.getResolution(),h=g.add(-l/2,0),k=g.add(l/2,0),j=g.add(0,-l/2),g=g.add(0,l/2),l=new OpenLayers.Projection("EPSG:4326"),i=this.getProjectionObject()||l;i.equals(l)||(h.transform(i,l),k.transform(i,l),j.transform(i,l),g.transform(i,l));return new OpenLayers.Size(OpenLayers.Util.distVincenty(h,k),OpenLayers.Util.distVincenty(j,g))},getViewPortPxFromLayerPx:function(e){var d=null;if(null!=e){var d=parseInt(this.layerContainerDiv.style.left),f=parseInt(this.layerContainerDiv.style.top),d=e.add(d,f)}return d},getLayerPxFromViewPortPx:function(e){var d=null;if(null!=e){var d=-parseInt(this.layerContainerDiv.style.left),f=-parseInt(this.layerContainerDiv.style.top),d=e.add(d,f);if(isNaN(d.x)||isNaN(d.y)){d=null}}return d},getLonLatFromLayerPx:function(b){b=this.getViewPortPxFromLayerPx(b);return this.getLonLatFromViewPortPx(b)},getLayerPxFromLonLat:function(b){return this.getLayerPxFromViewPortPx(this.getPixelFromLonLat(b))},CLASS_NAME:"OpenLayers.Map"});OpenLayers.Map.TILE_WIDTH=256;OpenLayers.Map.TILE_HEIGHT=256;OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:1,alwaysInRange:null,RESOLUTION_PROPERTIES:"scales resolutions maxScale minScale maxResolution minResolution numZoomLevels maxZoomLevel".split(" "),events:null,map:null,isBaseLayer:!1,alpha:!1,displayInLayerSwitcher:!0,visibility:!0,attribution:null,inRange:!1,imageSize:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:!1,wrapDateLine:!1,metadata:null,initialize:function(d,c){this.metadata={};this.addOptions(c);this.name=d;if(null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"),this.div=OpenLayers.Util.createDiv(this.id),this.div.style.width="100%",this.div.style.height="100%",this.div.dir="ltr",this.events=new OpenLayers.Events(this,this.div),this.eventListeners instanceof Object)){this.events.on(this.eventListeners)}},destroy:function(b){null==b&&(b=!0);null!=this.map&&this.map.removeLayer(this,b);this.options=this.div=this.name=this.map=this.projection=null;this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy());this.events=this.eventListeners=null},clone:function(b){null==b&&(b=new OpenLayers.Layer(this.name,this.getOptions()));OpenLayers.Util.applyDefaults(b,this);b.map=null;return b},getOptions:function(){var d={},c;for(c in this.options){d[c]=this[c]}return d},setName:function(b){b!=this.name&&(this.name=b,null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"name"}))},addOptions:function(g,f){null==this.options&&(this.options={});if(g&&("string"==typeof g.projection&&(g.projection=new OpenLayers.Projection(g.projection)),g.projection&&OpenLayers.Util.applyDefaults(g,OpenLayers.Projection.defaults[g.projection.getCode()]),g.maxExtent&&!(g.maxExtent instanceof OpenLayers.Bounds)&&(g.maxExtent=new OpenLayers.Bounds(g.maxExtent)),g.minExtent&&!(g.minExtent instanceof OpenLayers.Bounds))){g.minExtent=new OpenLayers.Bounds(g.minExtent)}OpenLayers.Util.extend(this.options,g);OpenLayers.Util.extend(this,g);this.projection&&this.projection.getUnits()&&(this.units=this.projection.getUnits());if(this.map){var j=this.map.getResolution(),i=this.RESOLUTION_PROPERTIES.concat(["projection","units","minExtent","maxExtent"]),h;for(h in g){if(g.hasOwnProperty(h)&&0<=OpenLayers.Util.indexOf(i,h)){this.initResolutions();f&&this.map.baseLayer===this&&(this.map.setCenter(this.map.getCenter(),this.map.getZoomForResolution(j),!1,!0),this.map.events.triggerEvent("changebaselayer",{layer:this}));break}}}},onMapResize:function(){},redraw:function(){var d=!1;if(this.map){this.inRange=this.calculateInRange();var c=this.getExtent();c&&(this.inRange&&this.visibility)&&(this.moveTo(c,!0,!1),this.events.triggerEvent("moveend",{zoomChanged:!0}),d=!0)}return d},moveTo:function(){var b=this.visibility;this.isBaseLayer||(b=b&&this.inRange);this.display(b)},moveByPx:function(){},setMap:function(b){null==this.map&&(this.map=b,this.maxExtent=this.maxExtent||this.map.maxExtent,this.minExtent=this.minExtent||this.map.minExtent,this.projection=this.projection||this.map.projection,"string"==typeof this.projection&&(this.projection=new OpenLayers.Projection(this.projection)),this.units=this.projection.getUnits()||this.units||this.map.units,this.initResolutions(),this.isBaseLayer||(this.inRange=this.calculateInRange(),this.div.style.display=this.visibility&&this.inRange?"":"none"),this.setTileSize())},afterAdd:function(){},removeMap:function(){},getImageSize:function(){return this.imageSize||this.tileSize},setTileSize:function(b){this.tileSize=b=b?b:this.tileSize?this.tileSize:this.map.getTileSize();this.gutter&&(this.imageSize=new OpenLayers.Size(b.w+2*this.gutter,b.h+2*this.gutter))},getVisibility:function(){return this.visibility},setVisibility:function(b){b!=this.visibility&&(this.visibility=b,this.display(b),this.redraw(),null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"}),this.events.triggerEvent("visibilitychanged"))},display:function(b){b!=("none"!=this.div.style.display)&&(this.div.style.display=b&&this.calculateInRange()?"block":"none")},calculateInRange:function(){var b=!1;this.alwaysInRange?b=!0:this.map&&(b=this.map.getResolution(),b=b>=this.minResolution&&b<=this.maxResolution);return b},setIsBaseLayer:function(b){b!=this.isBaseLayer&&(this.isBaseLayer=b,null!=this.map&&this.map.events.triggerEvent("changebaselayer",{layer:this}))},initResolutions:function(){var i,h,n,m={},l=!0;i=0;for(h=this.RESOLUTION_PROPERTIES.length;i<h;i++){n=this.RESOLUTION_PROPERTIES[i],m[n]=this.options[n],l&&this.options[n]&&(l=!1)}null==this.alwaysInRange&&(this.alwaysInRange=l);null==m.resolutions&&(m.resolutions=this.resolutionsFromScales(m.scales));null==m.resolutions&&(m.resolutions=this.calculateResolutions(m));if(null==m.resolutions){i=0;for(h=this.RESOLUTION_PROPERTIES.length;i<h;i++){n=this.RESOLUTION_PROPERTIES[i],m[n]=null!=this.options[n]?this.options[n]:this.map[n]}null==m.resolutions&&(m.resolutions=this.resolutionsFromScales(m.scales));null==m.resolutions&&(m.resolutions=this.calculateResolutions(m))}var k;this.options.maxResolution&&"auto"!==this.options.maxResolution&&(k=this.options.maxResolution);this.options.minScale&&(k=OpenLayers.Util.getResolutionFromScale(this.options.minScale,this.units));var j;this.options.minResolution&&"auto"!==this.options.minResolution&&(j=this.options.minResolution);this.options.maxScale&&(j=OpenLayers.Util.getResolutionFromScale(this.options.maxScale,this.units));m.resolutions&&(m.resolutions.sort(function(d,c){return c-d}),k||(k=m.resolutions[0]),j||(j=m.resolutions[m.resolutions.length-1]));if(this.resolutions=m.resolutions){h=this.resolutions.length;this.scales=Array(h);for(i=0;i<h;i++){this.scales[i]=OpenLayers.Util.getScaleFromResolution(this.resolutions[i],this.units)}this.numZoomLevels=h}if(this.minResolution=j){this.maxScale=OpenLayers.Util.getScaleFromResolution(j,this.units)}if(this.maxResolution=k){this.minScale=OpenLayers.Util.getScaleFromResolution(k,this.units)}},resolutionsFromScales:function(f){if(null!=f){var e,h,g;g=f.length;e=Array(g);for(h=0;h<g;h++){e[h]=OpenLayers.Util.getResolutionFromScale(f[h],this.units)}return e}},calculateResolutions:function(h){var g,l,k=h.maxResolution;null!=h.minScale?k=OpenLayers.Util.getResolutionFromScale(h.minScale,this.units):"auto"==k&&null!=this.maxExtent&&(g=this.map.getSize(),l=this.maxExtent.getWidth()/g.w,g=this.maxExtent.getHeight()/g.h,k=Math.max(l,g));l=h.minResolution;null!=h.maxScale?l=OpenLayers.Util.getResolutionFromScale(h.maxScale,this.units):"auto"==h.minResolution&&null!=this.minExtent&&(g=this.map.getSize(),l=this.minExtent.getWidth()/g.w,g=this.minExtent.getHeight()/g.h,l=Math.max(l,g));"number"!==typeof k&&("number"!==typeof l&&null!=this.maxExtent)&&(k=this.map.getTileSize(),k=Math.max(this.maxExtent.getWidth()/k.w,this.maxExtent.getHeight()/k.h));g=h.maxZoomLevel;h=h.numZoomLevels;"number"===typeof l&&"number"===typeof k&&void 0===h?h=Math.floor(Math.log(k/l)/Math.log(2))+1:void 0===h&&null!=g&&(h=g+1);if(!("number"!==typeof h||0>=h||"number"!==typeof k&&"number"!==typeof l)){g=Array(h);var j=2;"number"==typeof l&&"number"==typeof k&&(j=Math.pow(k/l,1/(h-1)));var i;if("number"===typeof k){for(i=0;i<h;i++){g[i]=k/Math.pow(j,i)}}else{for(i=0;i<h;i++){g[h-1-i]=l*Math.pow(j,i)}}return g}},getResolution:function(){return this.getResolutionForZoom(this.map.getZoom())},getExtent:function(){return this.map.calculateBounds()},getZoomForExtent:function(e,d){var f=this.map.getSize();return this.getZoomForResolution(Math.max(e.getWidth()/f.w,e.getHeight()/f.h),d)},getDataExtent:function(){},getResolutionForZoom:function(e){e=Math.max(0,Math.min(e,this.resolutions.length-1));if(this.map.fractionalZoom){var d=Math.floor(e),f=Math.ceil(e),e=this.resolutions[d]-(e-d)*(this.resolutions[d]-this.resolutions[f])}else{e=this.resolutions[Math.round(e)]}return e},getZoomForResolution:function(j,i){var p,o;if(this.map.fractionalZoom){var n=0,m=this.resolutions[n],l=this.resolutions[this.resolutions.length-1],k;p=0;for(o=this.resolutions.length;p<o;++p){if(k=this.resolutions[p],k>=j&&(m=k,n=p),k<=j){l=k;break}}p=m-l;p=0<p?n+(m-j)/p:n}else{m=Number.POSITIVE_INFINITY;p=0;for(o=this.resolutions.length;p<o;p++){if(i){n=Math.abs(this.resolutions[p]-j);if(n>m){break}m=n}else{if(this.resolutions[p]<j){break}}}p=Math.max(0,p-1)}return p},getLonLatFromViewPortPx:function(f){var e=null,h=this.map;if(null!=f&&h.minPx){var e=h.getResolution(),g=h.getMaxExtent({restricted:!0}),e=new OpenLayers.LonLat((f.x-h.minPx.x)*e+g.left,(h.minPx.y-f.y)*e+g.top);this.wrapDateLine&&(e=e.wrapDateLine(this.maxExtent))}return e},getViewPortPxFromLonLat:function(e,d){var f=null;null!=e&&(d=d||this.map.getResolution(),f=this.map.calculateBounds(null,d),f=new OpenLayers.Pixel(1/d*(e.lon-f.left),1/d*(f.top-e.lat)));return f},setOpacity:function(h){if(h!=this.opacity){this.opacity=h;for(var g=this.div.childNodes,l=0,k=g.length;l<k;++l){var j=g[l].firstChild||g[l],i=g[l].lastChild;i&&"iframe"===i.nodeName.toLowerCase()&&(j=i.parentNode);OpenLayers.Util.modifyDOMElement(j,null,null,null,null,null,null,h)}null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})}},getZIndex:function(){return this.div.style.zIndex},setZIndex:function(b){this.div.style.zIndex=b},adjustBounds:function(d){if(this.gutter){var c=this.gutter*this.map.getResolution(),d=new OpenLayers.Bounds(d.left-c,d.bottom-c,d.right+c,d.top+c)}this.wrapDateLine&&(c={rightTolerance:this.getResolution(),leftTolerance:this.getResolution()},d=d.wrapDateLine(this.maxExtent,c));return d},CLASS_NAME:"OpenLayers.Layer"});OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:!1,initialize:function(f,e,h,g){OpenLayers.Layer.prototype.initialize.apply(this,[f,g]);this.url=e;this.params||(this.params=OpenLayers.Util.extend({},h))},destroy:function(){this.params=this.url=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(b){null==b&&(b=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.getOptions()));return b=OpenLayers.Layer.prototype.clone.apply(this,[b])},setUrl:function(b){this.url=b},mergeNewParams:function(b){this.params=OpenLayers.Util.extend(this.params,b);b=this.redraw();null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"params"});return b},redraw:function(b){return b?this.mergeNewParams({_olSalt:Math.random()}):OpenLayers.Layer.prototype.redraw.apply(this,[])},selectUrl:function(g,f){for(var j=1,i=0,h=g.length;i<h;i++){j*=g.charCodeAt(i)*this.URL_HASH_FACTOR,j-=Math.floor(j)}return f[Math.floor(j*f.length)]},getFullRequestString:function(h,g){var l=g||this.url,k=OpenLayers.Util.extend({},this.params),k=OpenLayers.Util.extend(k,h),j=OpenLayers.Util.getParameterString(k);OpenLayers.Util.isArray(l)&&(l=this.selectUrl(j,l));var j=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(l)),i;for(i in k){i.toUpperCase() in j&&delete k[i]}j=OpenLayers.Util.getParameterString(k);return OpenLayers.Util.urlAppend(l,j)},CLASS_NAME:"OpenLayers.Layer.HTTPRequest"});OpenLayers.Tile=OpenLayers.Class({events:null,eventListeners:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:!1,initialize:function(h,g,l,k,j,i){this.layer=h;this.position=g.clone();this.setBounds(l);this.url=k;j&&(this.size=j.clone());this.id=OpenLayers.Util.createUniqueID("Tile_");OpenLayers.Util.extend(this,i);this.events=new OpenLayers.Events(this);if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}},unload:function(){this.isLoading&&(this.isLoading=!1,this.events.triggerEvent("unload"))},destroy:function(){this.position=this.size=this.bounds=this.layer=null;this.eventListeners&&this.events.un(this.eventListeners);this.events.destroy();this.events=this.eventListeners=null},draw:function(d){d||this.clear();var c=this.shouldDraw();c&&!d&&(c=!1!==this.events.triggerEvent("beforedraw"));return c},shouldDraw:function(){var e=!1,d=this.layer.maxExtent;if(d){var f=this.layer.map,f=f.baseLayer.wrapDateLine&&f.getMaxExtent();this.bounds.intersectsBounds(d,{inclusive:!1,worldBounds:f})&&(e=!0)}return e||this.layer.displayOutsideMaxExtent},setBounds:function(e){e=e.clone();if(this.layer.map.baseLayer.wrapDateLine){var d=this.layer.map.getMaxExtent(),f=this.layer.map.getResolution(),e=e.wrapDateLine(d,{leftTolerance:f,rightTolerance:f})}this.bounds=e},moveTo:function(e,d,f){null==f&&(f=!0);this.setBounds(e);this.position=d.clone();f&&this.draw()},clear:function(){},CLASS_NAME:"OpenLayers.Tile"});OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,{url:null,imgDiv:null,frame:null,imageReloadAttempts:null,layerAlphaHack:null,asyncRequestId:null,blankImageUrl:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAQAIBRAA7",maxGetUrlLength:null,canvasContext:null,crossOriginKeyword:null,initialize:function(h,g,l,k,j,i){OpenLayers.Tile.prototype.initialize.apply(this,arguments);this.url=k;this.layerAlphaHack=this.layer.alpha&&OpenLayers.Util.alphaHack();if(null!=this.maxGetUrlLength||this.layer.gutter||this.layerAlphaHack){this.frame=document.createElement("div"),this.frame.style.position="absolute",this.frame.style.overflow="hidden"}null!=this.maxGetUrlLength&&OpenLayers.Util.extend(this,OpenLayers.Tile.Image.IFrame)},destroy:function(){this.imgDiv&&(this.clear(),this.frame=this.imgDiv=null);this.asyncRequestId=null;OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var b=OpenLayers.Tile.prototype.draw.apply(this,arguments);b?(this.layer!=this.layer.map.baseLayer&&this.layer.reproject&&(this.bounds=this.getBoundsFromBaseLayer(this.position)),this.isLoading?this._loadEvent="reload":(this.isLoading=!0,this._loadEvent="loadstart"),this.positionTile(),this.renderTile()):this.unload();return b},renderTile:function(){this.layer.div.appendChild(this.getTile());if(this.layer.async){var b=this.asyncRequestId=(this.asyncRequestId||0)+1;this.layer.getURLasync(this.bounds,function(a){b==this.asyncRequestId&&(this.url=a,this.initImage())},this)}else{this.url=this.layer.getURL(this.bounds),this.initImage()}},positionTile:function(){var d=this.getTile().style,c=this.frame?this.size:this.layer.getImageSize(this.bounds);d.left=this.position.x+"%";d.top=this.position.y+"%";d.width=c.w+"%";d.height=c.h+"%"},clear:function(){OpenLayers.Tile.prototype.clear.apply(this,arguments);var d=this.imgDiv;if(d){OpenLayers.Event.stopObservingElement(d);var c=this.getTile();c.parentNode===this.layer.div&&this.layer.div.removeChild(c);this.setImgSrc();!0===this.layerAlphaHack&&(d.style.filter="");OpenLayers.Element.removeClass(d,"olImageLoadError")}this.canvasContext=null},getImage:function(){if(!this.imgDiv){this.imgDiv=document.createElement("img");this.imgDiv.className="olTileImage";this.imgDiv.galleryImg="no";var e=this.imgDiv.style;if(this.frame){var d=0,f=0;this.layer.gutter&&(d=100*(this.layer.gutter/this.layer.tileSize.w),f=100*(this.layer.gutter/this.layer.tileSize.h));e.left=-d+"%";e.top=-f+"%";e.width=2*d+100+"%";e.height=2*f+100+"%"}e.visibility="hidden";e.opacity=0;1>this.layer.opacity&&(e.filter="alpha(opacity="+100*this.layer.opacity+")");e.position="absolute";this.layerAlphaHack&&(e.paddingTop=e.height,e.height="0",e.width="100%");this.frame&&this.frame.appendChild(this.imgDiv)}return this.imgDiv},initImage:function(){this.events.triggerEvent(this._loadEvent);var d=this.getImage();if(this.url&&d.getAttribute("src")==this.url){this.onImageLoad()}else{var c=OpenLayers.Function.bind(function(){OpenLayers.Event.stopObservingElement(d);OpenLayers.Event.observe(d,"load",OpenLayers.Function.bind(this.onImageLoad,this));OpenLayers.Event.observe(d,"error",OpenLayers.Function.bind(this.onImageError,this));this.imageReloadAttempts=0;this.setImgSrc(this.url)},this);d.getAttribute("src")==this.blankImageUrl?c():(OpenLayers.Event.observe(d,"load",c),OpenLayers.Event.observe(d,"error",c),this.crossOriginKeyword&&d.removeAttribute("crossorigin"),d.src=this.blankImageUrl)}},setImgSrc:function(d){var c=this.imgDiv;c.style.visibility="hidden";c.style.opacity=0;d&&(this.crossOriginKeyword&&("data:"!==d.substr(0,5)?c.setAttribute("crossorigin",this.crossOriginKeyword):c.removeAttribute("crossorigin")),c.src=d)},getTile:function(){return this.frame?this.frame:this.getImage()},createBackBuffer:function(){if(this.imgDiv&&!this.isLoading){var b;this.frame?(b=this.frame.cloneNode(!1),b.appendChild(this.imgDiv)):b=this.imgDiv;this.imgDiv=null;return b}},onImageLoad:function(){var e=this.imgDiv;OpenLayers.Event.stopObservingElement(e);e.style.visibility="inherit";e.style.opacity=this.layer.opacity;this.isLoading=!1;this.canvasContext=null;this.events.triggerEvent("loadend");if(7>parseFloat(navigator.appVersion.split("MSIE")[1])&&this.layer&&this.layer.div){var d=document.createElement("span");d.style.display="none";var f=this.layer.div;f.appendChild(d);window.setTimeout(function(){d.parentNode===f&&d.parentNode.removeChild(d)},0)}!0===this.layerAlphaHack&&(e.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+e.src+"', sizingMethod='scale')")},onImageError:function(){var b=this.imgDiv;null!=b.src&&(this.imageReloadAttempts++,this.imageReloadAttempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS?this.setImgSrc(this.layer.getURL(this.bounds)):(OpenLayers.Element.addClass(b,"olImageLoadError"),this.events.triggerEvent("loaderror"),this.onImageLoad()))},getCanvasContext:function(){if(OpenLayers.CANVAS_SUPPORTED&&this.imgDiv&&!this.isLoading){if(!this.canvasContext){var b=document.createElement("canvas");b.width=this.size.w;b.height=this.size.h;this.canvasContext=b.getContext("2d");this.canvasContext.drawImage(this.imgDiv,0,0)}return this.canvasContext}},CLASS_NAME:"OpenLayers.Tile.Image"});OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,tileOriginCorner:"bl",tileOrigin:null,tileOptions:null,tileClass:OpenLayers.Tile.Image,grid:null,singleTile:!1,ratio:1.5,buffer:0,transitionEffect:null,numLoadingTiles:0,tileLoadingDelay:85,serverResolutions:null,moveTimerId:null,deferMoveGriddedTiles:null,tileQueueId:null,tileQueue:null,loading:!1,backBuffer:null,gridResolution:null,backBufferResolution:null,backBufferLonLat:null,backBufferTimerId:null,removeBackBufferDelay:null,className:null,initialize:function(f,e,h,g){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments);this.grid=[];this.tileQueue=[];null===this.removeBackBufferDelay&&(this.removeBackBufferDelay=this.singleTile?0:2500);null===this.className&&(this.className=this.singleTile?"olLayerGridSingleTile":"olLayerGrid");OpenLayers.Animation.isNative||(this.deferMoveGriddedTiles=OpenLayers.Function.bind(function(){this.moveGriddedTiles(true);this.moveTimerId=null},this))},setMap:function(b){OpenLayers.Layer.HTTPRequest.prototype.setMap.call(this,b);OpenLayers.Element.addClass(this.div,this.className)},removeMap:function(){null!==this.moveTimerId&&(window.clearTimeout(this.moveTimerId),this.moveTimerId=null);this.clearTileQueue();null!==this.backBufferTimerId&&(window.clearTimeout(this.backBufferTimerId),this.backBufferTimerId=null)},destroy:function(){this.removeBackBuffer();this.clearGrid();this.tileSize=this.grid=null;OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)},clearGrid:function(){this.clearTileQueue();if(this.grid){for(var g=0,f=this.grid.length;g<f;g++){for(var j=this.grid[g],i=0,h=j.length;i<h;i++){this.destroyTile(j[i])}}this.grid=[];this.gridResolution=null}},clone:function(b){null==b&&(b=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.getOptions()));b=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[b]);null!=this.tileSize&&(b.tileSize=this.tileSize.clone());b.grid=[];b.gridResolution=null;b.backBuffer=null;b.backBufferTimerId=null;b.tileQueue=[];b.tileQueueId=null;b.loading=!1;b.moveTimerId=null;return b},moveTo:function(i,h,n){OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments);i=i||this.map.getExtent();if(null!=i){var m=!this.grid.length||h,l=this.getTilesBounds(),k=this.map.getResolution(),j=this.getServerResolution(k);if(this.singleTile){if(m||!n&&!l.containsBounds(i)){h&&"resize"!==this.transitionEffect&&this.removeBackBuffer(),(!h||"resize"===this.transitionEffect)&&this.applyBackBuffer(j),this.initSingleTile(i)}}else{(m=m||!l.intersectsBounds(i,{worldBounds:this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent()}),k!==j?(i=this.map.calculateBounds(null,j),m&&this.transformDiv(j/k)):(this.div.style.width="100%",this.div.style.height="100%",this.div.style.left="0%",this.div.style.top="0%"),m)?(h&&"resize"===this.transitionEffect&&this.applyBackBuffer(j),this.initGriddedTiles(i)):this.moveGriddedTiles()}}},getTileData:function(v){var u=null,t=v.lon,s=v.lat,r=this.grid.length;if(this.map&&r){var q=this.map.getResolution(),v=this.tileSize.w,p=this.tileSize.h,o=this.grid[0][0].bounds,n=o.left,o=o.top;if(t<n&&this.map.baseLayer.wrapDateLine){var m=this.map.getMaxExtent().getWidth(),l=Math.ceil((n-t)/m),t=t+m*l}t=(t-n)/(q*v);s=(o-s)/(q*p);q=Math.floor(t);n=Math.floor(s);0<=n&&n<r&&(r=this.grid[n][q])&&(u={tile:r,i:Math.floor((t-q)*v),j:Math.floor((s-n)*p)})}return u},queueTileDraw:function(b){b=b.object;~OpenLayers.Util.indexOf(this.tileQueue,b)||this.tileQueue.push(b);this.tileQueueId||(this.tileQueueId=OpenLayers.Animation.start(OpenLayers.Function.bind(this.drawTileFromQueue,this),null,this.div));return !1},drawTileFromQueue:function(){0===this.tileQueue.length?this.clearTileQueue():this.tileQueue.shift().draw(!0)},clearTileQueue:function(){OpenLayers.Animation.stop(this.tileQueueId);this.tileQueueId=null;this.tileQueue=[]},destroyTile:function(b){this.removeTileMonitoringHooks(b);b.destroy()},getServerResolution:function(e){e=e||this.map.getResolution();if(this.serverResolutions&&-1===OpenLayers.Util.indexOf(this.serverResolutions,e)){var d,f;for(d=this.serverResolutions.length-1;0<=d;d--){if(f=this.serverResolutions[d],f>e){e=f;break}}if(-1===d){throw"no appropriate resolution in serverResolutions"}}return e},getServerZoom:function(){var b=this.getServerResolution();return this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,b):this.map.getZoomForResolution(b)+(this.zoomOffset||0)},transformDiv:function(f){this.div.style.width=100*f+"%";this.div.style.height=100*f+"%";var e=this.map.getSize(),h=parseInt(this.map.layerContainerDiv.style.left,10),g=(parseInt(this.map.layerContainerDiv.style.top,10)-e.h/2)*(f-1);this.div.style.left=(h-e.w/2)*(f-1)+"%";this.div.style.top=g+"%"},getResolutionScale:function(){return parseInt(this.div.style.width,10)/100},applyBackBuffer:function(f){null!==this.backBufferTimerId&&this.removeBackBuffer();var e=this.backBuffer;if(!e){e=this.createBackBuffer();if(!e){return}this.div.insertBefore(e,this.div.firstChild);this.backBuffer=e;var h=this.grid[0][0].bounds;this.backBufferLonLat={lon:h.left,lat:h.top};this.backBufferResolution=this.gridResolution}var h=e.style,g=this.backBufferResolution/f;h.width=100*g+"%";h.height=100*g+"%";f=this.getViewPortPxFromLonLat(this.backBufferLonLat,f);h=parseInt(this.map.layerContainerDiv.style.left,10);g=parseInt(this.map.layerContainerDiv.style.top,10);e.style.left=Math.round(f.x-h)+"%";e.style.top=Math.round(f.y-g)+"%"},createBackBuffer:function(){var h;if(0<this.grid.length){h=document.createElement("div");h.id=this.div.id+"_bb";h.className="olBackBuffer";h.style.position="absolute";h.style.width="100%";h.style.height="100%";for(var g=0,l=this.grid.length;g<l;g++){for(var k=0,j=this.grid[g].length;k<j;k++){var i=this.grid[g][k].createBackBuffer();i&&(i.style.top=g*this.tileSize.h+"%",i.style.left=k*this.tileSize.w+"%",h.appendChild(i))}}}return h},removeBackBuffer:function(){this.backBuffer&&(this.div.removeChild(this.backBuffer),this.backBufferResolution=this.backBuffer=null,null!==this.backBufferTimerId&&(window.clearTimeout(this.backBufferTimerId),this.backBufferTimerId=null))},moveByPx:function(){this.singleTile||this.moveGriddedTiles()},setTileSize:function(b){this.singleTile&&(b=this.map.getSize(),b.h=parseInt(b.h*this.ratio),b.w=parseInt(b.w*this.ratio));OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[b])},getTilesBounds:function(){var e=null,d=this.grid.length;if(d){var e=this.grid[d-1][0].bounds,d=this.grid[0].length*e.getWidth(),f=this.grid.length*e.getHeight(),e=new OpenLayers.Bounds(e.left,e.bottom,e.left+d,e.bottom+f)}return e},initSingleTile:function(e){this.clearTileQueue();var d=e.getCenterLonLat(),f=e.getWidth()*this.ratio,e=e.getHeight()*this.ratio,d=new OpenLayers.Bounds(d.lon-f/2,d.lat-e/2,d.lon+f/2,d.lat+e/2),f=this.map.getLayerPxFromLonLat({lon:d.left,lat:d.top});this.grid.length||(this.grid[0]=[]);(e=this.grid[0][0])?e.moveTo(d,f):(e=this.addTile(d,f),this.addTileMonitoringHooks(e),e.draw(),this.grid[0][0]=e);this.removeExcessTiles(1,1);this.gridResolution=this.getServerResolution()},calculateGridLayout:function(i,h,n){var m=n*this.tileSize.w,n=n*this.tileSize.h,l=i.left-h.lon,k=Math.floor(l/m)-this.buffer,l=-(l/m-k)*this.tileSize.w,k=h.lon+k*m,i=i.top-(h.lat+n),j=Math.ceil(i/n)+this.buffer;return{tilelon:m,tilelat:n,tileoffsetlon:k,tileoffsetlat:h.lat+j*n,tileoffsetx:l,tileoffsety:-(j-i/n)*this.tileSize.h}},getTileOrigin:function(){var d=this.tileOrigin;if(!d){var d=this.getMaxExtent(),c={tl:["left","top"],tr:["right","top"],bl:["left","bottom"],br:["right","bottom"]}[this.tileOriginCorner],d=new OpenLayers.LonLat(d[c[0]],d[c[1]])}return d},initGriddedTiles:function(P){this.clearTileQueue();var O=this.map.getSize(),N=Math.ceil(O.h/this.tileSize.h)+Math.max(1,2*this.buffer),O=Math.ceil(O.w/this.tileSize.w)+Math.max(1,2*this.buffer),M=this.getTileOrigin(),L=this.getServerResolution(),M=this.calculateGridLayout(P,M,L),L=Math.round(M.tileoffsetx),K=Math.round(M.tileoffsety),J=M.tileoffsetlon,I=M.tileoffsetlat,H=M.tilelon,G=M.tilelat,F=L,D=J,E=0,C=parseInt(this.map.layerContainerDiv.style.left),B=parseInt(this.map.layerContainerDiv.style.top),M=[],z=this.map.getCenter();do{var A=this.grid[E++];A||(A=[],this.grid.push(A));var J=D,L=F,y=0;do{var x=new OpenLayers.Bounds(J,I,J+H,I+G),w=L,w=w-C,v=K,v=v-B,v=new OpenLayers.Pixel(w,v);(w=A[y++])?w.moveTo(x,v,!1):(w=this.addTile(x,v),this.addTileMonitoringHooks(w),A.push(w));x=x.getCenterLonLat();M.push({tile:w,distance:Math.pow(x.lon-z.lon,2)+Math.pow(x.lat-z.lat,2)});J+=H;L+=this.tileSize.w}while(J<=P.right+H*this.buffer||y<O);I-=G;K+=this.tileSize.h}while(I>=P.bottom-G*this.buffer||E<N);this.removeExcessTiles(E,y);this.gridResolution=this.getServerResolution();M.sort(function(d,c){return d.distance-c.distance});P=0;for(N=M.length;P<N;++P){M[P].tile.draw()}},getMaxExtent:function(){return this.maxExtent},addTile:function(e,d){var f=new this.tileClass(this,d,e,null,this.tileSize,this.tileOptions);f.events.register("beforedraw",this,this.queueTileDraw);return f},addTileMonitoringHooks:function(b){b.onLoadStart=function(){!1===this.loading&&(this.loading=!0,this.events.triggerEvent("loadstart"));this.events.triggerEvent("tileloadstart",{tile:b});this.numLoadingTiles++};b.onLoadEnd=function(){this.numLoadingTiles--;this.events.triggerEvent("tileloaded",{tile:b});0===this.tileQueue.length&&0===this.numLoadingTiles&&(this.loading=!1,this.events.triggerEvent("loadend"),this.backBuffer&&(this.backBufferTimerId=window.setTimeout(OpenLayers.Function.bind(this.removeBackBuffer,this),this.removeBackBufferDelay)))};b.onLoadError=function(){this.events.triggerEvent("tileerror",{tile:b})};b.events.on({loadstart:b.onLoadStart,loadend:b.onLoadEnd,unload:b.onLoadEnd,loaderror:b.onLoadError,scope:this})},removeTileMonitoringHooks:function(b){b.unload();b.events.un({loadstart:b.onLoadStart,loadend:b.onLoadEnd,unload:b.onLoadEnd,loaderror:b.onLoadError,scope:this})},moveGriddedTiles:function(h){if(!h&&!OpenLayers.Animation.isNative){null!=this.moveTimerId&&window.clearTimeout(this.moveTimerId),this.moveTimerId=window.setTimeout(this.deferMoveGriddedTiles,this.tileLoadingDelay)}else{for(var h=this.buffer||1,g=this.getResolutionScale();;){var l=this.grid[0][0].position.x*g+parseInt(this.div.style.left,10)+parseInt(this.map.layerContainerDiv.style.left),k=this.grid[0][0].position.y*g+parseInt(this.div.style.top,10)+parseInt(this.map.layerContainerDiv.style.top),j=this.tileSize.w*g,i=this.tileSize.h*g;if(l>-j*(h-1)){this.shiftColumn(!0)}else{if(l<-j*h){this.shiftColumn(!1)}else{if(k>-i*(h-1)){this.shiftRow(!0)}else{if(k<-i*h){this.shiftRow(!1)}else{break}}}}}}},shiftRow:function(t){for(var s=this.grid,r=s[t?0:this.grid.length-1],q=this.getServerResolution(),p=t?-this.tileSize.h:this.tileSize.h,q=q*-p,o=t?s.pop():s.shift(),n=0,m=r.length;n<m;n++){var l=r[n],k=l.bounds.clone(),l=l.position.clone();k.bottom+=q;k.top+=q;l.y+=p;o[n].moveTo(k,l)}t?s.unshift(o):s.push(o)},shiftColumn:function(r){for(var q=r?-this.tileSize.w:this.tileSize.w,p=this.getServerResolution()*q,o=0,n=this.grid.length;o<n;o++){var m=this.grid[o],l=m[r?0:m.length-1],k=l.bounds.clone(),l=l.position.clone();k.left+=p;k.right+=p;l.x+=q;var j=r?this.grid[o].pop():this.grid[o].shift();j.moveTo(k,l);r?m.unshift(j):m.push(j)}},removeExcessTiles:function(h,g){for(var l,k;this.grid.length>h;){var j=this.grid.pop();l=0;for(k=j.length;l<k;l++){var i=j[l];this.destroyTile(i)}}l=0;for(k=this.grid.length;l<k;l++){for(;this.grid[l].length>g;){j=this.grid[l],i=j.pop(),this.destroyTile(i)}}},onMapResize:function(){this.singleTile&&(this.clearGrid(),this.setTileSize())},getTileBounds:function(g){var f=this.maxExtent,j=this.getResolution(),i=j*this.tileSize.w,j=j*this.tileSize.h,h=this.getLonLatFromViewPortPx(g),g=f.left+i*Math.floor((h.lon-f.left)/i),f=f.bottom+j*Math.floor((h.lat-f.bottom)/j);return new OpenLayers.Bounds(g,f,g+i,f+j)},CLASS_NAME:"OpenLayers.Layer.Grid"});OpenLayers.Layer.XYZ=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,sphericalMercator:!1,zoomOffset:0,serverResolutions:null,initialize:function(e,d,f){if(f&&f.sphericalMercator||this.sphericalMercator){f=OpenLayers.Util.extend({projection:"EPSG:900913",numZoomLevels:19},f)}OpenLayers.Layer.Grid.prototype.initialize.apply(this,[e||this.name,d||this.url,{},f])},clone:function(b){null==b&&(b=new OpenLayers.Layer.XYZ(this.name,this.url,this.getOptions()));return b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b])},getURL:function(d){var d=this.getXYZ(d),c=this.url;OpenLayers.Util.isArray(c)&&(c=this.selectUrl(""+d.x+d.y+d.z,c));return OpenLayers.String.format(c,d)},getXYZ:function(f){var e=this.getServerResolution(),h=Math.round((f.left-this.maxExtent.left)/(e*this.tileSize.w)),f=Math.round((this.maxExtent.top-f.top)/(e*this.tileSize.h)),e=this.getServerZoom();if(this.wrapDateLine){var g=Math.pow(2,e),h=(h%g+g)%g}return{x:h,y:f,z:e}},setMap:function(b){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.XYZ"});OpenLayers.Layer.OSM=OpenLayers.Class(OpenLayers.Layer.XYZ,{name:"OpenStreetMap",url:["http://a.tile.openstreetmap.org/${z}/${x}/${y}.png","http://b.tile.openstreetmap.org/${z}/${x}/${y}.png","http://c.tile.openstreetmap.org/${z}/${x}/${y}.png"],attribution:"Data CC-By-SA by <a href='http://openstreetmap.org/'>OpenStreetMap</a>",sphericalMercator:!0,wrapDateLine:!0,tileOptions:null,initialize:function(e,d,f){OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments);this.tileOptions=OpenLayers.Util.extend({crossOriginKeyword:"anonymous"},this.options&&this.options.tileOptions)},clone:function(b){null==b&&(b=new OpenLayers.Layer.OSM(this.name,this.url,this.getOptions()));return b=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[b])},CLASS_NAME:"OpenLayers.Layer.OSM"});OpenLayers.Renderer=OpenLayers.Class({container:null,root:null,extent:null,locked:!1,size:null,resolution:null,map:null,featureDx:0,initialize:function(d,c){this.container=OpenLayers.Util.getElement(d);OpenLayers.Util.extend(this,c)},destroy:function(){this.map=this.resolution=this.size=this.extent=this.container=null},supported:function(){return !1},setExtent:function(e,d){this.extent=e.clone();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var f=e.getWidth()/this.map.getExtent().getWidth(),e=e.scale(1/f);this.extent=e.wrapDateLine(this.map.getMaxExtent()).scale(f)}d&&(this.resolution=null);return !0},setSize:function(b){this.size=b.clone();this.resolution=null},getResolution:function(){return this.resolution=this.resolution||this.map.getResolution()},drawFeature:function(i,h){null==h&&(h=i.style);if(i.geometry){var n=i.geometry.getBounds();if(n){var m;this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(m=this.map.getMaxExtent());n.intersectsBounds(this.extent,{worldBounds:m})?this.calculateFeatureDx(n,m):h={display:"none"};n=this.drawGeometry(i.geometry,h,i.id);if("none"!=h.display&&h.label&&!1!==n){m=i.geometry.getCentroid();if(h.labelXOffset||h.labelYOffset){var l=isNaN(h.labelXOffset)?0:h.labelXOffset,k=isNaN(h.labelYOffset)?0:h.labelYOffset,j=this.getResolution();m.move(l*j,k*j)}this.drawText(i.id,h,m)}else{this.removeText(i.id)}return n}}},calculateFeatureDx:function(e,d){this.featureDx=0;if(d){var f=d.getWidth();this.featureDx=Math.round(((e.left+e.right)/2-(this.extent.left+this.extent.right)/2)/f)*f}},drawGeometry:function(){},drawText:function(){},removeText:function(){},clear:function(){},getFeatureIdFromEvent:function(){},eraseFeatures:function(f){OpenLayers.Util.isArray(f)||(f=[f]);for(var e=0,h=f.length;e<h;++e){var g=f[e];this.eraseGeometry(g.geometry,g.id);this.removeText(g.id)}},eraseGeometry:function(){},moveRoot:function(){},getRenderLayerId:function(){return this.container.id},applyDefaultSymbolizer:function(d){var c=OpenLayers.Util.extend({},OpenLayers.Renderer.defaultSymbolizer);!1===d.stroke&&(delete c.strokeWidth,delete c.strokeColor);!1===d.fill&&delete c.fillColor;OpenLayers.Util.extend(c,d);return c},CLASS_NAME:"OpenLayers.Renderer"});OpenLayers.Renderer.defaultSymbolizer={fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1,pointRadius:0,labelAlign:"cm"};OpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]};OpenLayers.Renderer.Canvas=OpenLayers.Class(OpenLayers.Renderer,{hitDetection:!0,hitOverflow:0,canvas:null,features:null,pendingRedraw:!1,cachedSymbolBounds:{},initialize:function(d,c){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.root=document.createElement("canvas");this.container.appendChild(this.root);this.canvas=this.root.getContext("2d");this.features={};this.hitDetection&&(this.hitCanvas=document.createElement("canvas"),this.hitContext=this.hitCanvas.getContext("2d"))},setExtent:function(){OpenLayers.Renderer.prototype.setExtent.apply(this,arguments);return !1},eraseGeometry:function(d,c){this.eraseFeatures(this.features[c][0])},supported:function(){return OpenLayers.CANVAS_SUPPORTED},setSize:function(d){this.size=d.clone();var c=this.root;c.style.width=d.w+"px";c.style.height=d.h+"px";c.width=d.w;c.height=d.h;this.resolution=null;this.hitDetection&&(c=this.hitCanvas,c.style.width=d.w+"px",c.style.height=d.h+"px",c.width=d.w,c.height=d.h)},drawFeature:function(f,e){var h;if(f.geometry){e=this.applyDefaultSymbolizer(e||f.style);h=f.geometry.getBounds();var g;this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(g=this.map.getMaxExtent());g=h&&h.intersectsBounds(this.extent,{worldBounds:g});(h="none"!==e.display&&!!h&&g)?this.features[f.id]=[f,e]:delete this.features[f.id];this.pendingRedraw=!0}this.pendingRedraw&&!this.locked&&(this.redraw(),this.pendingRedraw=!1);return h},drawGeometry:function(f,e,h){var g=f.CLASS_NAME;if("OpenLayers.Geometry.Collection"==g||"OpenLayers.Geometry.MultiPoint"==g||"OpenLayers.Geometry.MultiLineString"==g||"OpenLayers.Geometry.MultiPolygon"==g){for(g=0;g<f.components.length;g++){this.drawGeometry(f.components[g],e,h)}}else{switch(f.CLASS_NAME){case"OpenLayers.Geometry.Point":this.drawPoint(f,e,h);break;case"OpenLayers.Geometry.LineString":this.drawLineString(f,e,h);break;case"OpenLayers.Geometry.LinearRing":this.drawLinearRing(f,e,h);break;case"OpenLayers.Geometry.Polygon":this.drawPolygon(f,e,h)}}},drawExternalGraphic:function(r,q,p){var o=new Image;q.graphicTitle&&(o.title=q.graphicTitle);var n=q.graphicWidth||q.graphicHeight,m=q.graphicHeight||q.graphicWidth,n=n?n:2*q.pointRadius,m=m?m:2*q.pointRadius,l=void 0!=q.graphicXOffset?q.graphicXOffset:-(0.5*n),k=void 0!=q.graphicYOffset?q.graphicYOffset:-(0.5*m),j=q.graphicOpacity||q.fillOpacity;o.onload=OpenLayers.Function.bind(function(){if(this.features[p]){var c=this.getLocalXY(r),e=c[0],c=c[1];if(!isNaN(e)&&!isNaN(c)){var e=e+l|0,c=c+k|0,a=this.canvas;a.globalAlpha=j;var d=OpenLayers.Renderer.Canvas.drawImageScaleFactor||(OpenLayers.Renderer.Canvas.drawImageScaleFactor=/android 2.1/.test(navigator.userAgent.toLowerCase())?320/window.screen.width:1);a.drawImage(o,e*d,c*d,n*d,m*d);if(this.hitDetection){this.setHitContextStyle("fill",p);this.hitContext.fillRect(e,c,n,m)}}}},this);o.src=q.externalGraphic},drawNamedSymbol:function(j,i,p){var o,n,m,l;m=Math.PI/180;var k=OpenLayers.Renderer.symbol[i.graphicName];if(!k){throw Error(i.graphicName+" is not a valid symbol name")}if(k.length&&!(2>k.length)&&(j=this.getLocalXY(j),n=j[0],l=j[1],!isNaN(n)&&!isNaN(l))){this.canvas.lineCap="round";this.canvas.lineJoin="round";this.hitDetection&&(this.hitContext.lineCap="round",this.hitContext.lineJoin="round");if(i.graphicName in this.cachedSymbolBounds){o=this.cachedSymbolBounds[i.graphicName]}else{o=new OpenLayers.Bounds;for(j=0;j<k.length;j+=2){o.extend(new OpenLayers.LonLat(k[j],k[j+1]))}this.cachedSymbolBounds[i.graphicName]=o}this.canvas.save();this.hitDetection&&this.hitContext.save();this.canvas.translate(n,l);this.hitDetection&&this.hitContext.translate(n,l);j=m*i.rotation;isNaN(j)||(this.canvas.rotate(j),this.hitDetection&&this.hitContext.rotate(j));m=2*i.pointRadius/Math.max(o.getWidth(),o.getHeight());this.canvas.scale(m,m);this.hitDetection&&this.hitContext.scale(m,m);j=o.getCenterLonLat().lon;o=o.getCenterLonLat().lat;this.canvas.translate(-j,-o);this.hitDetection&&this.hitContext.translate(-j,-o);l=i.strokeWidth;i.strokeWidth=l/m;if(!1!==i.fill){this.setCanvasStyle("fill",i);this.canvas.beginPath();for(j=0;j<k.length;j+=2){o=k[j],n=k[j+1],0==j&&this.canvas.moveTo(o,n),this.canvas.lineTo(o,n)}this.canvas.closePath();this.canvas.fill();if(this.hitDetection){this.setHitContextStyle("fill",p,i);this.hitContext.beginPath();for(j=0;j<k.length;j+=2){o=k[j],n=k[j+1],0==j&&this.canvas.moveTo(o,n),this.hitContext.lineTo(o,n)}this.hitContext.closePath();this.hitContext.fill()}}if(!1!==i.stroke){this.setCanvasStyle("stroke",i);this.canvas.beginPath();for(j=0;j<k.length;j+=2){o=k[j],n=k[j+1],0==j&&this.canvas.moveTo(o,n),this.canvas.lineTo(o,n)}this.canvas.closePath();this.canvas.stroke();if(this.hitDetection){this.setHitContextStyle("stroke",p,i,m);this.hitContext.beginPath();for(j=0;j<k.length;j+=2){o=k[j],n=k[j+1],0==j&&this.hitContext.moveTo(o,n),this.hitContext.lineTo(o,n)}this.hitContext.closePath();this.hitContext.stroke()}}i.strokeWidth=l;this.canvas.restore();this.hitDetection&&this.hitContext.restore();this.setCanvasStyle("reset")}},setCanvasStyle:function(d,c){"fill"===d?(this.canvas.globalAlpha=c.fillOpacity,this.canvas.fillStyle=c.fillColor):"stroke"===d?(this.canvas.globalAlpha=c.strokeOpacity,this.canvas.strokeStyle=c.strokeColor,this.canvas.lineWidth=c.strokeWidth):(this.canvas.globalAlpha=0,this.canvas.lineWidth=1)},featureIdToHex:function(d){d=Number(d.split("_").pop())+1;16777216<=d&&(this.hitOverflow=d-16777215,d=d%16777216+1);var d="000000"+d.toString(16),c=d.length;return d="#"+d.substring(c-6,c)},setHitContextStyle:function(f,e,h,g){e=this.featureIdToHex(e);"fill"==f?(this.hitContext.globalAlpha=1,this.hitContext.fillStyle=e):"stroke"==f?(this.hitContext.globalAlpha=1,this.hitContext.strokeStyle=e,"undefined"===typeof g?this.hitContext.lineWidth=h.strokeWidth+2:isNaN(g)||(this.hitContext.lineWidth=h.strokeWidth+2/g)):(this.hitContext.globalAlpha=0,this.hitContext.lineWidth=1)},drawPoint:function(h,g,l){if(!1!==g.graphic){if(g.externalGraphic){this.drawExternalGraphic(h,g,l)}else{if(g.graphicName&&"circle"!=g.graphicName){this.drawNamedSymbol(h,g,l)}else{var k=this.getLocalXY(h),h=k[0],k=k[1];if(!isNaN(h)&&!isNaN(k)){var j=2*Math.PI,i=g.pointRadius;!1!==g.fill&&(this.setCanvasStyle("fill",g),this.canvas.beginPath(),this.canvas.arc(h,k,i,0,j,!0),this.canvas.fill(),this.hitDetection&&(this.setHitContextStyle("fill",l,g),this.hitContext.beginPath(),this.hitContext.arc(h,k,i,0,j,!0),this.hitContext.fill()));!1!==g.stroke&&(this.setCanvasStyle("stroke",g),this.canvas.beginPath(),this.canvas.arc(h,k,i,0,j,!0),this.canvas.stroke(),this.hitDetection&&(this.setHitContextStyle("stroke",l,g),this.hitContext.beginPath(),this.hitContext.arc(h,k,i,0,j,!0),this.hitContext.stroke()),this.setCanvasStyle("reset"))}}}}},drawLineString:function(e,d,f){d=OpenLayers.Util.applyDefaults({fill:!1},d);this.drawLinearRing(e,d,f)},drawLinearRing:function(e,d,f){!1!==d.fill&&(this.setCanvasStyle("fill",d),this.renderPath(this.canvas,e,d,f,"fill"),this.hitDetection&&(this.setHitContextStyle("fill",f,d),this.renderPath(this.hitContext,e,d,f,"fill")));!1!==d.stroke&&(this.setCanvasStyle("stroke",d),this.renderPath(this.canvas,e,d,f,"stroke"),this.hitDetection&&(this.setHitContextStyle("stroke",f,d),this.renderPath(this.hitContext,e,d,f,"stroke")));this.setCanvasStyle("reset")},renderPath:function(h,g,l,k,j){g=g.components;l=g.length;h.beginPath();var k=this.getLocalXY(g[0]),i=k[1];if(!isNaN(k[0])&&!isNaN(i)){h.moveTo(k[0],k[1]);for(k=1;k<l;++k){i=this.getLocalXY(g[k]),h.lineTo(i[0],i[1])}"fill"===j?h.fill():h.stroke()}},drawPolygon:function(g,f,j){var g=g.components,i=g.length;this.drawLinearRing(g[0],f,j);for(var h=1;h<i;++h){this.canvas.globalCompositeOperation="destination-out",this.hitDetection&&(this.hitContext.globalCompositeOperation="destination-out"),this.drawLinearRing(g[h],OpenLayers.Util.applyDefaults({stroke:!1,fillOpacity:1},f),j),this.canvas.globalCompositeOperation="source-over",this.hitDetection&&(this.hitContext.globalCompositeOperation="source-over"),this.drawLinearRing(g[h],OpenLayers.Util.applyDefaults({fill:!1},f),j)}},drawText:function(t,s){var r=this.getLocalXY(t);this.setCanvasStyle("reset");this.canvas.fillStyle=s.fontColor;this.canvas.globalAlpha=s.fontOpacity||1;var q=[s.fontStyle?s.fontStyle:"normal","normal",s.fontWeight?s.fontWeight:"normal",s.fontSize?s.fontSize:"1em",s.fontFamily?s.fontFamily:"sans-serif"].join(" "),p=s.label.split("\n"),o=p.length;if(this.canvas.fillText){this.canvas.font=q;this.canvas.textAlign=OpenLayers.Renderer.Canvas.LABEL_ALIGN[s.labelAlign[0]]||"center";this.canvas.textBaseline=OpenLayers.Renderer.Canvas.LABEL_ALIGN[s.labelAlign[1]]||"middle";var n=OpenLayers.Renderer.Canvas.LABEL_FACTOR[s.labelAlign[1]];null==n&&(n=-0.5);q=this.canvas.measureText("Mg").height||this.canvas.measureText("xx").width;r[1]+=q*n*(o-1);for(n=0;n<o;n++){s.labelOutlineWidth&&(this.canvas.save(),this.canvas.strokeStyle=s.labelOutlineColor,this.canvas.lineWidth=s.labelOutlineWidth,this.canvas.strokeText(p[n],r[0],r[1]+q*n+1),this.canvas.restore()),this.canvas.fillText(p[n],r[0],r[1]+q*n)}}else{if(this.canvas.mozDrawText){this.canvas.mozTextStyle=q;var m=OpenLayers.Renderer.Canvas.LABEL_FACTOR[s.labelAlign[0]];null==m&&(m=-0.5);n=OpenLayers.Renderer.Canvas.LABEL_FACTOR[s.labelAlign[1]];null==n&&(n=-0.5);q=this.canvas.mozMeasureText("xx");r[1]+=q*(1+n*o);for(n=0;n<o;n++){var l=r[0]+m*this.canvas.mozMeasureText(p[n]),k=r[1]+n*q;this.canvas.translate(l,k);this.canvas.mozDrawText(p[n]);this.canvas.translate(-l,-k)}}}this.setCanvasStyle("reset")},getLocalXY:function(e){var d=this.getResolution(),f=this.extent;return[(e.x-this.featureDx)/d+-f.left/d,f.top/d-e.y/d]},clear:function(){var d=this.root.height,c=this.root.width;this.canvas.clearRect(0,0,c,d);this.features={};this.hitDetection&&this.hitContext.clearRect(0,0,c,d)},getFeatureIdFromEvent:function(e){var d;if(this.hitDetection&&"none"!==this.root.style.display&&!this.map.dragging&&(e=e.xy,e=this.hitContext.getImageData(e.x|0,e.y|0,1,1).data,255===e[3]&&(e=e[2]+256*(e[1]+256*e[0])))){e="OpenLayers.Feature.Vector_"+(e-1+this.hitOverflow);try{d=this.features[e][0]}catch(f){}}return d},eraseFeatures:function(d){OpenLayers.Util.isArray(d)||(d=[d]);for(var c=0;c<d.length;++c){delete this.features[d[c].id]}this.redraw()},redraw:function(){if(!this.locked){var h=this.root.height,g=this.root.width;this.canvas.clearRect(0,0,g,h);this.hitDetection&&this.hitContext.clearRect(0,0,g,h);var h=[],l,k,j=this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent(),i;for(i in this.features){this.features.hasOwnProperty(i)&&(g=this.features[i][0],l=g.geometry,this.calculateFeatureDx(l.getBounds(),j),k=this.features[i][1],this.drawGeometry(l,k,g.id),k.label&&h.push([g,k]))}g=0;for(l=h.length;g<l;++g){i=h[g],this.drawText(i[0].geometry.getCentroid(),i[1])}}},CLASS_NAME:"OpenLayers.Renderer.Canvas"});OpenLayers.Renderer.Canvas.LABEL_ALIGN={l:"left",r:"right",t:"top",b:"bottom"};OpenLayers.Renderer.Canvas.LABEL_FACTOR={l:0,r:-1,t:0,b:-1};OpenLayers.Renderer.Canvas.drawImageScaleFactor=null;OpenLayers.Handler=OpenLayers.Class({id:null,control:null,map:null,keyMask:null,active:!1,evt:null,initialize:function(e,d,f){OpenLayers.Util.extend(this,f);this.control=e;this.callbacks=d;(e=this.map||e.map)&&this.setMap(e);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},setMap:function(b){this.map=b},checkModifiers:function(b){return null==this.keyMask?!0:((b.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(b.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(b.altKey?OpenLayers.Handler.MOD_ALT:0))==this.keyMask},activate:function(){if(this.active){return !1}for(var e=OpenLayers.Events.prototype.BROWSER_EVENTS,d=0,f=e.length;d<f;d++){this[e[d]]&&this.register(e[d],this[e[d]])}return this.active=!0},deactivate:function(){if(!this.active){return !1}for(var e=OpenLayers.Events.prototype.BROWSER_EVENTS,d=0,f=e.length;d<f;d++){this[e[d]]&&this.unregister(e[d],this[e[d]])}this.active=!1;return !0},callback:function(d,c){d&&this.callbacks[d]&&this.callbacks[d].apply(this.control,c)},register:function(d,c){this.map.events.registerPriority(d,this,c);this.map.events.registerPriority(d,this,this.setEvent)},unregister:function(d,c){this.map.events.unregister(d,this,c);this.map.events.unregister(d,this,this.setEvent)},setEvent:function(b){this.evt=b;return !0},destroy:function(){this.deactivate();this.control=this.map=null},CLASS_NAME:"OpenLayers.Handler"});OpenLayers.Handler.MOD_NONE=0;OpenLayers.Handler.MOD_SHIFT=1;OpenLayers.Handler.MOD_CTRL=2;OpenLayers.Handler.MOD_ALT=4;OpenLayers.Handler.Drag=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!0,dragging:!1,touch:!1,last:null,start:null,lastMoveEvt:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:!1,documentEvents:null,initialize:function(f,e,h){OpenLayers.Handler.prototype.initialize.apply(this,arguments);if(!0===this.documentDrag){var g=this;this._docMove=function(b){g.mousemove({xy:{x:b.clientX,y:b.clientY},element:document})};this._docUp=function(b){g.mouseup({xy:{x:b.clientX,y:b.clientY}})}}},dragstart:function(d){var c=!0;this.dragging=!1;this.checkModifiers(d)&&(OpenLayers.Event.isLeftClick(d)||OpenLayers.Event.isSingleTouch(d))?(this.started=!0,this.last=this.start=d.xy,OpenLayers.Element.addClass(this.map.viewPortDiv,"olDragDown"),this.down(d),this.callback("down",[d.xy]),OpenLayers.Event.stop(d),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart?document.onselectstart:OpenLayers.Function.True),document.onselectstart=OpenLayers.Function.False,c=!this.stopDown):(this.started=!1,this.last=this.start=null);return c},dragmove:function(b){this.lastMoveEvt=b;if(this.started&&!this.timeoutId&&(b.xy.x!=this.last.x||b.xy.y!=this.last.y)){!0===this.documentDrag&&this.documentEvents&&(b.element===document?(this.adjustXY(b),this.setEvent(b)):this.removeDocumentEvents()),0<this.interval&&(this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval)),this.dragging=!0,this.move(b),this.callback("move",[b.xy]),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart,document.onselectstart=OpenLayers.Function.False),this.last=b.xy}return !0},dragend:function(d){if(this.started){!0===this.documentDrag&&this.documentEvents&&(this.adjustXY(d),this.removeDocumentEvents());var c=this.start!=this.last;this.dragging=this.started=!1;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.up(d);this.callback("up",[d.xy]);c&&this.callback("done",[d.xy]);document.onselectstart=this.oldOnselectstart}return !0},down:function(){},move:function(){},up:function(){},out:function(){},mousedown:function(b){return this.dragstart(b)},touchstart:function(b){this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,scope:this}));return this.dragstart(b)},mousemove:function(b){return this.dragmove(b)},touchmove:function(b){return this.dragmove(b)},removeTimeout:function(){this.timeoutId=null;this.dragging&&this.mousemove(this.lastMoveEvt)},mouseup:function(b){return this.dragend(b)},touchend:function(b){b.xy=this.last;return this.dragend(b)},mouseout:function(d){if(this.started&&OpenLayers.Util.mouseLeft(d,this.map.viewPortDiv)){if(!0===this.documentDrag){this.addDocumentEvents()}else{var c=this.start!=this.last;this.dragging=this.started=!1;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.out(d);this.callback("out",[]);c&&this.callback("done",[d.xy]);document.onselectstart&&(document.onselectstart=this.oldOnselectstart)}}return !0},click:function(){return this.start==this.last},activate:function(){var b=!1;OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.dragging=!1,b=!0);return b},deactivate:function(){var b=!1;OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.dragging=this.started=this.touch=!1,this.last=this.start=null,b=!0,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown"));return b},adjustXY:function(d){var c=OpenLayers.Util.pagePosition(this.map.viewPortDiv);d.xy.x-=c[0];d.xy.y-=c[1]},addDocumentEvents:function(){OpenLayers.Element.addClass(document.body,"olDragDown");this.documentEvents=!0;OpenLayers.Event.observe(document,"mousemove",this._docMove);OpenLayers.Event.observe(document,"mouseup",this._docUp)},removeDocumentEvents:function(){OpenLayers.Element.removeClass(document.body,"olDragDown");this.documentEvents=!1;OpenLayers.Event.stopObserving(document,"mousemove",this._docMove);OpenLayers.Event.stopObserving(document,"mouseup",this._docUp)},CLASS_NAME:"OpenLayers.Handler.Drag"});OpenLayers.Handler.Feature=OpenLayers.Class(OpenLayers.Handler,{EVENTMAP:{click:{"in":"click",out:"clickout"},mousemove:{"in":"over",out:"out"},dblclick:{"in":"dblclick",out:null},mousedown:{"in":null,out:null},mouseup:{"in":null,out:null},touchstart:{"in":"click",out:"clickout"}},feature:null,lastFeature:null,down:null,up:null,touch:!1,clickTolerance:4,geometryTypes:null,stopClick:!0,stopDown:!0,stopUp:!1,initialize:function(f,e,h,g){OpenLayers.Handler.prototype.initialize.apply(this,[f,h,g]);this.layer=e},touchstart:function(b){this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this}));return OpenLayers.Event.isMultiTouch(b)?!0:this.mousedown(b)},touchmove:function(b){OpenLayers.Event.stop(b)},mousedown:function(b){if(OpenLayers.Event.isLeftClick(b)||OpenLayers.Event.isSingleTouch(b)){this.down=b.xy}return this.handle(b)?!this.stopDown:!0},mouseup:function(b){this.up=b.xy;return this.handle(b)?!this.stopUp:!0},click:function(b){return this.handle(b)?!this.stopClick:!0},mousemove:function(b){if(!this.callbacks.over&&!this.callbacks.out){return !0}this.handle(b);return !0},dblclick:function(b){return !this.handle(b)},geometryTypeMatches:function(b){return null==this.geometryTypes||-1<OpenLayers.Util.indexOf(this.geometryTypes,b.geometry.CLASS_NAME)},handle:function(g){this.feature&&!this.feature.layer&&(this.feature=null);var f=g.type,j=!1,i=!!this.feature,h="click"==f||"dblclick"==f||"touchstart"==f;if((this.feature=this.layer.getFeatureFromEvent(g))&&!this.feature.layer){this.feature=null}this.lastFeature&&!this.lastFeature.layer&&(this.lastFeature=null);this.feature?("touchstart"===f&&OpenLayers.Event.stop(g),g=this.feature!=this.lastFeature,this.geometryTypeMatches(this.feature)?(i&&g?(this.lastFeature&&this.triggerCallback(f,"out",[this.lastFeature]),this.triggerCallback(f,"in",[this.feature])):(!i||h)&&this.triggerCallback(f,"in",[this.feature]),this.lastFeature=this.feature,j=!0):(this.lastFeature&&(i&&g||h)&&this.triggerCallback(f,"out",[this.lastFeature]),this.feature=null)):this.lastFeature&&(i||h)&&this.triggerCallback(f,"out",[this.lastFeature]);return j},triggerCallback:function(e,d,f){(d=this.EVENTMAP[e][d])&&("click"==e&&this.up&&this.down?Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2))<=this.clickTolerance&&this.callback(d,f):this.callback(d,f))},activate:function(){var b=!1;OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.moveLayerToTop(),this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),b=!0);return b},deactivate:function(){var b=!1;OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.moveLayerBack(),this.up=this.down=this.lastFeature=this.feature=null,this.touch=!1,this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),b=!0);return b},handleMapEvents:function(b){("removelayer"==b.type||"order"==b.property)&&this.moveLayerToTop()},moveLayerToTop:function(){this.layer.setZIndex(Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1)},moveLayerBack:function(){var b=this.layer.getZIndex()-1;b>=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(b):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))},CLASS_NAME:"OpenLayers.Handler.Feature"});OpenLayers.Control.DragFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,onStart:function(){},onDrag:function(){},onComplete:function(){},onEnter:function(){},onLeave:function(){},documentDrag:!1,layer:null,feature:null,dragCallbacks:{},featureCallbacks:{},lastPixel:null,initialize:function(d,c){OpenLayers.Control.prototype.initialize.apply(this,[c]);this.layer=d;this.handlers={drag:new OpenLayers.Handler.Drag(this,OpenLayers.Util.extend({down:this.downFeature,move:this.moveFeature,up:this.upFeature,out:this.cancel,done:this.doneDragging},this.dragCallbacks),{documentDrag:this.documentDrag}),feature:new OpenLayers.Handler.Feature(this,this.layer,OpenLayers.Util.extend({click:this.clickFeature,clickout:this.clickoutFeature,over:this.overFeature,out:this.outFeature},this.featureCallbacks),{geometryTypes:this.geometryTypes})}},clickFeature:function(b){this.handlers.feature.touch&&(!this.over&&this.overFeature(b))&&(this.handlers.drag.dragstart(this.handlers.feature.evt),this.handlers.drag.stopDown=!1)},clickoutFeature:function(b){this.handlers.feature.touch&&this.over&&(this.outFeature(b),this.handlers.drag.stopDown=!0)},destroy:function(){this.layer=null;OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return this.handlers.feature.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){this.handlers.drag.deactivate();this.handlers.feature.deactivate();this.feature=null;this.dragging=!1;this.lastPixel=null;OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over");return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},overFeature:function(d){var c=!1;this.handlers.drag.dragging?this.over=this.feature.id==d.id?!0:!1:(this.feature=d,this.handlers.drag.activate(),this.over=c=!0,OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass+"Over"),this.onEnter(d));return c},downFeature:function(b){this.lastPixel=b;this.onStart(this.feature,b)},moveFeature:function(d){var c=this.map.getResolution();this.feature.geometry.move(c*(d.x-this.lastPixel.x),c*(this.lastPixel.y-d.y));this.layer.drawFeature(this.feature);this.lastPixel=d;this.onDrag(this.feature,d)},upFeature:function(){this.over||this.handlers.drag.deactivate()},doneDragging:function(b){this.onComplete(this.feature,b)},outFeature:function(b){this.handlers.drag.dragging?this.feature.id==b.id&&(this.over=!1):(this.over=!1,this.handlers.drag.deactivate(),OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over"),this.onLeave(b),this.feature=null)},cancel:function(){this.handlers.drag.deactivate();this.over=!1},setMap:function(b){this.handlers.drag.setMap(b);this.handlers.feature.setMap(b);OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.DragFeature"});OpenLayers.Feature=OpenLayers.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:null,popup:null,initialize:function(e,d,f){this.layer=e;this.lonlat=d;this.data=null!=f?f:{};this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){null!=this.layer&&null!=this.layer.map&&null!=this.popup&&this.layer.map.removePopup(this.popup);null!=this.layer&&null!=this.marker&&this.layer.removeMarker(this.marker);this.data=this.lonlat=this.id=this.layer=null;null!=this.marker&&(this.destroyMarker(this.marker),this.marker=null);null!=this.popup&&(this.destroyPopup(this.popup),this.popup=null)},onScreen:function(){var b=!1;null!=this.layer&&null!=this.layer.map&&(b=this.layer.map.getExtent().containsLonLat(this.lonlat));return b},createMarker:function(){null!=this.lonlat&&(this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon));return this.marker},destroyMarker:function(){this.marker.destroy()},createPopup:function(b){null!=this.lonlat&&(this.popup||(this.popup=new (this.popupClass?this.popupClass:OpenLayers.Popup.Anchored)(this.id+"_popup",this.lonlat,this.data.popupSize,this.data.popupContentHTML,this.marker?this.marker.icon:null,b)),null!=this.data.overflow&&(this.popup.contentDiv.style.overflow=this.data.overflow),this.popup.feature=this);return this.popup},destroyPopup:function(){this.popup&&(this.popup.feature=null,this.popup.destroy(),this.popup=null)},CLASS_NAME:"OpenLayers.Feature"});OpenLayers.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"};OpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,url:null,renderIntent:"default",modified:null,initialize:function(e,d,f){OpenLayers.Feature.prototype.initialize.apply(this,[null,null,d]);this.lonlat=null;this.geometry=e?e:null;this.state=null;this.attributes={};d&&(this.attributes=OpenLayers.Util.extend(this.attributes,d));this.style=f?f:null},destroy:function(){this.layer&&(this.layer.removeFeatures(this),this.layer=null);this.modified=this.geometry=null;OpenLayers.Feature.prototype.destroy.apply(this,arguments)},clone:function(){return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)},onScreen:function(d){var c=!1;this.layer&&this.layer.map&&(c=this.layer.map.getExtent(),d?(d=this.geometry.getBounds(),c=c.intersectsBounds(d)):c=c.toGeometry().intersects(this.geometry));return c},getVisibility:function(){return !(this.style&&"none"==this.style.display||!this.layer||this.layer&&this.layer.styleMap&&"none"==this.layer.styleMap.createSymbolizer(this,this.renderIntent).display||this.layer&&!this.layer.getVisibility())},createMarker:function(){return null},destroyMarker:function(){},createPopup:function(){return null},atPoint:function(f,e,h){var g=!1;this.geometry&&(g=this.geometry.atPoint(f,e,h));return g},destroyPopup:function(){},move:function(e){if(this.layer&&this.geometry.move){var e="OpenLayers.LonLat"==e.CLASS_NAME?this.layer.getViewPortPxFromLonLat(e):e,d=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat()),f=this.layer.map.getResolution();this.geometry.move(f*(e.x-d.x),f*(d.y-e.y));this.layer.drawFeature(this);return d}},toState:function(b){if(b==OpenLayers.State.UPDATE){switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=b}}else{if(b==OpenLayers.State.INSERT){switch(this.state){case OpenLayers.State.UNKNOWN:break;default:this.state=b}}else{if(b==OpenLayers.State.DELETE){switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=b}}else{b==OpenLayers.State.UNKNOWN&&(this.state=b)}}}},CLASS_NAME:"OpenLayers.Feature.Vector"});OpenLayers.Feature.Vector.style={"default":{fillColor:"#ee9900",fillOpacity:0.4,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},select:{fillColor:"blue",fillOpacity:0.4,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},temporary:{fillColor:"#66cccc",fillOpacity:0.2,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},"delete":{display:"none"}};OpenLayers.Style=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:!1,propertyStyles:null,initialize:function(d,c){OpenLayers.Util.extend(this,c);this.rules=[];c&&c.rules&&this.addRules(c.rules);this.setDefaultStyle(d||OpenLayers.Feature.Vector.style["default"]);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var d=0,c=this.rules.length;d<c;d++){this.rules[d].destroy(),this.rules[d]=null}this.defaultStyle=this.rules=null},createSymbolizer:function(j){for(var i=this.defaultsPerSymbolizer?{}:this.createLiterals(OpenLayers.Util.extend({},this.defaultStyle),j),p=this.rules,o,n=[],m=!1,l=0,k=p.length;l<k;l++){o=p[l],o.evaluate(j)&&(o instanceof OpenLayers.Rule&&o.elseFilter?n.push(o):(m=!0,this.applySymbolizer(o,i,j)))}if(!1==m&&0<n.length){m=!0;l=0;for(k=n.length;l<k;l++){this.applySymbolizer(n[l],i,j)}}0<p.length&&!1==m&&(i.display="none");null!=i.label&&"string"!==typeof i.label&&(i.label=""+i.label);return i},applySymbolizer:function(f,e,h){var g=h.geometry?this.getSymbolizerPrefix(h.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0],f=f.symbolizer[g]||f.symbolizer;!0===this.defaultsPerSymbolizer&&(g=this.defaultStyle,OpenLayers.Util.applyDefaults(f,{pointRadius:g.pointRadius}),(!0===f.stroke||!0===f.graphic)&&OpenLayers.Util.applyDefaults(f,{strokeWidth:g.strokeWidth,strokeColor:g.strokeColor,strokeOpacity:g.strokeOpacity,strokeDashstyle:g.strokeDashstyle,strokeLinecap:g.strokeLinecap}),(!0===f.fill||!0===f.graphic)&&OpenLayers.Util.applyDefaults(f,{fillColor:g.fillColor,fillOpacity:g.fillOpacity}),!0===f.graphic&&OpenLayers.Util.applyDefaults(f,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset}));return this.createLiterals(OpenLayers.Util.extend(e,f),h)},createLiterals:function(f,e){var h=OpenLayers.Util.extend({},e.attributes||e.data);OpenLayers.Util.extend(h,this.context);for(var g in this.propertyStyles){f[g]=OpenLayers.Style.createLiteral(f[g],h,e,g)}return f},findPropertyStyles:function(){var i={};this.addPropertyStyles(i,this.defaultStyle);for(var h=this.rules,n,m,l=0,k=h.length;l<k;l++){n=h[l].symbolizer;for(var j in n){if(m=n[j],"object"==typeof m){this.addPropertyStyles(i,m)}else{this.addPropertyStyles(i,n);break}}}return i},addPropertyStyles:function(f,e){var h,g;for(g in e){h=e[g],"string"==typeof h&&h.match(/\$\{\w+\}/)&&(f[g]=!0)}return f},addRules:function(b){Array.prototype.push.apply(this.rules,b);this.propertyStyles=this.findPropertyStyles()},setDefaultStyle:function(b){this.defaultStyle=b;this.propertyStyles=this.findPropertyStyles()},getSymbolizerPrefix:function(f){for(var e=OpenLayers.Style.SYMBOLIZER_PREFIXES,h=0,g=e.length;h<g;h++){if(-1!=f.CLASS_NAME.indexOf(e[h])){return e[h]}}},clone:function(){var e=OpenLayers.Util.extend({},this);if(this.rules){e.rules=[];for(var d=0,f=this.rules.length;d<f;++d){e.rules.push(this.rules[d].clone())}}e.context=this.context&&OpenLayers.Util.extend({},this.context);d=OpenLayers.Util.extend({},this.defaultStyle);return new OpenLayers.Style(d,e)},CLASS_NAME:"OpenLayers.Style"});OpenLayers.Style.createLiteral=function(f,e,h,g){"string"==typeof f&&-1!=f.indexOf("${")&&(f=OpenLayers.String.format(f,e,[h,g]),f=isNaN(f)||!f?f:parseFloat(f));return f};OpenLayers.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text","Raster"];OpenLayers.StyleMap=OpenLayers.Class({styles:null,extendDefault:!0,initialize:function(e,d){this.styles={"default":new OpenLayers.Style(OpenLayers.Feature.Vector.style["default"]),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style.select),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style.temporary),"delete":new OpenLayers.Style(OpenLayers.Feature.Vector.style["delete"])};if(e instanceof OpenLayers.Style){this.styles["default"]=e,this.styles.select=e,this.styles.temporary=e,this.styles["delete"]=e}else{if("object"==typeof e){for(var f in e){if(e[f] instanceof OpenLayers.Style){this.styles[f]=e[f]}else{if("object"==typeof e[f]){this.styles[f]=new OpenLayers.Style(e[f])}else{this.styles["default"]=new OpenLayers.Style(e);this.styles.select=new OpenLayers.Style(e);this.styles.temporary=new OpenLayers.Style(e);this.styles["delete"]=new OpenLayers.Style(e);break}}}}}OpenLayers.Util.extend(this,d)},destroy:function(){for(var b in this.styles){this.styles[b].destroy()}this.styles=null},createSymbolizer:function(e,d){e||(e=new OpenLayers.Feature.Vector);this.styles[d]||(d="default");e.renderIntent=d;var f={};this.extendDefault&&"default"!=d&&(f=this.styles["default"].createSymbolizer(e));return OpenLayers.Util.extend(f,this.styles[d].createSymbolizer(e))},addUniqueValueRules:function(h,g,l,k){var j=[],i;for(i in l){j.push(new OpenLayers.Rule({symbolizer:l[i],context:k,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:g,value:i})}))}this.styles[h].addRules(j)},CLASS_NAME:"OpenLayers.StyleMap"});OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,isFixed:!1,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:!0,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:!1,ratio:1,initialize:function(f,e){OpenLayers.Layer.prototype.initialize.apply(this,arguments);(!this.renderer||!this.renderer.supported())&&this.assignRenderer();if(!this.renderer||!this.renderer.supported()){this.renderer=null,this.displayError()}this.styleMap||(this.styleMap=new OpenLayers.StyleMap);this.features=[];this.selectedFeatures=[];this.unrenderedFeatures={};if(this.strategies){for(var h=0,g=this.strategies.length;h<g;h++){this.strategies[h].setLayer(this)}}},destroy:function(){if(this.strategies){var e,d,f;d=0;for(f=this.strategies.length;d<f;d++){e=this.strategies[d],e.autoDestroy&&e.destroy()}this.strategies=null}this.protocol&&(this.protocol.autoDestroy&&this.protocol.destroy(),this.protocol=null);this.destroyFeatures();this.unrenderedFeatures=this.selectedFeatures=this.features=null;this.renderer&&this.renderer.destroy();this.drawn=this.geometryType=this.renderer=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(g){null==g&&(g=new OpenLayers.Layer.Vector(this.name,this.getOptions()));for(var g=OpenLayers.Layer.prototype.clone.apply(this,[g]),f=this.features,j=f.length,i=Array(j),h=0;h<j;++h){i[h]=f[h].clone()}g.features=i;return g},refresh:function(b){this.calculateInRange()&&this.visibility&&this.events.triggerEvent("refresh",b)},assignRenderer:function(){for(var e=0,d=this.renderers.length;e<d;e++){var f=this.renderers[e];if((f="function"==typeof f?f:OpenLayers.Renderer[f])&&f.prototype.supported()){this.renderer=new f(this.div,this.rendererOptions);break}}},displayError:function(){this.reportError&&OpenLayers.Console.userError(OpenLayers.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}))},setMap:function(d){OpenLayers.Layer.prototype.setMap.apply(this,arguments);if(this.renderer){this.renderer.map=this.map;var c=this.map.getSize();c.w*=this.ratio;c.h*=this.ratio;this.renderer.setSize(c)}else{this.map.removeLayer(this)}},afterAdd:function(){if(this.strategies){var e,d,f;d=0;for(f=this.strategies.length;d<f;d++){e=this.strategies[d],e.autoActivate&&e.activate()}}},removeMap:function(){this.drawn=!1;if(this.strategies){var e,d,f;d=0;for(f=this.strategies.length;d<f;d++){e=this.strategies[d],e.autoActivate&&e.deactivate()}}},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.apply(this,arguments);var b=this.map.getSize();b.w*=this.ratio;b.h*=this.ratio;this.renderer.setSize(b)},moveTo:function(h,g,l){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var k=!0;if(!l){this.renderer.root.style.visibility="hidden";var k=this.map.getSize(),j=k.w,k=k.h,j=j/2*this.ratio-j/2,k=k/2*this.ratio-k/2,j=j+parseInt(this.map.layerContainerDiv.style.left,10),j=-Math.round(j),k=k+parseInt(this.map.layerContainerDiv.style.top,10),k=-Math.round(k);this.div.style.left=j+"px";this.div.style.top=k+"px";k=this.renderer.setExtent(this.map.getExtent().scale(this.ratio),g);this.renderer.root.style.visibility="visible";!0===OpenLayers.IS_GECKO&&(this.div.scrollLeft=this.div.scrollLeft);if(!g&&k){for(var i in this.unrenderedFeatures){j=this.unrenderedFeatures[i],this.drawFeature(j)}}}if(!this.drawn||g||!k){this.drawn=!0;i=0;for(k=this.features.length;i<k;i++){this.renderer.locked=i!==k-1,j=this.features[i],this.drawFeature(j)}}},display:function(d){OpenLayers.Layer.prototype.display.apply(this,arguments);var c=this.div.style.display;c!=this.renderer.root.style.display&&(this.renderer.root.style.display=c)},addFeatures:function(i,h){OpenLayers.Util.isArray(i)||(i=[i]);var n=!h||!h.silent;if(n){var m={features:i};if(!1===this.events.triggerEvent("beforefeaturesadded",m)){return}i=m.features}for(var m=[],l=0,k=i.length;l<k;l++){this.renderer.locked=l!=i.length-1?!0:!1;var j=i[l];if(this.geometryType&&!(j.geometry instanceof this.geometryType)){throw new TypeError("addFeatures: component should be an "+this.geometryType.prototype.CLASS_NAME)}j.layer=this;!j.style&&this.style&&(j.style=OpenLayers.Util.extend({},this.style));if(n){if(!1===this.events.triggerEvent("beforefeatureadded",{feature:j})){continue}this.preFeatureInsert(j)}m.push(j);this.features.push(j);this.drawFeature(j);n&&(this.events.triggerEvent("featureadded",{feature:j}),this.onFeatureInsert(j))}n&&this.events.triggerEvent("featuresadded",{features:m})},removeFeatures:function(g,f){if(g&&0!==g.length){if(g===this.features){return this.removeAllFeatures(f)}OpenLayers.Util.isArray(g)||(g=[g]);g===this.selectedFeatures&&(g=g.slice());var j=!f||!f.silent;j&&this.events.triggerEvent("beforefeaturesremoved",{features:g});for(var i=g.length-1;0<=i;i--){this.renderer.locked=0!=i&&g[i-1].geometry?!0:!1;var h=g[i];delete this.unrenderedFeatures[h.id];j&&this.events.triggerEvent("beforefeatureremoved",{feature:h});this.features=OpenLayers.Util.removeItem(this.features,h);h.layer=null;h.geometry&&this.renderer.eraseFeatures(h);-1!=OpenLayers.Util.indexOf(this.selectedFeatures,h)&&OpenLayers.Util.removeItem(this.selectedFeatures,h);j&&this.events.triggerEvent("featureremoved",{feature:h})}j&&this.events.triggerEvent("featuresremoved",{features:g})}},removeAllFeatures:function(f){var f=!f||!f.silent,e=this.features;f&&this.events.triggerEvent("beforefeaturesremoved",{features:e});for(var h,g=e.length-1;0<=g;g--){h=e[g],f&&this.events.triggerEvent("beforefeatureremoved",{feature:h}),h.layer=null,f&&this.events.triggerEvent("featureremoved",{feature:h})}this.renderer.clear();this.features=[];this.unrenderedFeatures={};this.selectedFeatures=[];f&&this.events.triggerEvent("featuresremoved",{features:e})},destroyFeatures:function(e,d){void 0==e&&(e=this.features);if(e){this.removeFeatures(e,d);for(var f=e.length-1;0<=f;f--){e[f].destroy()}}},drawFeature:function(e,d){if(this.drawn){if("object"!=typeof d){!d&&e.state===OpenLayers.State.DELETE&&(d="delete");var f=d||e.renderIntent;(d=e.style||this.style)||(d=this.styleMap.createSymbolizer(e,f))}f=this.renderer.drawFeature(e,d);!1===f||null===f?this.unrenderedFeatures[e.id]=e:delete this.unrenderedFeatures[e.id]}},eraseFeatures:function(b){this.renderer.eraseFeatures(b)},getFeatureFromEvent:function(d){if(!this.renderer){throw Error("getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.")}var c=null;(d=this.renderer.getFeatureIdFromEvent(d))&&(c="string"===typeof d?this.getFeatureById(d):d);return c},getFeatureBy:function(g,f){for(var j=null,i=0,h=this.features.length;i<h;++i){if(this.features[i][g]==f){j=this.features[i];break}}return j},getFeatureById:function(b){return this.getFeatureBy("id",b)},getFeatureByFid:function(b){return this.getFeatureBy("fid",b)},getFeaturesByAttribute:function(h,g){var l,k,j=this.features.length,i=[];for(l=0;l<j;l++){(k=this.features[l])&&k.attributes&&k.attributes[h]===g&&i.push(k)}return i},onFeatureInsert:function(){},preFeatureInsert:function(){},getDataExtent:function(){var g=null,f=this.features;if(f&&0<f.length){for(var j=null,i=0,h=f.length;i<h;i++){if(j=f[i].geometry){null===g&&(g=new OpenLayers.Bounds),g.extend(j.getBounds())}}}return g},CLASS_NAME:"OpenLayers.Layer.Vector"});OpenLayers.Layer.Vector.RootContainer=OpenLayers.Class(OpenLayers.Layer.Vector,{displayInLayerSwitcher:!1,layers:null,display:function(){},getFeatureFromEvent:function(f){for(var e=this.layers,h,g=0;g<e.length;g++){if(h=e[g].getFeatureFromEvent(f)){return h}}},setMap:function(b){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments);this.collectRoots();b.events.register("changelayer",this,this.handleChangeLayer)},removeMap:function(b){b.events.unregister("changelayer",this,this.handleChangeLayer);this.resetRoots();OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},collectRoots:function(){for(var d,c=0;c<this.map.layers.length;++c){d=this.map.layers[c],-1!=OpenLayers.Util.indexOf(this.layers,d)&&d.renderer.moveRoot(this.renderer)}},resetRoots:function(){for(var d,c=0;c<this.layers.length;++c){d=this.layers[c],this.renderer&&d.renderer.getRenderLayerId()==this.id&&this.renderer.moveRoot(d.renderer)}},handleChangeLayer:function(d){var c=d.layer;"order"==d.property&&-1!=OpenLayers.Util.indexOf(this.layers,c)&&(this.resetRoots(),this.collectRoots())},CLASS_NAME:"OpenLayers.Layer.Vector.RootContainer"});OpenLayers.Control.SelectFeature=OpenLayers.Class(OpenLayers.Control,{multipleKey:null,toggleKey:null,multiple:!1,clickout:!0,toggle:!1,hover:!1,highlightOnly:!1,box:!1,onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,initialize:function(e,d){OpenLayers.Control.prototype.initialize.apply(this,[d]);null===this.scope&&(this.scope=this);this.initLayer(e);var f={click:this.clickFeature,clickout:this.clickoutFeature};this.hover&&(f.over=this.overFeature,f.out=this.outFeature);this.callbacks=OpenLayers.Util.extend(f,this.callbacks);this.handlers={feature:new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes})};this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature"}))},initLayer:function(b){OpenLayers.Util.isArray(b)?(this.layers=b,this.layer=new OpenLayers.Layer.Vector.RootContainer(this.id+"_container",{layers:b})):this.layer=b},destroy:function(){this.active&&this.layers&&this.map.removeLayer(this.layer);OpenLayers.Control.prototype.destroy.apply(this,arguments);this.layers&&this.layer.destroy()},activate:function(){this.active||(this.layers&&this.map.addLayer(this.layer),this.handlers.feature.activate(),this.box&&this.handlers.box&&this.handlers.box.activate());return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){this.active&&(this.handlers.feature.deactivate(),this.handlers.box&&this.handlers.box.deactivate(),this.layers&&this.map.removeLayer(this.layer));return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},unselectAll:function(h){for(var g=this.layers||[this.layer],l,k,j=0;j<g.length;++j){l=g[j];for(var i=l.selectedFeatures.length-1;0<=i;--i){k=l.selectedFeatures[i],(!h||h.except!=k)&&this.unselect(k)}}},clickFeature:function(b){this.hover||(-1<OpenLayers.Util.indexOf(b.layer.selectedFeatures,b)?this.toggleSelect()?this.unselect(b):this.multipleSelect()||this.unselectAll({except:b}):(this.multipleSelect()||this.unselectAll({except:b}),this.select(b)))},multipleSelect:function(){return this.multiple||this.handlers.feature.evt&&this.handlers.feature.evt[this.multipleKey]},toggleSelect:function(){return this.toggle||this.handlers.feature.evt&&this.handlers.feature.evt[this.toggleKey]},clickoutFeature:function(){!this.hover&&this.clickout&&this.unselectAll()},overFeature:function(d){var c=d.layer;this.hover&&(this.highlightOnly?this.highlight(d):-1==OpenLayers.Util.indexOf(c.selectedFeatures,d)&&this.select(d))},outFeature:function(d){if(this.hover){if(this.highlightOnly){if(d._lastHighlighter==this.id){if(d._prevHighlighter&&d._prevHighlighter!=this.id){delete d._lastHighlighter;var c=this.map.getControl(d._prevHighlighter);c&&c.highlight(d)}else{this.unhighlight(d)}}}else{this.unselect(d)}}},highlight:function(d){var c=d.layer;!1!==this.events.triggerEvent("beforefeaturehighlighted",{feature:d})&&(d._prevHighlighter=d._lastHighlighter,d._lastHighlighter=this.id,c.drawFeature(d,this.selectStyle||this.renderIntent),this.events.triggerEvent("featurehighlighted",{feature:d}))},unhighlight:function(d){var c=d.layer;void 0==d._prevHighlighter?delete d._lastHighlighter:(d._prevHighlighter!=this.id&&(d._lastHighlighter=d._prevHighlighter),delete d._prevHighlighter);c.drawFeature(d,d.style||d.layer.style||"default");this.events.triggerEvent("featureunhighlighted",{feature:d})},select:function(e){var d=this.onBeforeSelect.call(this.scope,e),f=e.layer;!1!==d&&(d=f.events.triggerEvent("beforefeatureselected",{feature:e}),!1!==d&&(f.selectedFeatures.push(e),this.highlight(e),this.handlers.feature.lastFeature||(this.handlers.feature.lastFeature=f.selectedFeatures[0]),f.events.triggerEvent("featureselected",{feature:e}),this.onSelect.call(this.scope,e)))},unselect:function(d){var c=d.layer;this.unhighlight(d);OpenLayers.Util.removeItem(c.selectedFeatures,d);c.events.triggerEvent("featureunselected",{feature:d});this.onUnselect.call(this.scope,d)},selectBox:function(j){if(j instanceof OpenLayers.Bounds){var i=this.map.getLonLatFromPixel({x:j.left,y:j.bottom}),j=this.map.getLonLatFromPixel({x:j.right,y:j.top}),i=new OpenLayers.Bounds(i.lon,i.lat,j.lon,j.lat);this.multipleSelect()||this.unselectAll();j=this.multiple;this.multiple=!0;var p=this.layers||[this.layer];this.events.triggerEvent("boxselectionstart",{layers:p});for(var o,n=0;n<p.length;++n){o=p[n];for(var m=0,l=o.features.length;m<l;++m){var k=o.features[m];k.getVisibility()&&(null==this.geometryTypes||-1<OpenLayers.Util.indexOf(this.geometryTypes,k.geometry.CLASS_NAME))&&i.toGeometry().intersects(k.geometry)&&-1==OpenLayers.Util.indexOf(o.selectedFeatures,k)&&this.select(k)}}this.multiple=j;this.events.triggerEvent("boxselectionend",{layers:p})}},setMap:function(b){this.handlers.feature.setMap(b);this.box&&this.handlers.box.setMap(b);OpenLayers.Control.prototype.setMap.apply(this,arguments)},setLayer:function(d){var c=this.active;this.unselectAll();this.deactivate();this.layers&&(this.layer.destroy(),this.layers=null);this.initLayer(d);this.handlers.feature.layer=this.layer;c&&this.activate()},CLASS_NAME:"OpenLayers.Control.SelectFeature"});OpenLayers.Handler.Keyboard=OpenLayers.Class(OpenLayers.Handler,{KEY_EVENTS:["keydown","keyup"],eventListener:null,observeElement:null,initialize:function(e,d,f){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.eventListener=OpenLayers.Function.bindAsEventListener(this.handleKeyEvent,this)},destroy:function(){this.deactivate();this.eventListener=null;OpenLayers.Handler.prototype.destroy.apply(this,arguments)},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.observeElement=this.observeElement||document;for(var d=0,c=this.KEY_EVENTS.length;d<c;d++){OpenLayers.Event.observe(this.observeElement,this.KEY_EVENTS[d],this.eventListener)}return !0}return !1},deactivate:function(){var d=!1;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){for(var d=0,c=this.KEY_EVENTS.length;d<c;d++){OpenLayers.Event.stopObserving(this.observeElement,this.KEY_EVENTS[d],this.eventListener)}d=!0}return d},handleKeyEvent:function(b){this.checkModifiers(b)&&this.callback(b.type,[b])},CLASS_NAME:"OpenLayers.Handler.Keyboard"});OpenLayers.Control.ModifyFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,clickout:!0,toggle:!0,standalone:!1,layer:null,feature:null,vertices:null,virtualVertices:null,selectControl:null,dragControl:null,handlers:null,deleteCodes:null,virtualStyle:null,vertexRenderIntent:null,mode:null,createVertices:!0,modified:!1,radiusHandle:null,dragHandle:null,onModificationStart:function(){},onModification:function(){},onModificationEnd:function(){},initialize:function(f,e){e=e||{};this.layer=f;this.vertices=[];this.virtualVertices=[];this.virtualStyle=OpenLayers.Util.extend({},this.layer.style||this.layer.styleMap.createSymbolizer(null,e.vertexRenderIntent));this.virtualStyle.fillOpacity=0.3;this.virtualStyle.strokeOpacity=0.3;this.deleteCodes=[46,68];this.mode=OpenLayers.Control.ModifyFeature.RESHAPE;OpenLayers.Control.prototype.initialize.apply(this,[e]);OpenLayers.Util.isArray(this.deleteCodes)||(this.deleteCodes=[this.deleteCodes]);var h=this,g={geometryTypes:this.geometryTypes,clickout:this.clickout,toggle:this.toggle,onBeforeSelect:this.beforeSelectFeature,onSelect:this.selectFeature,onUnselect:this.unselectFeature,scope:this};!1===this.standalone&&(this.selectControl=new OpenLayers.Control.SelectFeature(f,g));this.dragControl=new OpenLayers.Control.DragFeature(f,{geometryTypes:["OpenLayers.Geometry.Point"],onStart:function(d,c){h.dragStart.apply(h,[d,c])},onDrag:function(d,c){h.dragVertex.apply(h,[d,c])},onComplete:function(b){h.dragComplete.apply(h,[b])},featureCallbacks:{over:function(b){(h.standalone!==true||b._sketch||h.feature===b)&&h.dragControl.overFeature.apply(h.dragControl,[b])}}});this.handlers={keyboard:new OpenLayers.Handler.Keyboard(this,{keydown:this.handleKeypress})}},destroy:function(){this.layer=null;this.standalone||this.selectControl.destroy();this.dragControl.destroy();OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return(this.standalone||this.selectControl.activate())&&this.handlers.keyboard.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){var d=!1;if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.layer.removeFeatures(this.vertices,{silent:!0});this.layer.removeFeatures(this.virtualVertices,{silent:!0});this.vertices=[];this.dragControl.deactivate();var c=(d=this.feature)&&d.geometry&&d.layer;!1===this.standalone?(c&&this.selectControl.unselect.apply(this.selectControl,[d]),this.selectControl.deactivate()):c&&this.unselectFeature(d);this.handlers.keyboard.deactivate();d=!0}return d},beforeSelectFeature:function(b){return this.layer.events.triggerEvent("beforefeaturemodified",{feature:b})},selectFeature:function(d){if(!this.standalone||!1!==this.beforeSelectFeature(d)){this.feature=d,this.modified=!1,this.resetVertices(),this.dragControl.activate(),this.onModificationStart(this.feature)}var c=d.modified;if(d.geometry&&(!c||!c.geometry)){this._originalGeometry=d.geometry.clone()}},unselectFeature:function(b){this.layer.removeFeatures(this.vertices,{silent:!0});this.vertices=[];this.layer.destroyFeatures(this.virtualVertices,{silent:!0});this.virtualVertices=[];this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),delete this.dragHandle);this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),delete this.radiusHandle);this.feature=null;this.dragControl.deactivate();this.onModificationEnd(b);this.layer.events.triggerEvent("afterfeaturemodified",{feature:b,modified:this.modified});this.modified=!1},dragStart:function(d,c){if(d!=this.feature&&(!d.geometry.parent&&d!=this.dragHandle&&d!=this.radiusHandle)&&(!1===this.standalone&&this.feature&&this.selectControl.clickFeature.apply(this.selectControl,[this.feature]),null==this.geometryTypes||-1!=OpenLayers.Util.indexOf(this.geometryTypes,d.geometry.CLASS_NAME))){this.standalone||this.selectControl.clickFeature.apply(this.selectControl,[d]),this.dragControl.overFeature.apply(this.dragControl,[d]),this.dragControl.lastPixel=c,this.dragControl.handlers.drag.started=!0,this.dragControl.handlers.drag.start=c,this.dragControl.handlers.drag.last=c}},dragVertex:function(d,c){this.modified=!0;"OpenLayers.Geometry.Point"==this.feature.geometry.CLASS_NAME?(this.feature!=d&&(this.feature=d),this.layer.events.triggerEvent("vertexmodified",{vertex:d.geometry,feature:this.feature,pixel:c})):(d._index?(d.geometry.parent.addComponent(d.geometry,d._index),delete d._index,OpenLayers.Util.removeItem(this.virtualVertices,d),this.vertices.push(d)):d==this.dragHandle?(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[],this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null)):d!==this.radiusHandle&&this.layer.events.triggerEvent("vertexmodified",{vertex:d.geometry,feature:this.feature,pixel:c}),0<this.virtualVertices.length&&(this.layer.destroyFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]),this.layer.drawFeature(this.feature,this.standalone?void 0:this.selectControl.renderIntent));this.layer.drawFeature(d)},dragComplete:function(){this.resetVertices();this.setFeatureState();this.onModification(this.feature);this.layer.events.triggerEvent("featuremodified",{feature:this.feature})},setFeatureState:function(){if(this.feature.state!=OpenLayers.State.INSERT&&this.feature.state!=OpenLayers.State.DELETE&&(this.feature.state=OpenLayers.State.UPDATE,this.modified&&this._originalGeometry)){var b=this.feature;b.modified=OpenLayers.Util.extend(b.modified,{geometry:this._originalGeometry});delete this._originalGeometry}},resetVertices:function(){this.dragControl.feature&&this.dragControl.outFeature(this.dragControl.feature);0<this.vertices.length&&(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[]);0<this.virtualVertices.length&&(this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]);this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),this.dragHandle=null);this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null);this.feature&&"OpenLayers.Geometry.Point"!=this.feature.geometry.CLASS_NAME&&(this.mode&OpenLayers.Control.ModifyFeature.DRAG&&this.collectDragHandle(),this.mode&(OpenLayers.Control.ModifyFeature.ROTATE|OpenLayers.Control.ModifyFeature.RESIZE)&&this.collectRadiusHandle(),this.mode&OpenLayers.Control.ModifyFeature.RESHAPE&&(this.mode&OpenLayers.Control.ModifyFeature.RESIZE||this.collectVertices()))},handleKeypress:function(d){var c=d.keyCode;if(this.feature&&-1!=OpenLayers.Util.indexOf(this.deleteCodes,c)&&(c=this.dragControl.feature)&&-1!=OpenLayers.Util.indexOf(this.vertices,c)&&!this.dragControl.handlers.drag.dragging&&c.geometry.parent){c.geometry.parent.removeComponent(c.geometry),this.layer.events.triggerEvent("vertexremoved",{vertex:c.geometry,feature:this.feature,pixel:d.xy}),this.layer.drawFeature(this.feature,this.standalone?void 0:this.selectControl.renderIntent),this.modified=!0,this.resetVertices(),this.setFeatureState(),this.onModification(this.feature),this.layer.events.triggerEvent("featuremodified",{feature:this.feature})}},collectVertices:function(){function d(j){var i,h,b;if("OpenLayers.Geometry.Point"==j.CLASS_NAME){h=new OpenLayers.Feature.Vector(j),h._sketch=!0,h.renderIntent=c.vertexRenderIntent,c.vertices.push(h)}else{b=j.components.length;"OpenLayers.Geometry.LinearRing"==j.CLASS_NAME&&(b-=1);for(i=0;i<b;++i){h=j.components[i],"OpenLayers.Geometry.Point"==h.CLASS_NAME?(h=new OpenLayers.Feature.Vector(h),h._sketch=!0,h.renderIntent=c.vertexRenderIntent,c.vertices.push(h)):d(h)}if(c.createVertices&&"OpenLayers.Geometry.MultiPoint"!=j.CLASS_NAME){i=0;for(b=j.components.length;i<b-1;++i){h=j.components[i];var a=j.components[i+1];"OpenLayers.Geometry.Point"==h.CLASS_NAME&&"OpenLayers.Geometry.Point"==a.CLASS_NAME&&(h=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point((h.x+a.x)/2,(h.y+a.y)/2),null,c.virtualStyle),h.geometry.parent=j,h._index=i+1,h._sketch=!0,c.virtualVertices.push(h))}}}}this.vertices=[];this.virtualVertices=[];var c=this;d.call(this,this.feature.geometry);this.layer.addFeatures(this.virtualVertices,{silent:!0});this.layer.addFeatures(this.vertices,{silent:!0})},collectDragHandle:function(){var e=this.feature.geometry,d=e.getBounds().getCenterLonLat(),d=new OpenLayers.Geometry.Point(d.lon,d.lat),f=new OpenLayers.Feature.Vector(d);d.move=function(a,g){OpenLayers.Geometry.Point.prototype.move.call(this,a,g);e.move(a,g)};f._sketch=!0;this.dragHandle=f;this.dragHandle.renderIntent=this.vertexRenderIntent;this.layer.addFeatures([this.dragHandle],{silent:!0})},collectRadiusHandle:function(){var i=this.feature.geometry,h=i.getBounds(),n=h.getCenterLonLat(),m=new OpenLayers.Geometry.Point(n.lon,n.lat),h=new OpenLayers.Geometry.Point(h.right,h.bottom),n=new OpenLayers.Feature.Vector(h),l=this.mode&OpenLayers.Control.ModifyFeature.RESIZE,k=this.mode&OpenLayers.Control.ModifyFeature.RESHAPE,j=this.mode&OpenLayers.Control.ModifyFeature.ROTATE;h.move=function(d,r){OpenLayers.Geometry.Point.prototype.move.call(this,d,r);var g=this.x-m.x,f=this.y-m.y,a=g-d,e=f-r;if(j){var q=Math.atan2(e,a),q=Math.atan2(f,g)-q,q=q*(180/Math.PI);i.rotate(q,m)}if(l){var p;k?(f/=e,p=g/a/f):(a=Math.sqrt(a*a+e*e),f=Math.sqrt(g*g+f*f)/a);i.resize(f,m,p)}};n._sketch=!0;this.radiusHandle=n;this.radiusHandle.renderIntent=this.vertexRenderIntent;this.layer.addFeatures([this.radiusHandle],{silent:!0})},setMap:function(b){this.standalone||this.selectControl.setMap(b);this.dragControl.setMap(b);OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.ModifyFeature"});OpenLayers.Control.ModifyFeature.RESHAPE=1;OpenLayers.Control.ModifyFeature.RESIZE=2;OpenLayers.Control.ModifyFeature.ROTATE=4;OpenLayers.Control.ModifyFeature.DRAG=8;OpenLayers.Layer.Bing=OpenLayers.Class(OpenLayers.Layer.XYZ,{key:null,serverResolutions:[156543.03390625,78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.4962261962891,305.74811309814453,152.87405654907226,76.43702827453613,38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,0.5971642833948135,0.29858214169740677,0.14929107084870338,0.07464553542435169],attributionTemplate:'<span class="olBingAttribution ${type}"><div><a target="_blank" href="http://www.bing.com/maps/"><img src="${logo}" /></a></div>${copyrights}<a style="white-space: nowrap" target="_blank" href="http://www.microsoft.com/maps/product/terms.html">Terms of Use</a></span>',metadata:null,type:"Road",culture:"en-US",metadataParams:null,tileOptions:null,initialize:function(b){b=OpenLayers.Util.applyDefaults({sphericalMercator:!0},b);OpenLayers.Layer.XYZ.prototype.initialize.apply(this,[b.name||"Bing "+(b.type||this.type),null,b]);this.tileOptions=OpenLayers.Util.extend({crossOriginKeyword:"anonymous"},this.options.tileOptions);this.loadMetadata()},loadMetadata:function(){this._callbackId="_callback_"+this.id.replace(/\./g,"_");window[this._callbackId]=OpenLayers.Function.bind(OpenLayers.Layer.Bing.processMetadata,this);var d=OpenLayers.Util.applyDefaults({key:this.key,jsonp:this._callbackId,include:"ImageryProviders"},this.metadataParams),d="http://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.type+"?"+OpenLayers.Util.getParameterString(d),c=document.createElement("script");c.type="text/javascript";c.src=d;c.id=this._callbackId;document.getElementsByTagName("head")[0].appendChild(c)},initLayer:function(){var e=this.metadata.resourceSets[0].resources[0],d=e.imageUrl.replace("{quadkey}","${quadkey}"),d=d.replace("{culture}",this.culture);this.url=[];for(var f=0;f<e.imageUrlSubdomains.length;++f){this.url.push(d.replace("{subdomain}",e.imageUrlSubdomains[f]))}this.addOptions({maxResolution:Math.min(this.serverResolutions[e.zoomMin],this.maxResolution||Number.POSITIVE_INFINITY),numZoomLevels:Math.min(e.zoomMax+1-e.zoomMin,this.numZoomLevels)},!0)},getURL:function(i){if(this.url){for(var h=this.getXYZ(i),i=h.x,n=h.y,h=h.z,m=[],l=h;0<l;--l){var k="0",j=1<<l-1;0!=(i&j)&&k++;0!=(n&j)&&(k++,k++);m.push(k)}m=m.join("");i=this.selectUrl(""+i+n+h,this.url);return OpenLayers.String.format(i,{quadkey:m})}},updateAttribution:function(){var x=this.metadata;if(x.resourceSets&&this.map&&this.map.center){var w=x.resourceSets[0].resources[0],v=this.map.getExtent().transform(this.map.getProjectionObject(),new OpenLayers.Projection("EPSG:4326")),w=w.imageryProviders,u=OpenLayers.Util.indexOf(this.serverResolutions,this.getServerResolution()),t="",s,r,q,p,o,n,l;r=0;for(q=w.length;r<q;++r){s=w[r];p=0;for(o=s.coverageAreas.length;p<o;++p){l=s.coverageAreas[p],n=OpenLayers.Bounds.fromArray(l.bbox,!0),v.intersectsBounds(n)&&(u<=l.zoomMax&&u>=l.zoomMin)&&(t+=s.attribution+" ")}}this.attribution=OpenLayers.String.format(this.attributionTemplate,{type:this.type.toLowerCase(),logo:x.brandLogoUri,copyrights:t});this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"attribution"})}},setMap:function(){OpenLayers.Layer.XYZ.prototype.setMap.apply(this,arguments);this.updateAttribution();this.map.events.register("moveend",this,this.updateAttribution)},clone:function(b){null==b&&(b=new OpenLayers.Layer.Bing(this.options));return b=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[b])},destroy:function(){this.map&&this.map.events.unregister("moveend",this,this.updateAttribution);OpenLayers.Layer.XYZ.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.Bing"});OpenLayers.Layer.Bing.processMetadata=function(b){this.metadata=b;this.initLayer();b=document.getElementById(this._callbackId);b.parentNode.removeChild(b);window[this._callbackId]=void 0;delete this._callbackId};OpenLayers.Format=OpenLayers.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:!1,initialize:function(b){OpenLayers.Util.extend(this,b);this.options=b},destroy:function(){},read:function(){throw Error("Read not implemented.")},write:function(){throw Error("Write not implemented.")},CLASS_NAME:"OpenLayers.Format"});OpenLayers.Format.XML=OpenLayers.Class(OpenLayers.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(d){window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM"));OpenLayers.Format.prototype.initialize.apply(this,[d]);this.namespaces=OpenLayers.Util.extend({},this.namespaces);this.namespaceAlias={};for(var c in this.namespaces){this.namespaceAlias[this.namespaces[c]]=c}},destroy:function(){this.xmldom=null;OpenLayers.Format.prototype.destroy.apply(this,arguments)},setNamespace:function(d,c){this.namespaces[d]=c;this.namespaceAlias[c]=d},read:function(d){var c=d.indexOf("<");0<c&&(d=d.substring(c));c=OpenLayers.Util.Try(OpenLayers.Function.bind(function(){var a;a=window.ActiveXObject&&!this.xmldom?new ActiveXObject("Microsoft.XMLDOM"):this.xmldom;a.loadXML(d);return a},this),function(){return(new DOMParser).parseFromString(d,"text/xml")},function(){var a=new XMLHttpRequest;a.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(d),!1);a.overrideMimeType&&a.overrideMimeType("text/xml");a.send(null);return a.responseXML});this.keepData&&(this.data=c);return c},write:function(e){if(this.xmldom){e=e.xml}else{var d=new XMLSerializer;if(1==e.nodeType){var f=document.implementation.createDocument("","",null);f.importNode&&(e=f.importNode(e,!0));f.appendChild(e);e=d.serializeToString(f)}else{e=d.serializeToString(e)}}return e},createElementNS:function(d,c){return this.xmldom?"string"==typeof d?this.xmldom.createNode(1,c,d):this.xmldom.createNode(1,c,""):document.createElementNS(d,c)},createTextNode:function(b){"string"!==typeof b&&(b=""+b);return this.xmldom?this.xmldom.createTextNode(b):document.createTextNode(b)},getElementsByTagNameNS:function(j,i,p){var o=[];if(j.getElementsByTagNameNS){o=j.getElementsByTagNameNS(i,p)}else{for(var j=j.getElementsByTagName("*"),n,m,l=0,k=j.length;l<k;++l){if(n=j[l],m=n.prefix?n.prefix+":"+p:p,"*"==p||m==n.nodeName){("*"==i||i==n.namespaceURI)&&o.push(n)}}}return o},getAttributeNodeNS:function(j,i,p){var o=null;if(j.getAttributeNodeNS){o=j.getAttributeNodeNS(i,p)}else{for(var j=j.attributes,n,m,l=0,k=j.length;l<k;++l){if(n=j[l],n.namespaceURI==i&&(m=n.prefix?n.prefix+":"+p:p,m==n.nodeName)){o=n;break}}}return o},getAttributeNS:function(f,e,h){var g="";if(f.getAttributeNS){g=f.getAttributeNS(e,h)||""}else{if(f=this.getAttributeNodeNS(f,e,h)){g=f.nodeValue}}return g},getChildValue:function(f,e){var h=e||"";if(f){for(var g=f.firstChild;g;g=g.nextSibling){switch(g.nodeType){case 3:case 4:h+=g.nodeValue}}}return h},isSimpleContent:function(d){for(var c=!0,d=d.firstChild;d;d=d.nextSibling){if(1===d.nodeType){c=!1;break}}return c},contentType:function(f){for(var e=!1,h=!1,g=OpenLayers.Format.XML.CONTENT_TYPE.EMPTY,f=f.firstChild;f;f=f.nextSibling){switch(f.nodeType){case 1:h=!0;break;case 8:break;default:e=!0}if(h&&e){break}}if(h&&e){g=OpenLayers.Format.XML.CONTENT_TYPE.MIXED}else{if(h){return OpenLayers.Format.XML.CONTENT_TYPE.COMPLEX}if(e){return OpenLayers.Format.XML.CONTENT_TYPE.SIMPLE}}return g},hasAttributeNS:function(f,e,h){var g=!1;return g=f.hasAttributeNS?f.hasAttributeNS(e,h):!!this.getAttributeNodeNS(f,e,h)},setAttributeNS:function(f,e,h,g){if(f.setAttributeNS){f.setAttributeNS(e,h,g)}else{if(this.xmldom){e?(e=f.ownerDocument.createNode(2,h,e),e.nodeValue=g,f.setAttributeNode(e)):f.setAttribute(h,g)}else{throw"setAttributeNS not implemented"}}},createElementNSPlus:function(f,e){var e=e||{},h=e.uri||this.namespaces[e.prefix];h||(h=f.indexOf(":"),h=this.namespaces[f.substring(0,h)]);h||(h=this.namespaces[this.defaultPrefix]);h=this.createElementNS(h,f);e.attributes&&this.setAttributes(h,e.attributes);var g=e.value;null!=g&&h.appendChild(this.createTextNode(g));return h},setAttributes:function(g,f){var j,i,h;for(h in f){null!=f[h]&&f[h].toString&&(j=f[h].toString(),i=this.namespaces[h.substring(0,h.indexOf(":"))]||null,this.setAttributeNS(g,i,h,j))}},readNode:function(f,e){e||(e={});var h=this.readers[f.namespaceURI?this.namespaceAlias[f.namespaceURI]:this.defaultPrefix];if(h){var g=f.localName||f.nodeName.split(":").pop();(h=h[g]||h["*"])&&h.apply(this,[f,e])}return e},readChildNodes:function(h,g){g||(g={});for(var l=h.childNodes,k,j=0,i=l.length;j<i;++j){k=l[j],1==k.nodeType&&this.readNode(k,g)}return g},writeNode:function(g,f,j){var i,h=g.indexOf(":");0<h?(i=g.substring(0,h),g=g.substring(h+1)):i=j?this.namespaceAlias[j.namespaceURI]:this.defaultPrefix;f=this.writers[i][g].apply(this,[f]);j&&j.appendChild(f);return f},getChildEl:function(e,d,f){return e&&this.getThisOrNextEl(e.firstChild,d,f)},getNextEl:function(e,d,f){return e&&this.getThisOrNextEl(e.nextSibling,d,f)},getThisOrNextEl:function(e,d,f){e:for(;e;e=e.nextSibling){switch(e.nodeType){case 1:if((!d||d===(e.localName||e.nodeName.split(":").pop()))&&(!f||f===e.namespaceURI)){break e}e=null;break e;case 3:if(/^\s*$/.test(e.nodeValue)){break}case 4:case 6:case 12:case 10:case 11:e=null;break e}}return e||null},lookupNamespaceURI:function(g,f){var j=null;if(g){if(g.lookupNamespaceURI){j=g.lookupNamespaceURI(f)}else{g:switch(g.nodeType){case 1:if(null!==g.namespaceURI&&g.prefix===f){j=g.namespaceURI;break g}if(j=g.attributes.length){for(var i,h=0;h<j;++h){if(i=g.attributes[h],"xmlns"===i.prefix&&i.name==="xmlns:"+f){j=i.value||null;break g}else{if("xmlns"===i.name&&null===f){j=i.value||null;break g}}}}j=this.lookupNamespaceURI(g.parentNode,f);break g;case 2:j=this.lookupNamespaceURI(g.ownerElement,f);break g;case 9:j=this.lookupNamespaceURI(g.documentElement,f);break g;case 6:case 12:case 10:case 11:break g;default:j=this.lookupNamespaceURI(g.parentNode,f)}}}return j},getXMLDoc:function(){!OpenLayers.Format.XML.document&&!this.xmldom&&(document.implementation&&document.implementation.createDocument?OpenLayers.Format.XML.document=document.implementation.createDocument("","",null):!this.xmldom&&window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM")));return OpenLayers.Format.XML.document||this.xmldom},CLASS_NAME:"OpenLayers.Format.XML"});OpenLayers.Format.XML.CONTENT_TYPE={EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3};OpenLayers.Format.XML.lookupNamespaceURI=OpenLayers.Function.bind(OpenLayers.Format.XML.prototype.lookupNamespaceURI,OpenLayers.Format.XML.prototype);OpenLayers.Format.XML.document=null;OpenLayers.Geometry.MultiLineString=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LineString"],split:function(D,C){for(var B=null,A=C&&C.mutual,z,y,x,w,v=[],u=[D],t=0,r=this.components.length;t<r;++t){y=this.components[t];x=!1;for(var s=0;s<u.length;++s){if(z=y.split(u[s],C)){if(A){x=z[0];for(var q=0,p=x.length;q<p;++q){0===q&&v.length?v[v.length-1].addComponent(x[q]):v.push(new OpenLayers.Geometry.MultiLineString([x[q]]))}x=!0;z=z[1]}if(z.length){z.unshift(s,1);Array.prototype.splice.apply(u,z);break}}}x||(v.length?v[v.length-1].addComponent(y.clone()):v=[new OpenLayers.Geometry.MultiLineString(y.clone())])}v&&1<v.length?x=!0:v=[];u&&1<u.length?w=!0:u=[];if(x||w){B=A?[v,u]:u}return B},splitWith:function(B,A){var z=null,y=A&&A.mutual,x,w,v,u,t,s;if(B instanceof OpenLayers.Geometry.LineString){s=[];t=[B];for(var r=0,p=this.components.length;r<p;++r){v=!1;w=this.components[r];for(var q=0;q<t.length;++q){if(x=t[q].split(w,A)){y&&(v=x[0],v.length&&(v.unshift(q,1),Array.prototype.splice.apply(t,v),q+=v.length-2),x=x[1],0===x.length&&(x=[w.clone()]));v=0;for(var o=x.length;v<o;++v){0===v&&s.length?s[s.length-1].addComponent(x[v]):s.push(new OpenLayers.Geometry.MultiLineString([x[v]]))}v=!0}}v||(s.length?s[s.length-1].addComponent(w.clone()):s=[new OpenLayers.Geometry.MultiLineString([w.clone()])])}}else{z=B.split(this)}t&&1<t.length?u=!0:t=[];s&&1<s.length?v=!0:s=[];if(u||v){z=y?[t,s]:s}return z},CLASS_NAME:"OpenLayers.Geometry.MultiLineString"});OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LinearRing"],getArea:function(){var e=0;if(this.components&&0<this.components.length){for(var e=e+Math.abs(this.components[0].getArea()),d=1,f=this.components.length;d<f;d++){e-=Math.abs(this.components[d].getArea())}}return e},getGeodesicArea:function(f){var e=0;if(this.components&&0<this.components.length){for(var e=e+Math.abs(this.components[0].getGeodesicArea(f)),h=1,g=this.components.length;h<g;h++){e-=Math.abs(this.components[h].getGeodesicArea(f))}}return e},containsPoint:function(g){var f=this.components.length,j=!1;if(0<f&&(j=this.components[0].containsPoint(g),1!==j&&j&&1<f)){for(var i,h=1;h<f;++h){if(i=this.components[h].containsPoint(g)){j=1===i?1:!1;break}}}return j},intersects:function(g){var f=!1,j,i;if("OpenLayers.Geometry.Point"==g.CLASS_NAME){f=this.containsPoint(g)}else{if("OpenLayers.Geometry.LineString"==g.CLASS_NAME||"OpenLayers.Geometry.LinearRing"==g.CLASS_NAME){j=0;for(i=this.components.length;j<i&&!(f=g.intersects(this.components[j]));++j){}if(!f){j=0;for(i=g.components.length;j<i&&!(f=this.containsPoint(g.components[j]));++j){}}}else{j=0;for(i=g.components.length;j<i&&!(f=this.intersects(g.components[j]));++j){}}}if(!f&&"OpenLayers.Geometry.Polygon"==g.CLASS_NAME){var h=this.components[0];j=0;for(i=h.components.length;j<i&&!(f=g.containsPoint(h.components[j]));++j){}}return f},distanceTo:function(d,c){return c&&!1===c.edge&&this.intersects(d)?0:OpenLayers.Geometry.Collection.prototype.distanceTo.apply(this,[d,c])},CLASS_NAME:"OpenLayers.Geometry.Polygon"});OpenLayers.Geometry.Polygon.createRegularPolygon=function(j,i,p,o){var n=Math.PI*(1/p-0.5);o&&(n+=o/180*Math.PI);for(var m,l=[],k=0;k<p;++k){m=n+2*k*Math.PI/p,o=j.x+i*Math.cos(m),m=j.y+i*Math.sin(m),l.push(new OpenLayers.Geometry.Point(o,m))}j=new OpenLayers.Geometry.LinearRing(l);return new OpenLayers.Geometry.Polygon([j])};OpenLayers.Geometry.MultiPolygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Polygon"],CLASS_NAME:"OpenLayers.Geometry.MultiPolygon"});OpenLayers.Format.GML=OpenLayers.Class(OpenLayers.Format.XML,{featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureName:"featureMember",layerName:"features",geometryName:"geometry",collectionName:"FeatureCollection",gmlns:"http://www.opengis.net/gml",extractAttributes:!0,xy:!0,initialize:function(b){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g};OpenLayers.Format.XML.prototype.initialize.apply(this,[b])},read:function(f){"string"==typeof f&&(f=OpenLayers.Format.XML.prototype.read.apply(this,[f]));for(var f=this.getElementsByTagNameNS(f.documentElement,this.gmlns,this.featureName),e=[],h=0;h<f.length;h++){var g=this.parseFeature(f[h]);g&&e.push(g)}return e},parseFeature:function(r){for(var q="MultiPolygon Polygon MultiLineString LineString MultiPoint Point Envelope".split(" "),p,o,n,m=0;m<q.length;++m){if(p=q[m],o=this.getElementsByTagNameNS(r,this.gmlns,p),0<o.length){if(n=this.parseGeometry[p.toLowerCase()]){n=n.apply(this,[o[0]]),this.internalProjection&&this.externalProjection&&n.transform(this.externalProjection,this.internalProjection)}else{throw new TypeError("Unsupported geometry type: "+p)}break}}var l;p=this.getElementsByTagNameNS(r,this.gmlns,"Box");for(m=0;m<p.length;++m){q=p[m],o=this.parseGeometry.box.apply(this,[q]),q=q.parentNode,"boundedBy"===(q.localName||q.nodeName.split(":").pop())?l=o:n=o.toGeometry()}var k;this.extractAttributes&&(k=this.parseAttributes(r));k=new OpenLayers.Feature.Vector(n,k);k.bounds=l;k.gml={featureType:r.firstChild.nodeName.split(":")[1],featureNS:r.firstChild.namespaceURI,featureNSPrefix:r.firstChild.prefix};for(var r=r.firstChild,j;r&&!(1==r.nodeType&&(j=r.getAttribute("fid")||r.getAttribute("id")));){r=r.nextSibling}k.fid=j;return k},parseGeometry:{point:function(e){var d,f;f=[];d=this.getElementsByTagNameNS(e,this.gmlns,"pos");0<d.length&&(f=d[0].firstChild.nodeValue,f=f.replace(this.regExes.trimSpace,""),f=f.split(this.regExes.splitSpace));0==f.length&&(d=this.getElementsByTagNameNS(e,this.gmlns,"coordinates"),0<d.length&&(f=d[0].firstChild.nodeValue,f=f.replace(this.regExes.removeSpace,""),f=f.split(",")));0==f.length&&(d=this.getElementsByTagNameNS(e,this.gmlns,"coord"),0<d.length&&(e=this.getElementsByTagNameNS(d[0],this.gmlns,"X"),d=this.getElementsByTagNameNS(d[0],this.gmlns,"Y"),0<e.length&&0<d.length&&(f=[e[0].firstChild.nodeValue,d[0].firstChild.nodeValue])));2==f.length&&(f[2]=null);return this.xy?new OpenLayers.Geometry.Point(f[0],f[1],f[2]):new OpenLayers.Geometry.Point(f[1],f[0],f[2])},multipoint:function(f){var f=this.getElementsByTagNameNS(f,this.gmlns,"Point"),e=[];if(0<f.length){for(var h,g=0;g<f.length;++g){(h=this.parseGeometry.point.apply(this,[f[g]]))&&e.push(h)}}return new OpenLayers.Geometry.MultiPoint(e)},linestring:function(r,q){var p,o;o=[];var n=[];p=this.getElementsByTagNameNS(r,this.gmlns,"posList");if(0<p.length){o=this.getChildValue(p[0]);o=o.replace(this.regExes.trimSpace,"");o=o.split(this.regExes.splitSpace);var m=parseInt(p[0].getAttribute("dimension")),l,k,j;for(p=0;p<o.length/m;++p){l=p*m,k=o[l],j=o[l+1],l=2==m?null:o[l+2],this.xy?n.push(new OpenLayers.Geometry.Point(k,j,l)):n.push(new OpenLayers.Geometry.Point(j,k,l))}}if(0==o.length&&(p=this.getElementsByTagNameNS(r,this.gmlns,"coordinates"),0<p.length)){o=this.getChildValue(p[0]);o=o.replace(this.regExes.trimSpace,"");o=o.replace(this.regExes.trimComma,",");m=o.split(this.regExes.splitSpace);for(p=0;p<m.length;++p){o=m[p].split(","),2==o.length&&(o[2]=null),this.xy?n.push(new OpenLayers.Geometry.Point(o[0],o[1],o[2])):n.push(new OpenLayers.Geometry.Point(o[1],o[0],o[2]))}}o=null;0!=n.length&&(o=q?new OpenLayers.Geometry.LinearRing(n):new OpenLayers.Geometry.LineString(n));return o},multilinestring:function(f){var f=this.getElementsByTagNameNS(f,this.gmlns,"LineString"),e=[];if(0<f.length){for(var h,g=0;g<f.length;++g){(h=this.parseGeometry.linestring.apply(this,[f[g]]))&&e.push(h)}}return new OpenLayers.Geometry.MultiLineString(e)},polygon:function(f){var f=this.getElementsByTagNameNS(f,this.gmlns,"LinearRing"),e=[];if(0<f.length){for(var h,g=0;g<f.length;++g){(h=this.parseGeometry.linestring.apply(this,[f[g],!0]))&&e.push(h)}}return new OpenLayers.Geometry.Polygon(e)},multipolygon:function(f){var f=this.getElementsByTagNameNS(f,this.gmlns,"Polygon"),e=[];if(0<f.length){for(var h,g=0;g<f.length;++g){(h=this.parseGeometry.polygon.apply(this,[f[g]]))&&e.push(h)}}return new OpenLayers.Geometry.MultiPolygon(e)},envelope:function(i){var h=[],n,m,l=this.getElementsByTagNameNS(i,this.gmlns,"lowerCorner");if(0<l.length){n=[];0<l.length&&(n=l[0].firstChild.nodeValue,n=n.replace(this.regExes.trimSpace,""),n=n.split(this.regExes.splitSpace));2==n.length&&(n[2]=null);var k=this.xy?new OpenLayers.Geometry.Point(n[0],n[1],n[2]):new OpenLayers.Geometry.Point(n[1],n[0],n[2])}i=this.getElementsByTagNameNS(i,this.gmlns,"upperCorner");if(0<i.length){n=[];0<i.length&&(n=i[0].firstChild.nodeValue,n=n.replace(this.regExes.trimSpace,""),n=n.split(this.regExes.splitSpace));2==n.length&&(n[2]=null);var j=this.xy?new OpenLayers.Geometry.Point(n[0],n[1],n[2]):new OpenLayers.Geometry.Point(n[1],n[0],n[2])}k&&j&&(h.push(new OpenLayers.Geometry.Point(k.x,k.y)),h.push(new OpenLayers.Geometry.Point(j.x,k.y)),h.push(new OpenLayers.Geometry.Point(j.x,j.y)),h.push(new OpenLayers.Geometry.Point(k.x,j.y)),h.push(new OpenLayers.Geometry.Point(k.x,k.y)),h=new OpenLayers.Geometry.LinearRing(h),m=new OpenLayers.Geometry.Polygon([h]));return m},box:function(e){var d=this.getElementsByTagNameNS(e,this.gmlns,"coordinates"),f=e=null;0<d.length&&(d=d[0].firstChild.nodeValue,d=d.split(" "),2==d.length&&(e=d[0].split(","),f=d[1].split(",")));if(null!==e&&null!==f){return new OpenLayers.Bounds(parseFloat(e[0]),parseFloat(e[1]),parseFloat(f[0]),parseFloat(f[1]))}}},parseAttributes:function(g){for(var f={},g=g.firstChild,j,i,h;g;){if(1==g.nodeType){g=g.childNodes;for(j=0;j<g.length;++j){if(i=g[j],1==i.nodeType){if(h=i.childNodes,1==h.length){if(h=h[0],3==h.nodeType||4==h.nodeType){i=i.prefix?i.nodeName.split(":")[1]:i.nodeName,h=h.nodeValue.replace(this.regExes.trimSpace,""),f[i]=h}}else{f[i.nodeName.split(":").pop()]=null}}}break}g=g.nextSibling}return f},write:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var d=this.createElementNS("http://www.opengis.net/wfs","wfs:"+this.collectionName),f=0;f<e.length;f++){d.appendChild(this.createFeatureXML(e[f]))}return OpenLayers.Format.XML.prototype.write.apply(this,[d])},createFeatureXML:function(h){var g=this.buildGeometryNode(h.geometry),l=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.geometryName);l.appendChild(g);var g=this.createElementNS(this.gmlns,"gml:"+this.featureName),k=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.layerName);k.setAttribute("fid",h.fid||h.id);k.appendChild(l);for(var j in h.attributes){var l=this.createTextNode(h.attributes[j]),i=this.createElementNS(this.featureNS,this.featurePrefix+":"+j.substring(j.lastIndexOf(":")+1));i.appendChild(l);k.appendChild(i)}g.appendChild(k);return g},buildGeometryNode:function(d){this.externalProjection&&this.internalProjection&&(d=d.clone(),d.transform(this.internalProjection,this.externalProjection));var c=d.CLASS_NAME;return this.buildGeometry[c.substring(c.lastIndexOf(".")+1).toLowerCase()].apply(this,[d])},buildGeometry:{point:function(d){var c=this.createElementNS(this.gmlns,"gml:Point");c.appendChild(this.buildCoordinatesNode(d));return c},multipoint:function(g){for(var f=this.createElementNS(this.gmlns,"gml:MultiPoint"),g=g.components,j,i,h=0;h<g.length;h++){j=this.createElementNS(this.gmlns,"gml:pointMember"),i=this.buildGeometry.point.apply(this,[g[h]]),j.appendChild(i),f.appendChild(j)}return f},linestring:function(d){var c=this.createElementNS(this.gmlns,"gml:LineString");c.appendChild(this.buildCoordinatesNode(d));return c},multilinestring:function(g){for(var f=this.createElementNS(this.gmlns,"gml:MultiLineString"),g=g.components,j,i,h=0;h<g.length;++h){j=this.createElementNS(this.gmlns,"gml:lineStringMember"),i=this.buildGeometry.linestring.apply(this,[g[h]]),j.appendChild(i),f.appendChild(j)}return f},linearring:function(d){var c=this.createElementNS(this.gmlns,"gml:LinearRing");c.appendChild(this.buildCoordinatesNode(d));return c},polygon:function(g){for(var f=this.createElementNS(this.gmlns,"gml:Polygon"),g=g.components,j,i,h=0;h<g.length;++h){j=0==h?"outerBoundaryIs":"innerBoundaryIs",j=this.createElementNS(this.gmlns,"gml:"+j),i=this.buildGeometry.linearring.apply(this,[g[h]]),j.appendChild(i),f.appendChild(j)}return f},multipolygon:function(g){for(var f=this.createElementNS(this.gmlns,"gml:MultiPolygon"),g=g.components,j,i,h=0;h<g.length;++h){j=this.createElementNS(this.gmlns,"gml:polygonMember"),i=this.buildGeometry.polygon.apply(this,[g[h]]),j.appendChild(i),f.appendChild(j)}return f},bounds:function(d){var c=this.createElementNS(this.gmlns,"gml:Box");c.appendChild(this.buildCoordinatesNode(d));return c}},buildCoordinatesNode:function(f){var e=this.createElementNS(this.gmlns,"gml:coordinates");e.setAttribute("decimal",".");e.setAttribute("cs",",");e.setAttribute("ts"," ");var h=[];if(f instanceof OpenLayers.Bounds){h.push(f.left+","+f.bottom),h.push(f.right+","+f.top)}else{for(var f=f.components?f.components:[f],g=0;g<f.length;g++){h.push(f[g].x+","+f[g].y)}}h=this.createTextNode(h.join(" "));e.appendChild(h);return e},CLASS_NAME:"OpenLayers.Format.GML"});OpenLayers.Format.GML||(OpenLayers.Format.GML={});OpenLayers.Format.GML.Base=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs"},defaultPrefix:"gml",schemaLocation:null,featureType:null,featureNS:null,geometryName:"geometry",extractAttributes:!0,srsName:null,xy:!0,geometryTypes:null,singleFeatureType:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,featureMember:/^(.*:)?featureMembers?$/},initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b]);this.setGeometryTypes();b&&b.featureNS&&this.setNamespace("feature",b.featureNS);this.singleFeatureType=!b||typeof b.featureType==="string"},read:function(f){typeof f=="string"&&(f=OpenLayers.Format.XML.prototype.read.apply(this,[f]));if(f&&f.nodeType==9){f=f.documentElement}var e=[];this.readNode(f,{features:e},true);if(e.length==0){var h=this.getElementsByTagNameNS(f,this.namespaces.gml,"featureMember");if(h.length){for(var f=0,g=h.length;f<g;++f){this.readNode(h[f],{features:e},true)}}else{h=this.getElementsByTagNameNS(f,this.namespaces.gml,"featureMembers");h.length&&this.readNode(h[0],{features:e},true)}}return e},readNode:function(e,d,f){if(f===true&&this.autoConfig===true){this.featureType=null;delete this.namespaceAlias[this.featureNS];delete this.namespaces.feature;this.featureNS=null}if(!this.featureNS&&!(e.prefix in this.namespaces)&&e.parentNode.namespaceURI==this.namespaces.gml&&this.regExes.featureMember.test(e.parentNode.nodeName)){this.featureType=e.nodeName.split(":").pop();this.setNamespace("feature",e.namespaceURI);this.featureNS=e.namespaceURI;this.autoConfig=true}return OpenLayers.Format.XML.prototype.readNode.apply(this,[e,d])},readers:{gml:{featureMember:function(d,c){this.readChildNodes(d,c)},featureMembers:function(d,c){this.readChildNodes(d,c)},name:function(d,c){c.name=this.getChildValue(d)},boundedBy:function(e,d){var f={};this.readChildNodes(e,f);if(f.components&&f.components.length>0){d.bounds=f.components[0]}},Point:function(e,d){var f={points:[]};this.readChildNodes(e,f);if(!d.components){d.components=[]}d.components.push(f.points[0])},coordinates:function(i,h){for(var n=this.getChildValue(i).replace(this.regExes.trimSpace,""),n=n.replace(this.regExes.trimComma,","),n=n.split(this.regExes.splitSpace),m,l=n.length,k=Array(l),j=0;j<l;++j){m=n[j].split(",");k[j]=this.xy?new OpenLayers.Geometry.Point(m[0],m[1],m[2]):new OpenLayers.Geometry.Point(m[1],m[0],m[2])}h.points=k},coord:function(e,d){var f={};this.readChildNodes(e,f);if(!d.points){d.points=[]}d.points.push(new OpenLayers.Geometry.Point(f.x,f.y,f.z))},X:function(d,c){c.x=this.getChildValue(d)},Y:function(d,c){c.y=this.getChildValue(d)},Z:function(d,c){c.z=this.getChildValue(d)},MultiPoint:function(e,d){var f={components:[]};this.readChildNodes(e,f);d.components=[new OpenLayers.Geometry.MultiPoint(f.components)]},pointMember:function(d,c){this.readChildNodes(d,c)},LineString:function(e,d){var f={};this.readChildNodes(e,f);if(!d.components){d.components=[]}d.components.push(new OpenLayers.Geometry.LineString(f.points))},MultiLineString:function(e,d){var f={components:[]};this.readChildNodes(e,f);d.components=[new OpenLayers.Geometry.MultiLineString(f.components)]},lineStringMember:function(d,c){this.readChildNodes(d,c)},Polygon:function(e,d){var f={outer:null,inner:[]};this.readChildNodes(e,f);f.inner.unshift(f.outer);if(!d.components){d.components=[]}d.components.push(new OpenLayers.Geometry.Polygon(f.inner))},LinearRing:function(e,d){var f={};this.readChildNodes(e,f);d.components=[new OpenLayers.Geometry.LinearRing(f.points)]},MultiPolygon:function(e,d){var f={components:[]};this.readChildNodes(e,f);d.components=[new OpenLayers.Geometry.MultiPolygon(f.components)]},polygonMember:function(d,c){this.readChildNodes(d,c)},GeometryCollection:function(e,d){var f={components:[]};this.readChildNodes(e,f);d.components=[new OpenLayers.Geometry.Collection(f.components)]},geometryMember:function(d,c){this.readChildNodes(d,c)}},feature:{"*":function(f,e){var h,g=f.localName||f.nodeName.split(":").pop();e.features?!this.singleFeatureType&&OpenLayers.Util.indexOf(this.featureType,g)!==-1?h="_typeName":g===this.featureType&&(h="_typeName"):f.childNodes.length==0||f.childNodes.length==1&&f.firstChild.nodeType==3?this.extractAttributes&&(h="_attribute"):h="_geometry";h&&this.readers.feature[h].apply(this,[f,e])},_typeName:function(g,f){var j={components:[],attributes:{}};this.readChildNodes(g,j);if(j.name){j.attributes.name=j.name}var i=new OpenLayers.Feature.Vector(j.components[0],j.attributes);if(!this.singleFeatureType){i.type=g.nodeName.split(":").pop();i.namespace=g.namespaceURI}var h=g.getAttribute("fid")||this.getAttributeNS(g,this.namespaces.gml,"id");if(h){i.fid=h}this.internalProjection&&(this.externalProjection&&i.geometry)&&i.geometry.transform(this.externalProjection,this.internalProjection);if(j.bounds){i.bounds=j.bounds}f.features.push(i)},_geometry:function(d,c){if(!this.geometryName){this.geometryName=d.nodeName.split(":").pop()}this.readChildNodes(d,c)},_attribute:function(f,e){var h=f.localName||f.nodeName.split(":").pop(),g=this.getChildValue(f);e.attributes[h]=g}},wfs:{FeatureCollection:function(d,c){this.readChildNodes(d,c)}}},write:function(b){b=this.writeNode("gml:"+(OpenLayers.Util.isArray(b)?"featureMembers":"featureMember"),b);this.setAttributeNS(b,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},writers:{gml:{featureMember:function(d){var c=this.createElementNSPlus("gml:featureMember");this.writeNode("feature:_typeName",d,c);return c},MultiPoint:function(f){for(var e=this.createElementNSPlus("gml:MultiPoint"),f=f.components||[f],h=0,g=f.length;h<g;++h){this.writeNode("pointMember",f[h],e)}return e},pointMember:function(d){var c=this.createElementNSPlus("gml:pointMember");this.writeNode("Point",d,c);return c},MultiLineString:function(f){for(var e=this.createElementNSPlus("gml:MultiLineString"),f=f.components||[f],h=0,g=f.length;h<g;++h){this.writeNode("lineStringMember",f[h],e)}return e},lineStringMember:function(d){var c=this.createElementNSPlus("gml:lineStringMember");this.writeNode("LineString",d,c);return c},MultiPolygon:function(f){for(var e=this.createElementNSPlus("gml:MultiPolygon"),f=f.components||[f],h=0,g=f.length;h<g;++h){this.writeNode("polygonMember",f[h],e)}return e},polygonMember:function(d){var c=this.createElementNSPlus("gml:polygonMember");this.writeNode("Polygon",d,c);return c},GeometryCollection:function(f){for(var e=this.createElementNSPlus("gml:GeometryCollection"),h=0,g=f.components.length;h<g;++h){this.writeNode("geometryMember",f.components[h],e)}return e},geometryMember:function(d){var c=this.createElementNSPlus("gml:geometryMember"),d=this.writeNode("feature:_geometry",d);c.appendChild(d.firstChild);return c}},feature:{_typeName:function(f){var e=this.createElementNSPlus("feature:"+this.featureType,{attributes:{fid:f.fid}});f.geometry&&this.writeNode("feature:_geometry",f.geometry,e);for(var h in f.attributes){var g=f.attributes[h];g!=null&&this.writeNode("feature:_attribute",{name:h,value:g},e)}return e},_geometry:function(d){this.externalProjection&&this.internalProjection&&(d=d.clone().transform(this.internalProjection,this.externalProjection));var c=this.createElementNSPlus("feature:"+this.geometryName),d=this.writeNode("gml:"+this.geometryTypes[d.CLASS_NAME],d,c);this.srsName&&d.setAttribute("srsName",this.srsName);return c},_attribute:function(b){return this.createElementNSPlus("feature:"+b.name,{value:b.value})}},wfs:{FeatureCollection:function(f){for(var e=this.createElementNSPlus("wfs:FeatureCollection"),h=0,g=f.length;h<g;++h){this.writeNode("gml:featureMember",f[h],e)}return e}}},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":"LineString","OpenLayers.Geometry.MultiLineString":"MultiLineString","OpenLayers.Geometry.Polygon":"Polygon","OpenLayers.Geometry.MultiPolygon":"MultiPolygon","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.Base"});OpenLayers.Format.OGCExceptionReport=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},defaultPrefix:"ogc",read:function(d){"string"==typeof d&&(d=OpenLayers.Format.XML.prototype.read.apply(this,[d]));var c={exceptionReport:null};d.documentElement&&(this.readChildNodes(d,c),null===c.exceptionReport&&(c=(new OpenLayers.Format.OWSCommon).read(d)));return c},readers:{ogc:{ServiceExceptionReport:function(d,c){c.exceptionReport={exceptions:[]};this.readChildNodes(d,c.exceptionReport)},ServiceException:function(e,d){var f={code:e.getAttribute("code"),locator:e.getAttribute("locator"),text:this.getChildValue(e)};d.exceptions.push(f)}}},CLASS_NAME:"OpenLayers.Format.OGCExceptionReport"});OpenLayers.Format.XML.VersionedOGC=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:null,version:null,profile:null,errorProperty:null,name:null,stringifyOutput:!1,parser:null,initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b]);b=this.CLASS_NAME;this.name=b.substring(b.lastIndexOf(".")+1)},getVersion:function(e,d){var f;e?(f=this.version,f||(f=e.getAttribute("version"),f||(f=this.defaultVersion))):f=d&&d.version||this.version||this.defaultVersion;return f},getParser:function(e){var e=e||this.defaultVersion,d=this.profile?"_"+this.profile:"";if(!this.parser||this.parser.VERSION!=e){var f=OpenLayers.Format[this.name]["v"+e.replace(/\./g,"_")+d];if(!f){throw"Can't find a "+this.name+" parser for version "+e+d}this.parser=new f(this.options)}return this.parser},write:function(e,d){this.parser=this.getParser(this.getVersion(null,d));var f=this.parser.write(e,d);return !1===this.stringifyOutput?f:OpenLayers.Format.XML.prototype.write.apply(this,[f])},read:function(g,f){"string"==typeof g&&(g=OpenLayers.Format.XML.prototype.read.apply(this,[g]));var j=this.getVersion(g.documentElement);this.parser=this.getParser(j);var i=this.parser.read(g,f);if(null!==this.errorProperty&&void 0===i[this.errorProperty]){var h=new OpenLayers.Format.OGCExceptionReport;i.error=h.read(g)}i.version=j;return i},CLASS_NAME:"OpenLayers.Format.XML.VersionedOGC"});OpenLayers.Filter=OpenLayers.Class({initialize:function(b){OpenLayers.Util.extend(this,b)},destroy:function(){},evaluate:function(){return !0},clone:function(){return null},toString:function(){return OpenLayers.Format&&OpenLayers.Format.CQL?OpenLayers.Format.CQL.prototype.write(this):Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Filter"});OpenLayers.Filter.FeatureId=OpenLayers.Class(OpenLayers.Filter,{fids:null,type:"FID",initialize:function(b){this.fids=[];OpenLayers.Filter.prototype.initialize.apply(this,[b])},evaluate:function(e){for(var d=0,f=this.fids.length;d<f;d++){if((e.fid||e.id)==this.fids[d]){return !0}}return !1},clone:function(){var b=new OpenLayers.Filter.FeatureId;OpenLayers.Util.extend(b,this);b.fids=this.fids.slice();return b},CLASS_NAME:"OpenLayers.Filter.FeatureId"});OpenLayers.Filter.Logical=OpenLayers.Class(OpenLayers.Filter,{filters:null,type:null,initialize:function(b){this.filters=[];OpenLayers.Filter.prototype.initialize.apply(this,[b])},destroy:function(){this.filters=null;OpenLayers.Filter.prototype.destroy.apply(this)},evaluate:function(e){var d,f;switch(this.type){case OpenLayers.Filter.Logical.AND:d=0;for(f=this.filters.length;d<f;d++){if(!1==this.filters[d].evaluate(e)){return !1}}return !0;case OpenLayers.Filter.Logical.OR:d=0;for(f=this.filters.length;d<f;d++){if(!0==this.filters[d].evaluate(e)){return !0}}return !1;case OpenLayers.Filter.Logical.NOT:return !this.filters[0].evaluate(e)}},clone:function(){for(var e=[],d=0,f=this.filters.length;d<f;++d){e.push(this.filters[d].clone())}return new OpenLayers.Filter.Logical({type:this.type,filters:e})},CLASS_NAME:"OpenLayers.Filter.Logical"});OpenLayers.Filter.Logical.AND="&&";OpenLayers.Filter.Logical.OR="||";OpenLayers.Filter.Logical.NOT="!";OpenLayers.Filter.Comparison=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,matchCase:!0,lowerBoundary:null,upperBoundary:null,initialize:function(b){OpenLayers.Filter.prototype.initialize.apply(this,[b]);this.type===OpenLayers.Filter.Comparison.LIKE&&void 0===b.matchCase&&(this.matchCase=null)},evaluate:function(d){d instanceof OpenLayers.Feature.Vector&&(d=d.attributes);var c=!1,d=d[this.property];switch(this.type){case OpenLayers.Filter.Comparison.EQUAL_TO:c=this.value;c=!this.matchCase&&"string"==typeof d&&"string"==typeof c?d.toUpperCase()==c.toUpperCase():d==c;break;case OpenLayers.Filter.Comparison.NOT_EQUAL_TO:c=this.value;c=!this.matchCase&&"string"==typeof d&&"string"==typeof c?d.toUpperCase()!=c.toUpperCase():d!=c;break;case OpenLayers.Filter.Comparison.LESS_THAN:c=d<this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN:c=d>this.value;break;case OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:c=d<=this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:c=d>=this.value;break;case OpenLayers.Filter.Comparison.BETWEEN:c=d>=this.lowerBoundary&&d<=this.upperBoundary;break;case OpenLayers.Filter.Comparison.LIKE:c=RegExp(this.value,"gi").test(d)}return c},value2regex:function(e,d,f){if("."==e){throw Error("'.' is an unsupported wildCard character for OpenLayers.Filter.Comparison")}e=e?e:"*";d=d?d:".";this.value=this.value.replace(RegExp("\\"+(f?f:"!")+"(.|$)","g"),"\\$1");this.value=this.value.replace(RegExp("\\"+d,"g"),".");this.value=this.value.replace(RegExp("\\"+e,"g"),".*");this.value=this.value.replace(RegExp("\\\\.\\*","g"),"\\"+e);return this.value=this.value.replace(RegExp("\\\\\\.","g"),"\\"+d)},regex2value:function(){var b=this.value,b=b.replace(/!/g,"!!"),b=b.replace(/(\\)?\\\./g,function(d,e){return e?d:"!."}),b=b.replace(/(\\)?\\\*/g,function(d,e){return e?d:"!*"}),b=b.replace(/\\\\/g,"\\");return b=b.replace(/\.\*/g,"*")},clone:function(){return OpenLayers.Util.extend(new OpenLayers.Filter.Comparison,this)},CLASS_NAME:"OpenLayers.Filter.Comparison"});OpenLayers.Filter.Comparison.EQUAL_TO="==";OpenLayers.Filter.Comparison.NOT_EQUAL_TO="!=";OpenLayers.Filter.Comparison.LESS_THAN="<";OpenLayers.Filter.Comparison.GREATER_THAN=">";OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO="<=";OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO=">=";OpenLayers.Filter.Comparison.BETWEEN="..";OpenLayers.Filter.Comparison.LIKE="~";OpenLayers.Format.Filter=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.Filter"});OpenLayers.Format.WFST=function(d){var d=OpenLayers.Util.applyDefaults(d,OpenLayers.Format.WFST.DEFAULTS),c=OpenLayers.Format.WFST["v"+d.version.replace(/\./g,"_")];if(!c){throw"Unsupported WFST version: "+d.version}return new c(d)};OpenLayers.Format.WFST.DEFAULTS={version:"1.0.0"};OpenLayers.Format.WFST.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs",gml:"http://www.opengis.net/gml",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows"},defaultPrefix:"wfs",version:null,schemaLocations:null,srsName:null,extractAttributes:!0,xy:!0,stateName:null,initialize:function(b){this.stateName={};this.stateName[OpenLayers.State.INSERT]="wfs:Insert";this.stateName[OpenLayers.State.UPDATE]="wfs:Update";this.stateName[OpenLayers.State.DELETE]="wfs:Delete";OpenLayers.Format.XML.prototype.initialize.apply(this,[b])},getSrsName:function(e,d){var f=d&&d.srsName;f||(f=e&&e.layer?e.layer.projection.getCode():this.srsName);return f},read:function(e,d){d=d||{};OpenLayers.Util.applyDefaults(d,{output:"features"});"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));e&&9==e.nodeType&&(e=e.documentElement);var f={};e&&this.readNode(e,f,!0);f.features&&"features"===d.output&&(f=f.features);return f},readers:{wfs:{FeatureCollection:function(d,c){c.features=[];this.readChildNodes(d,c)}}},write:function(f,e){var h=this.writeNode("wfs:Transaction",{features:f,options:e}),g=this.schemaLocationAttr();g&&this.setAttributeNS(h,this.namespaces.xsi,"xsi:schemaLocation",g);return OpenLayers.Format.XML.prototype.write.apply(this,[h])},writers:{wfs:{GetFeature:function(f){var e=this.createElementNSPlus("wfs:GetFeature",{attributes:{service:"WFS",version:this.version,handle:f&&f.handle,outputFormat:f&&f.outputFormat,maxFeatures:f&&f.maxFeatures,"xsi:schemaLocation":this.schemaLocationAttr(f)}});if("string"==typeof this.featureType){this.writeNode("Query",f,e)}else{for(var h=0,g=this.featureType.length;h<g;h++){f.featureType=this.featureType[h],this.writeNode("Query",f,e)}}return e},Transaction:function(i){var i=i||{},h=i.options||{},n=this.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version,handle:h.handle}}),m,l=i.features;if(l){!0===h.multi&&OpenLayers.Util.extend(this.geometryTypes,{"OpenLayers.Geometry.Point":"MultiPoint","OpenLayers.Geometry.LineString":!0===this.multiCurve?"MultiCurve":"MultiLineString","OpenLayers.Geometry.Polygon":!0===this.multiSurface?"MultiSurface":"MultiPolygon"});var k,j,i=0;for(m=l.length;i<m;++i){j=l[i],(k=this.stateName[j.state])&&this.writeNode(k,{feature:j,options:h},n)}!0===h.multi&&this.setGeometryTypes()}if(h.nativeElements){i=0;for(m=h.nativeElements.length;i<m;++i){this.writeNode("wfs:Native",h.nativeElements[i],n)}}return n},Native:function(b){return this.createElementNSPlus("wfs:Native",{attributes:{vendorId:b.vendorId,safeToIgnore:b.safeToIgnore},value:b.value})},Insert:function(d){var c=d.feature,d=d.options,d=this.createElementNSPlus("wfs:Insert",{attributes:{handle:d&&d.handle}});this.srsName=this.getSrsName(c);this.writeNode("feature:_typeName",c,d);return d},Update:function(f){var e=f.feature,f=f.options,f=this.createElementNSPlus("wfs:Update",{attributes:{handle:f&&f.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});this.featureNS&&f.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var h=e.modified;if(null!==this.geometryName&&(!h||void 0!==h.geometry)){this.srsName=this.getSrsName(e),this.writeNode("Property",{name:this.geometryName,value:e.geometry},f)}for(var g in e.attributes){void 0!==e.attributes[g]&&(!h||!h.attributes||h.attributes&&void 0!==h.attributes[g])&&this.writeNode("Property",{name:g,value:e.attributes[g]},f)}this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[e.fid]}),f);return f},Property:function(d){var c=this.createElementNSPlus("wfs:Property");this.writeNode("Name",d.name,c);null!==d.value&&this.writeNode("Value",d.value,c);return c},Name:function(b){return this.createElementNSPlus("wfs:Name",{value:b})},Value:function(d){var c;d instanceof OpenLayers.Geometry?(c=this.createElementNSPlus("wfs:Value"),d=this.writeNode("feature:_geometry",d).firstChild,c.appendChild(d)):c=this.createElementNSPlus("wfs:Value",{value:d});return c},Delete:function(d){var c=d.feature,d=d.options,d=this.createElementNSPlus("wfs:Delete",{attributes:{handle:d&&d.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});this.featureNS&&d.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[c.fid]}),d);return d}}},schemaLocationAttr:function(f){var f=OpenLayers.Util.extend({featurePrefix:this.featurePrefix,schema:this.schema},f),e=OpenLayers.Util.extend({},this.schemaLocations);f.schema&&(e[f.featurePrefix]=f.schema);var f=[],h,g;for(g in e){(h=this.namespaces[g])&&f.push(h+" "+e[g])}return f.join(" ")||void 0},setFilterProperty:function(e){if(e.filters){for(var d=0,f=e.filters.length;d<f;++d){OpenLayers.Format.WFST.v1.prototype.setFilterProperty.call(this,e.filters[d])}}else{e instanceof OpenLayers.Filter.Spatial&&!e.property&&(e.property=this.geometryName)}},CLASS_NAME:"OpenLayers.Format.WFST.v1"});OpenLayers.Format.GML.v2=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",initialize:function(b){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[b])},readers:{gml:OpenLayers.Util.applyDefaults({outerBoundaryIs:function(e,d){var f={};this.readChildNodes(e,f);d.outer=f.components[0]},innerBoundaryIs:function(e,d){var f={};this.readChildNodes(e,f);d.inner.push(f.components[0])},Box:function(f,e){var h={};this.readChildNodes(f,h);e.components||(e.components=[]);var g=h.points[0],h=h.points[1];e.components.push(new OpenLayers.Bounds(g.x,g.y,h.x,h.y))}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(b){b=this.writeNode(OpenLayers.Util.isArray(b)?"wfs:FeatureCollection":"gml:featureMember",b);this.setAttributeNS(b,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},writers:{gml:OpenLayers.Util.applyDefaults({Point:function(d){var c=this.createElementNSPlus("gml:Point");this.writeNode("coordinates",[d],c);return c},coordinates:function(g){for(var f=g.length,j=Array(f),i,h=0;h<f;++h){i=g[h],j[h]=this.xy?i.x+","+i.y:i.y+","+i.x,void 0!=i.z&&(j[h]+=","+i.z)}return this.createElementNSPlus("gml:coordinates",{attributes:{decimal:".",cs:",",ts:" "},value:1==f?j[0]:j.join(" ")})},LineString:function(d){var c=this.createElementNSPlus("gml:LineString");this.writeNode("coordinates",d.components,c);return c},Polygon:function(e){var d=this.createElementNSPlus("gml:Polygon");this.writeNode("outerBoundaryIs",e.components[0],d);for(var f=1;f<e.components.length;++f){this.writeNode("innerBoundaryIs",e.components[f],d)}return d},outerBoundaryIs:function(d){var c=this.createElementNSPlus("gml:outerBoundaryIs");this.writeNode("LinearRing",d,c);return c},innerBoundaryIs:function(d){var c=this.createElementNSPlus("gml:innerBoundaryIs");this.writeNode("LinearRing",d,c);return c},LinearRing:function(d){var c=this.createElementNSPlus("gml:LinearRing");this.writeNode("coordinates",d.components,c);return c},Box:function(d){var c=this.createElementNSPlus("gml:Box");this.writeNode("coordinates",[{x:d.left,y:d.bottom},{x:d.right,y:d.top}],c);this.srsName&&c.setAttribute("srsName",this.srsName);return c}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},CLASS_NAME:"OpenLayers.Format.GML.v2"});OpenLayers.Filter.Function=OpenLayers.Class(OpenLayers.Filter,{name:null,params:null,CLASS_NAME:"OpenLayers.Filter.Function"});OpenLayers.Format.Filter.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"ogc",schemaLocation:null,initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b])},read:function(d){var c={};this.readers.ogc.Filter.apply(this,[d,c]);return c.filter},readers:{ogc:{_expression:function(e){for(var d="",f=e.firstChild;f;f=f.nextSibling){switch(f.nodeType){case 1:e=this.readNode(f);e.property?d+="${"+e.property+"}":void 0!==e.value&&(d+=e.value);break;case 3:case 4:d+=f.nodeValue}}return d},Filter:function(e,d){var f={fids:[],filters:[]};this.readChildNodes(e,f);0<f.fids.length?d.filter=new OpenLayers.Filter.FeatureId({fids:f.fids}):0<f.filters.length&&(d.filter=f.filters[0])},FeatureId:function(e,d){var f=e.getAttribute("fid");f&&d.fids.push(f)},And:function(e,d){var f=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND});this.readChildNodes(e,f);d.filters.push(f)},Or:function(e,d){var f=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR});this.readChildNodes(e,f);d.filters.push(f)},Not:function(e,d){var f=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.NOT});this.readChildNodes(e,f);d.filters.push(f)},PropertyIsLessThan:function(e,d){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN});this.readChildNodes(e,f);d.filters.push(f)},PropertyIsGreaterThan:function(e,d){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN});this.readChildNodes(e,f);d.filters.push(f)},PropertyIsLessThanOrEqualTo:function(e,d){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO});this.readChildNodes(e,f);d.filters.push(f)},PropertyIsGreaterThanOrEqualTo:function(e,d){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO});this.readChildNodes(e,f);d.filters.push(f)},PropertyIsBetween:function(e,d){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN});this.readChildNodes(e,f);d.filters.push(f)},Literal:function(d,c){c.value=OpenLayers.String.numericIf(this.getChildValue(d))},PropertyName:function(d,c){c.property=this.getChildValue(d)},LowerBoundary:function(d,c){c.lowerBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,d))},UpperBoundary:function(d,c){c.upperBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,d))},Intersects:function(d,c){this.readSpatial(d,c,OpenLayers.Filter.Spatial.INTERSECTS)},Within:function(d,c){this.readSpatial(d,c,OpenLayers.Filter.Spatial.WITHIN)},Contains:function(d,c){this.readSpatial(d,c,OpenLayers.Filter.Spatial.CONTAINS)},DWithin:function(d,c){this.readSpatial(d,c,OpenLayers.Filter.Spatial.DWITHIN)},Distance:function(d,c){c.distance=parseInt(this.getChildValue(d));c.distanceUnits=d.getAttribute("units")},Function:function(){}}},readSpatial:function(e,d,f){f=new OpenLayers.Filter.Spatial({type:f});this.readChildNodes(e,f);f.value=f.components[0];delete f.components;d.filters.push(f)},writeOgcExpression:function(e,d){if(e instanceof OpenLayers.Filter.Function){var f=this.writeNode("Function",e,d);d.appendChild(f)}else{this.writeNode("Literal",e,d)}return d},write:function(b){return this.writers.ogc.Filter.apply(this,[b])},writeFeatureIdNodes:function(f,e){for(var h=0,g=f.fids.length;h<g;++h){this.writeNode("FeatureId",f.fids[h],e)}},writers:{ogc:{Filter:function(d){var c=this.createElementNSPlus("ogc:Filter");"FID"===d.type?OpenLayers.Format.Filter.v1.prototype.writeFeatureIdNodes.call(this,d,c):this.writeNode(this.getFilterType(d),d,c);return c},FeatureId:function(b){return this.createElementNSPlus("ogc:FeatureId",{attributes:{fid:b}})},And:function(g){for(var f=this.createElementNSPlus("ogc:And"),j,i=0,h=g.filters.length;i<h;++i){j=g.filters[i],"FID"===j.type?OpenLayers.Format.Filter.v1.prototype.writeFeatureIdNodes.call(this,j,f):this.writeNode(this.getFilterType(j),j,f)}return f},Or:function(g){for(var f=this.createElementNSPlus("ogc:Or"),j,i=0,h=g.filters.length;i<h;++i){j=g.filters[i],"FID"===j.type?OpenLayers.Format.Filter.v1.prototype.writeFeatureIdNodes.call(this,j,f):this.writeNode(this.getFilterType(j),j,f)}return f},Not:function(d){var c=this.createElementNSPlus("ogc:Not"),d=d.filters[0];"FID"===d.type?OpenLayers.Format.Filter.v1.prototype.writeFeatureIdNodes.call(this,d,c):this.writeNode(this.getFilterType(d),d,c);return c},PropertyIsLessThan:function(d){var c=this.createElementNSPlus("ogc:PropertyIsLessThan");this.writeNode("PropertyName",d,c);this.writeOgcExpression(d.value,c);return c},PropertyIsGreaterThan:function(d){var c=this.createElementNSPlus("ogc:PropertyIsGreaterThan");this.writeNode("PropertyName",d,c);this.writeOgcExpression(d.value,c);return c},PropertyIsLessThanOrEqualTo:function(d){var c=this.createElementNSPlus("ogc:PropertyIsLessThanOrEqualTo");this.writeNode("PropertyName",d,c);this.writeOgcExpression(d.value,c);return c},PropertyIsGreaterThanOrEqualTo:function(d){var c=this.createElementNSPlus("ogc:PropertyIsGreaterThanOrEqualTo");this.writeNode("PropertyName",d,c);this.writeOgcExpression(d.value,c);return c},PropertyIsBetween:function(d){var c=this.createElementNSPlus("ogc:PropertyIsBetween");this.writeNode("PropertyName",d,c);this.writeNode("LowerBoundary",d,c);this.writeNode("UpperBoundary",d,c);return c},PropertyName:function(b){return this.createElementNSPlus("ogc:PropertyName",{value:b.property})},Literal:function(b){return this.createElementNSPlus("ogc:Literal",{value:b})},LowerBoundary:function(d){var c=this.createElementNSPlus("ogc:LowerBoundary");this.writeOgcExpression(d.lowerBoundary,c);return c},UpperBoundary:function(d){var c=this.createElementNSPlus("ogc:UpperBoundary");this.writeNode("Literal",d.upperBoundary,c);return c},INTERSECTS:function(b){return this.writeSpatial(b,"Intersects")},WITHIN:function(b){return this.writeSpatial(b,"Within")},CONTAINS:function(b){return this.writeSpatial(b,"Contains")},DWITHIN:function(d){var c=this.writeSpatial(d,"DWithin");this.writeNode("Distance",d,c);return c},Distance:function(b){return this.createElementNSPlus("ogc:Distance",{attributes:{units:b.distanceUnits},value:b.distance})},Function:function(f){for(var e=this.createElementNSPlus("ogc:Function",{attributes:{name:f.name}}),f=f.params,h=0,g=f.length;h<g;h++){this.writeOgcExpression(f[h],e)}return e}}},getFilterType:function(d){var c=this.filterMap[d.type];if(!c){throw"Filter writing not supported for rule type: "+d.type}return c},filterMap:{"&&":"And","||":"Or","!":"Not","==":"PropertyIsEqualTo","!=":"PropertyIsNotEqualTo","<":"PropertyIsLessThan",">":"PropertyIsGreaterThan","<=":"PropertyIsLessThanOrEqualTo",">=":"PropertyIsGreaterThanOrEqualTo","..":"PropertyIsBetween","~":"PropertyIsLike",BBOX:"BBOX",DWITHIN:"DWITHIN",WITHIN:"WITHIN",CONTAINS:"CONTAINS",INTERSECTS:"INTERSECTS",FID:"FeatureId"},CLASS_NAME:"OpenLayers.Format.Filter.v1"});OpenLayers.Format.Filter.v1_0_0=OpenLayers.Class(OpenLayers.Format.GML.v2,OpenLayers.Format.Filter.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.0.0/filter.xsd",initialize:function(b){OpenLayers.Format.GML.v2.prototype.initialize.apply(this,[b])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e,d){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO});this.readChildNodes(e,f);d.filters.push(f)},PropertyIsNotEqualTo:function(e,d){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO});this.readChildNodes(e,f);d.filters.push(f)},PropertyIsLike:function(h,g){var l=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(h,l);var k=h.getAttribute("wildCard"),j=h.getAttribute("singleChar"),i=h.getAttribute("escape");l.value2regex(k,j,i);g.filters.push(l)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(d){var c=this.createElementNSPlus("ogc:PropertyIsEqualTo");this.writeNode("PropertyName",d,c);this.writeOgcExpression(d.value,c);return c},PropertyIsNotEqualTo:function(d){var c=this.createElementNSPlus("ogc:PropertyIsNotEqualTo");this.writeNode("PropertyName",d,c);this.writeOgcExpression(d.value,c);return c},PropertyIsLike:function(d){var c=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escape:"!"}});this.writeNode("PropertyName",d,c);this.writeNode("Literal",d.regex2value(),c);return c},BBOX:function(e){var d=this.createElementNSPlus("ogc:BBOX");e.property&&this.writeNode("PropertyName",e,d);var f=this.writeNode("gml:Box",e.value,d);e.projection&&f.setAttribute("srsName",e.projection);return d}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},writeSpatial:function(f,e){var h=this.createElementNSPlus("ogc:"+e);this.writeNode("PropertyName",f,h);if(f.value instanceof OpenLayers.Filter.Function){this.writeNode("Function",f.value,h)}else{var g;g=f.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",f.value).firstChild:this.writeNode("gml:Box",f.value);f.projection&&g.setAttribute("srsName",f.projection);h.appendChild(g)}return h},CLASS_NAME:"OpenLayers.Format.Filter.v1_0_0"});OpenLayers.Format.WFST.v1_0_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,OpenLayers.Format.WFST.v1,{version:"1.0.0",srsNameInQuery:!1,schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.0.0/WFS-transaction.xsd"},initialize:function(b){OpenLayers.Format.Filter.v1_0_0.prototype.initialize.apply(this,[b]);OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[b])},readNode:function(d,c){return OpenLayers.Format.GML.v2.prototype.readNode.apply(this,[d,c])},readers:{wfs:OpenLayers.Util.applyDefaults({WFS_TransactionResponse:function(d,c){c.insertIds=[];c.success=!1;this.readChildNodes(d,c)},InsertResult:function(e,d){var f={fids:[]};this.readChildNodes(e,f);d.insertIds.push(f.fids[0])},TransactionResult:function(d,c){this.readChildNodes(d,c)},Status:function(d,c){this.readChildNodes(d,c)},SUCCESS:function(d,c){c.success=!0}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.readers.ogc},writers:{wfs:OpenLayers.Util.applyDefaults({Query:function(f){var f=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName,srsNameInQuery:this.srsNameInQuery},f),e=f.featurePrefix,h=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(e?e+":":"")+f.featureType}});f.srsNameInQuery&&f.srsName&&h.setAttribute("srsName",f.srsName);f.featureNS&&h.setAttribute("xmlns:"+e,f.featureNS);if(f.propertyNames){for(var e=0,g=f.propertyNames.length;e<g;e++){this.writeNode("ogc:PropertyName",{property:f.propertyNames[e]},h)}}f.filter&&(this.setFilterProperty(f.filter),this.writeNode("ogc:Filter",f.filter,h));return h}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_0_0"});OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(b){this.compare=b?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER;this.clear()},insert:function(g){this.exists(g)&&this.remove(g);var f=g.id;this.determineZIndex(g);for(var j=-1,i=this.order.length,h;1<i-j;){h=parseInt((j+i)/2),0<this.compare(this,g,OpenLayers.Util.getElement(this.order[h]))?j=h:i=h}this.order.splice(i,0,f);this.indices[f]=this.getZIndex(g);return this.getNextElement(i)},remove:function(d){var d=d.id,c=OpenLayers.Util.indexOf(this.order,d);0<=c&&(this.order.splice(c,1),delete this.indices[d],this.maxZIndex=0<this.order.length?this.indices[this.order[this.order.length-1]]:0)},clear:function(){this.order=[];this.indices={};this.maxZIndex=0},exists:function(b){return null!=this.indices[b.id]},getZIndex:function(b){return b._style.graphicZIndex},determineZIndex:function(d){var c=d._style.graphicZIndex;null==c?(c=this.maxZIndex,d._style.graphicZIndex=c):c>this.maxZIndex&&(this.maxZIndex=c)},getNextElement:function(d){d+=1;if(d<this.order.length){var c=OpenLayers.Util.getElement(this.order[d]);void 0==c&&(c=this.getNextElement(d));return c}return null},CLASS_NAME:"OpenLayers.ElementsIndexer"});OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(f,e,h){var e=f.getZIndex(e),g=0;h&&(f=f.getZIndex(h),g=e-f);return g},Z_ORDER_DRAWING_ORDER:function(e,d,f){e=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,d,f);f&&0==e&&(e=1);return e},Z_ORDER_Y_ORDER:function(e,d,f){e=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,d,f);f&&0===e&&(d=f._boundsBottom-d._boundsBottom,e=0===d?1:d);return e}};OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,xOffset:0,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",LABEL_OUTLINE_SUFFIX:"_outline",initialize:function(d,c){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.rendererRoot=this.createRenderRoot();this.root=this.createRoot("_root");this.vectorRoot=this.createRoot("_vroot");this.textRoot=this.createRoot("_troot");this.root.appendChild(this.vectorRoot);this.root.appendChild(this.textRoot);this.rendererRoot.appendChild(this.root);this.container.appendChild(this.rendererRoot);if(c&&(c.zIndexing||c.yOrdering)){this.indexer=new OpenLayers.ElementsIndexer(c.yOrdering)}},destroy:function(){this.clear();this.xmlns=this.root=this.rendererRoot=null;OpenLayers.Renderer.prototype.destroy.apply(this,arguments)},clear:function(){var d,c=this.vectorRoot;if(c){for(;d=c.firstChild;){c.removeChild(d)}}if(c=this.textRoot){for(;d=c.firstChild;){c.removeChild(d)}}this.indexer&&this.indexer.clear()},setExtent:function(h,g){var l=OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),k=this.getResolution();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var j,i=h.getWidth()/this.map.getExtent().getWidth(),h=h.scale(1/i),i=this.map.getMaxExtent();i.right>h.left&&i.right<h.right?j=!0:i.left>h.left&&i.left<h.right&&(j=!1);if(j!==this.rightOfDateLine||g){l=!1,this.xOffset=!0===j?i.getWidth()/k:0}this.rightOfDateLine=j}return l},getNodeType:function(){},drawGeometry:function(h,g,l){var k=h.CLASS_NAME,j=!0;if("OpenLayers.Geometry.Collection"==k||"OpenLayers.Geometry.MultiPoint"==k||"OpenLayers.Geometry.MultiLineString"==k||"OpenLayers.Geometry.MultiPolygon"==k){for(var k=0,i=h.components.length;k<i;k++){j=this.drawGeometry(h.components[k],g,l)&&j}return j}k=j=!1;"none"!=g.display&&(g.backgroundGraphic?this.redrawBackgroundNode(h.id,h,g,l):k=!0,j=this.redrawNode(h.id,h,g,l));if(!1==j&&(g=document.getElementById(h.id))){g._style.backgroundGraphic&&(k=!0),g.parentNode.removeChild(g)}k&&(g=document.getElementById(h.id+this.BACKGROUND_ID_SUFFIX))&&g.parentNode.removeChild(g);return j},redrawNode:function(f,e,h,g){h=this.applyDefaultSymbolizer(h);f=this.nodeFactory(f,this.getNodeType(e,h));f._featureId=g;f._boundsBottom=e.getBounds().bottom;f._geometryClass=e.CLASS_NAME;f._style=h;e=this.drawGeometryNode(f,e,h);if(!1===e){return !1}f=e.node;this.indexer?(h=this.indexer.insert(f))?this.vectorRoot.insertBefore(f,h):this.vectorRoot.appendChild(f):f.parentNode!==this.vectorRoot&&this.vectorRoot.appendChild(f);this.postDraw(f);return e.complete},redrawBackgroundNode:function(e,d,f){f=OpenLayers.Util.extend({},f);f.externalGraphic=f.backgroundGraphic;f.graphicXOffset=f.backgroundXOffset;f.graphicYOffset=f.backgroundYOffset;f.graphicZIndex=f.backgroundGraphicZIndex;f.graphicWidth=f.backgroundWidth||f.graphicWidth;f.graphicHeight=f.backgroundHeight||f.graphicHeight;f.backgroundGraphic=null;f.backgroundXOffset=null;f.backgroundYOffset=null;f.backgroundGraphicZIndex=null;return this.redrawNode(e+this.BACKGROUND_ID_SUFFIX,d,f,null)},drawGeometryNode:function(g,f,j){var j=j||g._style,i={isFilled:void 0===j.fill?!0:j.fill,isStroked:void 0===j.stroke?!!j.strokeWidth:j.stroke},h;switch(f.CLASS_NAME){case"OpenLayers.Geometry.Point":!1===j.graphic&&(i.isFilled=!1,i.isStroked=!1);h=this.drawPoint(g,f);break;case"OpenLayers.Geometry.LineString":i.isFilled=!1;h=this.drawLineString(g,f);break;case"OpenLayers.Geometry.LinearRing":h=this.drawLinearRing(g,f);break;case"OpenLayers.Geometry.Polygon":h=this.drawPolygon(g,f);break;case"OpenLayers.Geometry.Rectangle":h=this.drawRectangle(g,f)}g._options=i;return !1!=h?{node:this.setStyle(g,j,i,f),complete:h}:!1},postDraw:function(){},drawPoint:function(){},drawLineString:function(){},drawLinearRing:function(){},drawPolygon:function(){},drawRectangle:function(){},drawCircle:function(){},removeText:function(d){var c=document.getElementById(d+this.LABEL_ID_SUFFIX);c&&this.textRoot.removeChild(c);(d=document.getElementById(d+this.LABEL_OUTLINE_SUFFIX))&&this.textRoot.removeChild(d)},getFeatureIdFromEvent:function(e){var d=e.target,f=d&&d.correspondingUseElement;return(f?f:d||e.srcElement)._featureId},eraseGeometry:function(f,e){if("OpenLayers.Geometry.MultiPoint"==f.CLASS_NAME||"OpenLayers.Geometry.MultiLineString"==f.CLASS_NAME||"OpenLayers.Geometry.MultiPolygon"==f.CLASS_NAME||"OpenLayers.Geometry.Collection"==f.CLASS_NAME){for(var h=0,g=f.components.length;h<g;h++){this.eraseGeometry(f.components[h],e)}}else{if((h=OpenLayers.Util.getElement(f.id))&&h.parentNode){if(h.geometry&&(h.geometry.destroy(),h.geometry=null),h.parentNode.removeChild(h),this.indexer&&this.indexer.remove(h),h._style.backgroundGraphic){(h=OpenLayers.Util.getElement(f.id+this.BACKGROUND_ID_SUFFIX))&&h.parentNode&&h.parentNode.removeChild(h)}}}},nodeFactory:function(e,d){var f=OpenLayers.Util.getElement(e);f?this.nodeTypeCompare(f,d)||(f.parentNode.removeChild(f),f=this.nodeFactory(e,d)):f=this.createNode(d,e);return f},nodeTypeCompare:function(){},createNode:function(){},moveRoot:function(d){var c=this.root;d.root.parentNode==this.rendererRoot&&(c=d.root);c.parentNode.removeChild(c);d.rendererRoot.appendChild(c)},getRenderLayerId:function(){return this.root.parentNode.parentNode.id},isComplexSymbol:function(b){return"circle"!=b&&!!b},CLASS_NAME:"OpenLayers.Renderer.Elements"});OpenLayers.Control.Panel=OpenLayers.Class(OpenLayers.Control,{controls:null,autoActivate:!0,defaultControl:null,saveState:!1,allowDepress:!1,activeState:null,initialize:function(b){OpenLayers.Control.prototype.initialize.apply(this,[b]);this.controls=[];this.activeState={}},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onButtonClick);OpenLayers.Control.prototype.destroy.apply(this,arguments);for(var d,c=this.controls.length-1;0<=c;c--){d=this.controls[c],d.events&&d.events.un({activate:this.iconOn,deactivate:this.iconOff}),d.panel_div=null}this.activeState=null},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){for(var e,d=0,f=this.controls.length;d<f;d++){e=this.controls[d],(e===this.defaultControl||this.saveState&&this.activeState[e.id])&&e.activate()}!0===this.saveState&&(this.defaultControl=null);this.redraw();return !0}return !1},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){for(var e,d=0,f=this.controls.length;d<f;d++){e=this.controls[d],this.activeState[e.id]=e.deactivate()}this.redraw();return !0}return !1},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.outsideViewport?(this.events.attachToElement(this.div),this.events.register("buttonclick",this,this.onButtonClick)):this.map.events.register("buttonclick",this,this.onButtonClick);this.addControlsToMap(this.controls);return this.div},redraw:function(){for(var d=this.div.childNodes.length-1;0<=d;d--){this.div.removeChild(this.div.childNodes[d])}this.div.innerHTML="";if(this.active){for(var d=0,c=this.controls.length;d<c;d++){this.div.appendChild(this.controls[d].panel_div)}}},activateControl:function(f){if(!this.active){return !1}if(f.type==OpenLayers.Control.TYPE_BUTTON){f.trigger()}else{if(f.type==OpenLayers.Control.TYPE_TOGGLE){f.active?f.deactivate():f.activate()}else{if(this.allowDepress&&f.active){f.deactivate()}else{for(var e,h=0,g=this.controls.length;h<g;h++){e=this.controls[h],e!=f&&(e.type===OpenLayers.Control.TYPE_TOOL||null==e.type)&&e.deactivate()}f.activate()}}}},addControls:function(g){OpenLayers.Util.isArray(g)||(g=[g]);this.controls=this.controls.concat(g);for(var f=0,j=g.length;f<j;f++){var i=g[f],h=this.createControlMarkup(i);OpenLayers.Element.addClass(h,i.displayClass+"ItemInactive");OpenLayers.Element.addClass(h,"olButton");""!=i.title&&!h.title&&(h.title=i.title);i.panel_div=h}this.map&&(this.addControlsToMap(g),this.redraw())},createControlMarkup:function(){return document.createElement("div")},addControlsToMap:function(f){for(var e,h=0,g=f.length;h<g;h++){e=f[h],!0===e.autoActivate?(e.autoActivate=!1,this.map.addControl(e),e.autoActivate=!0):(this.map.addControl(e),e.deactivate()),e.events.on({activate:this.iconOn,deactivate:this.iconOff})}},iconOn:function(){var b=this.panel_div;b.className=b.className.replace(RegExp("\\b("+this.displayClass+"Item)Inactive\\b"),"$1Active")},iconOff:function(){var b=this.panel_div;b.className=b.className.replace(RegExp("\\b("+this.displayClass+"Item)Active\\b"),"$1Inactive")},onButtonClick:function(e){for(var d=this.controls,e=e.buttonElement,f=d.length-1;0<=f;--f){if(d[f].panel_div===e){this.activateControl(d[f]);break}}},getControlsBy:function(e,d){var f="function"==typeof d.test;return OpenLayers.Array.filter(this.controls,function(a){return a[e]==d||f&&d.test(a[e])})},getControlsByName:function(b){return this.getControlsBy("name",b)},getControlsByClass:function(b){return this.getControlsBy("CLASS_NAME",b)},CLASS_NAME:"OpenLayers.Control.Panel"});OpenLayers.Strategy=OpenLayers.Class({layer:null,options:null,active:null,autoActivate:!0,autoDestroy:!0,initialize:function(b){OpenLayers.Util.extend(this,b);this.options=b;this.active=!1},destroy:function(){this.deactivate();this.options=this.layer=null},setLayer:function(b){this.layer=b},activate:function(){return !this.active?this.active=!0:!1},deactivate:function(){return this.active?(this.active=!1,!0):!1},CLASS_NAME:"OpenLayers.Strategy"});OpenLayers.Strategy.Fixed=OpenLayers.Class(OpenLayers.Strategy,{preload:!1,activate:function(){if(OpenLayers.Strategy.prototype.activate.apply(this,arguments)){this.layer.events.on({refresh:this.load,scope:this});if(!0==this.layer.visibility||this.preload){this.load()}else{this.layer.events.on({visibilitychanged:this.load,scope:this})}return !0}return !1},deactivate:function(){var b=OpenLayers.Strategy.prototype.deactivate.call(this);b&&this.layer.events.un({refresh:this.load,visibilitychanged:this.load,scope:this});return b},load:function(d){var c=this.layer;c.events.triggerEvent("loadstart");c.protocol.read(OpenLayers.Util.applyDefaults({callback:OpenLayers.Function.bind(this.merge,this,c.map.getProjectionObject()),filter:c.filter},d));c.events.un({visibilitychanged:this.load,scope:this})},merge:function(i,h){var n=this.layer;n.destroyFeatures();var m=h.features;if(m&&0<m.length){if(!i.equals(n.projection)){for(var l,k=0,j=m.length;k<j;++k){(l=m[k].geometry)&&l.transform(n.projection,i)}}n.addFeatures(m)}n.events.triggerEvent("loadend")},CLASS_NAME:"OpenLayers.Strategy.Fixed"});OpenLayers.Control.Zoom=OpenLayers.Class(OpenLayers.Control,{zoomInText:"+",zoomInId:"olZoomInLink",zoomOutText:"-",zoomOutId:"olZoomOutLink",draw:function(){var f=OpenLayers.Control.prototype.draw.apply(this),e=this.getOrCreateLinks(f),h=e.zoomIn,e=e.zoomOut,g=this.map.events;e.parentNode!==f&&(g=this.events,g.attachToElement(e.parentNode));g.register("buttonclick",this,this.onZoomClick);this.zoomInLink=h;this.zoomOutLink=e;return f},getOrCreateLinks:function(e){var d=document.getElementById(this.zoomInId),f=document.getElementById(this.zoomOutId);d||(d=document.createElement("a"),d.href="#zoomIn",d.appendChild(document.createTextNode(this.zoomInText)),d.className="olControlZoomIn",e.appendChild(d));OpenLayers.Element.addClass(d,"olButton");f||(f=document.createElement("a"),f.href="#zoomOut",f.appendChild(document.createTextNode(this.zoomOutText)),f.className="olControlZoomOut",e.appendChild(f));OpenLayers.Element.addClass(f,"olButton");return{zoomIn:d,zoomOut:f}},onZoomClick:function(b){b=b.buttonElement;b===this.zoomInLink?this.map.zoomIn():b===this.zoomOutLink&&this.map.zoomOut()},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onZoomClick);delete this.zoomInLink;delete this.zoomOutLink;OpenLayers.Control.prototype.destroy.apply(this)},CLASS_NAME:"OpenLayers.Control.Zoom"});OpenLayers.Protocol=OpenLayers.Class({format:null,options:null,autoDestroy:!0,defaultFilter:null,initialize:function(b){b=b||{};OpenLayers.Util.extend(this,b);this.options=b},mergeWithDefaultFilter:function(b){return b&&this.defaultFilter?new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.defaultFilter,b]}):b||this.defaultFilter||void 0},destroy:function(){this.format=this.options=null},read:function(b){b=b||{};b.filter=this.mergeWithDefaultFilter(b.filter)},create:function(){},update:function(){},"delete":function(){},commit:function(){},abort:function(){},createCallback:function(e,d,f){return OpenLayers.Function.bind(function(){e.apply(this,[d,f])},this)},CLASS_NAME:"OpenLayers.Protocol"});OpenLayers.Protocol.Response=OpenLayers.Class({code:null,requestType:null,last:!0,features:null,data:null,reqFeatures:null,priv:null,error:null,initialize:function(b){OpenLayers.Util.extend(this,b)},success:function(){return 0<this.code},CLASS_NAME:"OpenLayers.Protocol.Response"});OpenLayers.Protocol.Response.SUCCESS=1;OpenLayers.Protocol.Response.FAILURE=0;OpenLayers.Protocol.WFS=function(d){var d=OpenLayers.Util.applyDefaults(d,OpenLayers.Protocol.WFS.DEFAULTS),c=OpenLayers.Protocol.WFS["v"+d.version.replace(/\./g,"_")];if(!c){throw"Unsupported WFS version: "+d.version}return new c(d)};OpenLayers.Protocol.WFS.fromWMSLayer=function(f,e){var h,g;h=f.params.LAYERS;h=(OpenLayers.Util.isArray(h)?h[0]:h).split(":");1<h.length&&(g=h[0]);h=h.pop();g={url:f.url,featureType:h,featurePrefix:g,srsName:f.projection&&f.projection.getCode()||f.map&&f.map.getProjectionObject().getCode(),version:"1.1.0"};return new OpenLayers.Protocol.WFS(OpenLayers.Util.applyDefaults(e,g))};OpenLayers.Protocol.WFS.DEFAULTS={version:"1.0.0"};OpenLayers.Date={toISOString:function(){if("toISOString" in Date.prototype){return function(c){return c.toISOString()}}var b=function(e,g){for(var f=e+"";f.length<g;){f="0"+f}return f};return function(a){return isNaN(a.getTime())?"Invalid Date":a.getUTCFullYear()+"-"+b(a.getUTCMonth()+1,2)+"-"+b(a.getUTCDate(),2)+"T"+b(a.getUTCHours(),2)+":"+b(a.getUTCMinutes(),2)+":"+b(a.getUTCSeconds(),2)+"."+b(a.getUTCMilliseconds(),3)+"Z"}}(),parse:function(i){var h;if((i=i.match(/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:(?:T(\d{1,2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|(?:[+-]\d{1,2}(?::(\d{2}))?)))|Z)?$/))&&(i[1]||i[7])){h=parseInt(i[1],10)||0;var n=parseInt(i[2],10)-1||0,m=parseInt(i[3],10)||1;h=new Date(Date.UTC(h,n,m));if(n=i[7]){var m=parseInt(i[4],10),l=parseInt(i[5],10),k=parseFloat(i[6]),j=k|0,k=Math.round(1000*(k-j));h.setUTCHours(m,l,j,k);"Z"!==n&&(n=parseInt(n,10),i=parseInt(i[8],10)||0,h=new Date(h.getTime()+-1000*(60*60*n+60*i)))}}else{h=new Date("invalid")}return h}};OpenLayers.ProxyHost="";OpenLayers.Request={DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:!0,user:void 0,password:void 0,params:null,proxy:OpenLayers.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},URL_SPLIT_REGEX:/([^:]*:)\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,events:new OpenLayers.Events(this),makeSameOrigin:function(g,f){var j=0!==g.indexOf("http"),i=!j&&g.match(this.URL_SPLIT_REGEX);if(i){var h=window.location,j=i[1]==h.protocol&&i[3]==h.hostname,i=i[4],h=h.port;if(80!=i&&""!=i||"80"!=h&&""!=h){j=j&&i==h}}j||(f?g="function"==typeof f?f(g):f+encodeURIComponent(g):OpenLayers.Console.warn(OpenLayers.i18n("proxyNeeded"),{url:g}));return g},issue:function(j){var i=OpenLayers.Util.extend(this.DEFAULT_CONFIG,{proxy:OpenLayers.ProxyHost}),j=OpenLayers.Util.applyDefaults(j,i),i=!1,p;for(p in j.headers){j.headers.hasOwnProperty(p)&&"x-requested-with"===p.toLowerCase()&&(i=!0)}!1===i&&(j.headers["X-Requested-With"]="XMLHttpRequest");var o=new OpenLayers.Request.XMLHttpRequest,n=OpenLayers.Util.urlAppend(j.url,OpenLayers.Util.getParameterString(j.params||{})),n=OpenLayers.Request.makeSameOrigin(n,j.proxy);o.open(j.method,n,j.async,j.user,j.password);for(var m in j.headers){o.setRequestHeader(m,j.headers[m])}var l=this.events,k=this;o.onreadystatechange=function(){o.readyState==OpenLayers.Request.XMLHttpRequest.DONE&&!1!==l.triggerEvent("complete",{request:o,config:j,requestUrl:n})&&k.runCallbacks({request:o,config:j,requestUrl:n})};!1===j.async?o.send(j.data):window.setTimeout(function(){0!==o.readyState&&o.send(j.data)},0);return o},runCallbacks:function(h){var g=h.request,l=h.config,k=l.scope?OpenLayers.Function.bind(l.callback,l.scope):l.callback,j;l.success&&(j=l.scope?OpenLayers.Function.bind(l.success,l.scope):l.success);var i;l.failure&&(i=l.scope?OpenLayers.Function.bind(l.failure,l.scope):l.failure);"file:"==OpenLayers.Util.createUrlObject(l.url).protocol&&g.responseText&&(g.status=200);k(g);if(!g.status||200<=g.status&&300>g.status){this.events.triggerEvent("success",h),j&&j(g)}if(g.status&&(200>g.status||300<=g.status)){this.events.triggerEvent("failure",h),i&&i(g)}},GET:function(b){b=OpenLayers.Util.extend(b,{method:"GET"});return OpenLayers.Request.issue(b)},POST:function(b){b=OpenLayers.Util.extend(b,{method:"POST"});b.headers=b.headers?b.headers:{};"CONTENT-TYPE" in OpenLayers.Util.upperCaseObject(b.headers)||(b.headers["Content-Type"]="application/xml");return OpenLayers.Request.issue(b)},PUT:function(b){b=OpenLayers.Util.extend(b,{method:"PUT"});b.headers=b.headers?b.headers:{};"CONTENT-TYPE" in OpenLayers.Util.upperCaseObject(b.headers)||(b.headers["Content-Type"]="application/xml");return OpenLayers.Request.issue(b)},DELETE:function(b){b=OpenLayers.Util.extend(b,{method:"DELETE"});return OpenLayers.Request.issue(b)},HEAD:function(b){b=OpenLayers.Util.extend(b,{method:"HEAD"});return OpenLayers.Request.issue(b)},OPTIONS:function(b){b=OpenLayers.Util.extend(b,{method:"OPTIONS"});return OpenLayers.Request.issue(b)}};(function(){function r(){this._object=m&&!j?new m:new window.ActiveXObject("Microsoft.XMLHTTP");this._listeners=[]}function q(){return new r}function p(b){q.onreadystatechange&&q.onreadystatechange.apply(b);b.dispatchEvent({type:"readystatechange",bubbles:!1,cancelable:!1,timeStamp:new Date+0})}function o(z){try{z.responseText=z._object.responseText}catch(y){}try{var x;var w=z._object,v=w.responseXML,u=w.responseText;k&&(u&&v&&!v.documentElement&&w.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/))&&(v=new window.ActiveXObject("Microsoft.XMLDOM"),v.async=!1,v.validateOnParse=!1,v.loadXML(u));x=v&&(k&&0!=v.parseError||!v.documentElement||v.documentElement&&"parsererror"==v.documentElement.tagName)?null:v;z.responseXML=x}catch(t){}try{z.status=z._object.status}catch(s){}try{z.statusText=z._object.statusText}catch(h){}}function n(b){b._object.onreadystatechange=new window.Function}var m=window.XMLHttpRequest,l=!!window.controllers,k=window.document.all&&!window.opera,j=k&&window.navigator.userAgent.match(/MSIE 7.0/);q.prototype=r.prototype;l&&m.wrapped&&(q.wrapped=m.wrapped);q.UNSENT=0;q.OPENED=1;q.HEADERS_RECEIVED=2;q.LOADING=3;q.DONE=4;q.prototype.readyState=q.UNSENT;q.prototype.responseText="";q.prototype.responseXML=null;q.prototype.status=0;q.prototype.statusText="";q.prototype.priority="NORMAL";q.prototype.onreadystatechange=null;q.onreadystatechange=null;q.onopen=null;q.onsend=null;q.onabort=null;q.prototype.open=function(c,g,d,b,t){delete this._headers;arguments.length<3&&(d=true);this._async=d;var s=this,e=this.readyState,h;if(k&&d){h=function(){if(e!=q.DONE){n(s);s.abort()}};window.attachEvent("onunload",h)}q.onopen&&q.onopen.apply(this,arguments);arguments.length>4?this._object.open(c,g,d,b,t):arguments.length>3?this._object.open(c,g,d,b):this._object.open(c,g,d);this.readyState=q.OPENED;p(this);this._object.onreadystatechange=function(){if(!l||d){s.readyState=s._object.readyState;o(s);if(s._aborted){s.readyState=q.UNSENT}else{if(s.readyState==q.DONE){delete s._data;n(s);k&&d&&window.detachEvent("onunload",h)}e!=s.readyState&&p(s);e=s.readyState}}}};q.prototype.send=function(b){q.onsend&&q.onsend.apply(this,arguments);arguments.length||(b=null);if(b&&b.nodeType){b=window.XMLSerializer?(new window.XMLSerializer).serializeToString(b):b.xml;this._headers["Content-Type"]||this._object.setRequestHeader("Content-Type","application/xml")}this._data=b;b:{this._object.send(this._data);if(l&&!this._async){this.readyState=q.OPENED;for(o(this);this.readyState<q.DONE;){this.readyState++;p(this);if(this._aborted){break b}}}}};q.prototype.abort=function(){q.onabort&&q.onabort.apply(this,arguments);if(this.readyState>q.UNSENT){this._aborted=true}this._object.abort();n(this);this.readyState=q.UNSENT;delete this._data};q.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()};q.prototype.getResponseHeader=function(b){return this._object.getResponseHeader(b)};q.prototype.setRequestHeader=function(d,c){if(!this._headers){this._headers={}}this._headers[d]=c;return this._object.setRequestHeader(d,c)};q.prototype.addEventListener=function(g,f,s){for(var i=0,h;h=this._listeners[i];i++){if(h[0]==g&&h[1]==f&&h[2]==s){return}}this._listeners.push([g,f,s])};q.prototype.removeEventListener=function(g,f,s){for(var i=0,h;h=this._listeners[i];i++){if(h[0]==g&&h[1]==f&&h[2]==s){break}}h&&this._listeners.splice(i,1)};q.prototype.dispatchEvent=function(e){e={type:e.type,target:this,currentTarget:this,eventPhase:2,bubbles:e.bubbles,cancelable:e.cancelable,timeStamp:e.timeStamp,stopPropagation:function(){},preventDefault:function(){},initEvent:function(){}};e.type=="readystatechange"&&this.onreadystatechange&&(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[e]);for(var d=0,f;f=this._listeners[d];d++){f[0]==e.type&&!f[2]&&(f[1].handleEvent||f[1]).apply(this,[e])}};q.prototype.toString=function(){return"[object XMLHttpRequest]"};q.toString=function(){return"[XMLHttpRequest]"};window.Function.prototype.apply||(window.Function.prototype.apply=function(d,c){c||(c=[]);d.__func=this;d.__func(c[0],c[1],c[2],c[3],c[4]);delete d.__func});OpenLayers.Request.XMLHttpRequest=q})();OpenLayers.Format.KML=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{kml:"http://www.opengis.net/kml/2.2",gx:"http://www.google.com/kml/ext/2.2"},kmlns:"http://earth.google.com/kml/2.0",placemarksDesc:"No description available",foldersName:"OpenLayers export",foldersDesc:"Exported on "+new Date,extractAttributes:!0,kvpAttributes:!1,extractStyles:!1,extractTracks:!1,trackAttributes:null,internalns:null,features:null,styles:null,styleBaseUrl:"",fetched:null,maxDepth:0,initialize:function(b){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,kmlColor:/(\w{2})(\w{2})(\w{2})(\w{2})/,kmlIconPalette:/root:\/\/icons\/palette-(\d+)(\.\w+)/,straightBracket:/\$\[(.*?)\]/g};this.externalProjection=new OpenLayers.Projection("EPSG:4326");OpenLayers.Format.XML.prototype.initialize.apply(this,[b])},read:function(b){this.features=[];this.styles={};this.fetched={};return this.parseData(b,{depth:0,styleBaseUrl:this.styleBaseUrl})},parseData:function(i,h){"string"==typeof i&&(i=OpenLayers.Format.XML.prototype.read.apply(this,[i]));for(var n=["Link","NetworkLink","Style","StyleMap","Placemark"],m=0,l=n.length;m<l;++m){var k=n[m],j=this.getElementsByTagNameNS(i,"*",k);if(0!=j.length){switch(k.toLowerCase()){case"link":case"networklink":this.parseLinks(j,h);break;case"style":this.extractStyles&&this.parseStyles(j,h);break;case"stylemap":this.extractStyles&&this.parseStyleMaps(j,h);break;case"placemark":this.parseFeatures(j,h)}}}return this.features},parseLinks:function(h,g){if(g.depth>=this.maxDepth){return !1}var l=OpenLayers.Util.extend({},g);l.depth++;for(var k=0,j=h.length;k<j;k++){var i=this.parseProperty(h[k],"*","href");i&&!this.fetched[i]&&(this.fetched[i]=!0,(i=this.fetchLink(i))&&this.parseData(i,l))}},fetchLink:function(b){if(b=OpenLayers.Request.GET({url:b,async:!1})){return b.responseText}},parseStyles:function(g,f){for(var j=0,i=g.length;j<i;j++){var h=this.parseStyle(g[j]);h&&(this.styles[(f.styleBaseUrl||"")+"#"+h.id]=h)}},parseKmlColor:function(d){var c=null;d&&(d=d.match(this.regExes.kmlColor))&&(c={color:"#"+d[4]+d[3]+d[2],opacity:parseInt(d[1],16)/255});return c},parseStyle:function(z){for(var y={},x=["LineStyle","PolyStyle","IconStyle","BalloonStyle","LabelStyle"],w,v,u=0,t=x.length;u<t;++u){if(w=x[u],v=this.getElementsByTagNameNS(z,"*",w)[0]){switch(w.toLowerCase()){case"linestyle":w=this.parseProperty(v,"*","color");if(w=this.parseKmlColor(w)){y.strokeColor=w.color,y.strokeOpacity=w.opacity}(w=this.parseProperty(v,"*","width"))&&(y.strokeWidth=w);break;case"polystyle":w=this.parseProperty(v,"*","color");if(w=this.parseKmlColor(w)){y.fillOpacity=w.opacity,y.fillColor=w.color}"0"==this.parseProperty(v,"*","fill")&&(y.fillColor="none");"0"==this.parseProperty(v,"*","outline")&&(y.strokeWidth="0");break;case"iconstyle":var s=parseFloat(this.parseProperty(v,"*","scale")||1);w=32*s;var r=32*s,q=this.getElementsByTagNameNS(v,"*","Icon")[0];if(q){var p=this.parseProperty(q,"*","href");if(p){var n=this.parseProperty(q,"*","w"),o=this.parseProperty(q,"*","h");OpenLayers.String.startsWith(p,"http://maps.google.com/mapfiles/kml")&&(!n&&!o)&&(o=n=64,s/=2);n=n||o;o=o||n;n&&(w=parseInt(n)*s);o&&(r=parseInt(o)*s);if(o=p.match(this.regExes.kmlIconPalette)){n=o[1],o=o[2],p=this.parseProperty(q,"*","x"),q=this.parseProperty(q,"*","y"),p="http://maps.google.com/mapfiles/kml/pal"+n+"/icon"+(8*(q?7-q/32:7)+(p?p/32:0))+o}y.graphicOpacity=1;y.externalGraphic=p}}if(v=this.getElementsByTagNameNS(v,"*","hotSpot")[0]){p=parseFloat(v.getAttribute("x")),q=parseFloat(v.getAttribute("y")),n=v.getAttribute("xunits"),"pixels"==n?y.graphicXOffset=-p*s:"insetPixels"==n?y.graphicXOffset=-w+p*s:"fraction"==n&&(y.graphicXOffset=-w*p),v=v.getAttribute("yunits"),"pixels"==v?y.graphicYOffset=-r+q*s+1:"insetPixels"==v?y.graphicYOffset=-(q*s)+1:"fraction"==v&&(y.graphicYOffset=-r*(1-q)+1)}y.graphicWidth=w;y.graphicHeight=r;break;case"balloonstyle":(v=OpenLayers.Util.getXmlNodeValue(v))&&(y.balloonStyle=v.replace(this.regExes.straightBracket,"${$1}"));break;case"labelstyle":if(w=this.parseProperty(v,"*","color"),w=this.parseKmlColor(w)){y.fontColor=w.color,y.fontOpacity=w.opacity}}}}!y.strokeColor&&y.fillColor&&(y.strokeColor=y.fillColor);if((z=z.getAttribute("id"))&&y){y.id=z}return y},parseStyleMaps:function(t,s){for(var r=0,q=t.length;r<q;r++){for(var p=t[r],o=this.getElementsByTagNameNS(p,"*","Pair"),p=p.getAttribute("id"),n=0,m=o.length;n<m;n++){var l=o[n],k=this.parseProperty(l,"*","key");(l=this.parseProperty(l,"*","styleUrl"))&&"normal"==k&&(this.styles[(s.styleBaseUrl||"")+"#"+p]=this.styles[(s.styleBaseUrl||"")+l])}}},parseFeatures:function(j,i){for(var p=[],o=0,n=j.length;o<n;o++){var m=j[o],l=this.parseFeature.apply(this,[m]);if(l){this.extractStyles&&(l.attributes&&l.attributes.styleUrl)&&(l.style=this.getStyle(l.attributes.styleUrl,i));if(this.extractStyles){var k=this.getElementsByTagNameNS(m,"*","Style")[0];if(k&&(k=this.parseStyle(k))){l.style=OpenLayers.Util.extend(l.style,k)}}if(this.extractTracks){if((m=this.getElementsByTagNameNS(m,this.namespaces.gx,"Track"))&&0<m.length){l={features:[],feature:l},this.readNode(m[0],l),0<l.features.length&&p.push.apply(p,l.features)}}else{p.push(l)}}else{throw"Bad Placemark: "+o}}this.features=this.features.concat(p)},readers:{kml:{when:function(d,c){c.whens.push(OpenLayers.Date.parse(this.getChildValue(d)))},_trackPointAttribute:function(e,d){var f=e.nodeName.split(":").pop();d.attributes[f].push(this.getChildValue(e))}},gx:{Track:function(t,s){var r={whens:[],points:[],angles:[]};if(this.trackAttributes){var q;r.attributes={};for(var p=0,o=this.trackAttributes.length;p<o;++p){q=this.trackAttributes[p],r.attributes[q]=[],q in this.readers.kml||(this.readers.kml[q]=this.readers.kml._trackPointAttribute)}}this.readChildNodes(t,r);if(r.whens.length!==r.points.length){throw Error("gx:Track with unequal number of when ("+r.whens.length+") and gx:coord ("+r.points.length+") elements.")}var n=0<r.angles.length;if(n&&r.whens.length!==r.angles.length){throw Error("gx:Track with unequal number of when ("+r.whens.length+") and gx:angles ("+r.angles.length+") elements.")}for(var m,l,p=0,o=r.whens.length;p<o;++p){m=s.feature.clone();m.fid=s.feature.fid||s.feature.id;l=r.points[p];m.geometry=l;"z" in l&&(m.attributes.altitude=l.z);this.internalProjection&&this.externalProjection&&m.geometry.transform(this.externalProjection,this.internalProjection);if(this.trackAttributes){l=0;for(var k=this.trackAttributes.length;l<k;++l){m.attributes[q]=r.attributes[this.trackAttributes[l]][p]}}m.attributes.when=r.whens[p];m.attributes.trackId=s.feature.id;n&&(l=r.angles[p],m.attributes.heading=parseFloat(l[0]),m.attributes.tilt=parseFloat(l[1]),m.attributes.roll=parseFloat(l[2]));s.features.push(m)}},coord:function(f,e){var h=this.getChildValue(f).replace(this.regExes.trimSpace,"").split(/\s+/),g=new OpenLayers.Geometry.Point(h[0],h[1]);2<h.length&&(g.z=parseFloat(h[2]));e.points.push(g)},angles:function(e,d){var f=this.getChildValue(e).replace(this.regExes.trimSpace,"").split(/\s+/);d.angles.push(f)}}},parseFeature:function(j){for(var i=["MultiGeometry","Polygon","LineString","Point"],p,o,n,m=0,l=i.length;m<l;++m){if(p=i[m],this.internalns=j.namespaceURI?j.namespaceURI:this.kmlns,o=this.getElementsByTagNameNS(j,this.internalns,p),0<o.length){if(i=this.parseGeometry[p.toLowerCase()]){n=i.apply(this,[o[0]]),this.internalProjection&&this.externalProjection&&n.transform(this.externalProjection,this.internalProjection)}else{throw new TypeError("Unsupported geometry type: "+p)}break}}var k;this.extractAttributes&&(k=this.parseAttributes(j));p=new OpenLayers.Feature.Vector(n,k);j=j.getAttribute("id")||j.getAttribute("name");null!=j&&(p.fid=j);return p},getStyle:function(f,e){var h=OpenLayers.Util.removeTail(f),g=OpenLayers.Util.extend({},e);g.depth++;g.styleBaseUrl=h;!this.styles[f]&&!OpenLayers.String.startsWith(f,"#")&&g.depth<=this.maxDepth&&!this.fetched[h]&&(h=this.fetchLink(h))&&this.parseData(h,g);return OpenLayers.Util.extend({},this.styles[f])},parseGeometry:{point:function(e){var d=this.getElementsByTagNameNS(e,this.internalns,"coordinates"),e=[];if(0<d.length){var f=d[0].firstChild.nodeValue,f=f.replace(this.regExes.removeSpace,""),e=f.split(",")}d=null;if(1<e.length){2==e.length&&(e[2]=null),d=new OpenLayers.Geometry.Point(e[0],e[1],e[2])}else{throw"Bad coordinate string: "+f}return d},linestring:function(r,q){var p=this.getElementsByTagNameNS(r,this.internalns,"coordinates"),o=null;if(0<p.length){for(var p=this.getChildValue(p[0]),p=p.replace(this.regExes.trimSpace,""),p=p.replace(this.regExes.trimComma,","),o=p.split(this.regExes.splitSpace),n=o.length,m=Array(n),l,k,j=0;j<n;++j){if(l=o[j].split(","),k=l.length,1<k){2==l.length&&(l[2]=null),m[j]=new OpenLayers.Geometry.Point(l[0],l[1],l[2])}else{throw"Bad LineString point coordinates: "+o[j]}}if(n){o=q?new OpenLayers.Geometry.LinearRing(m):new OpenLayers.Geometry.LineString(m)}else{throw"Bad LineString coordinates: "+p}}return o},polygon:function(g){var g=this.getElementsByTagNameNS(g,this.internalns,"LinearRing"),f=g.length,j=Array(f);if(0<f){for(var i=0,h=g.length;i<h;++i){if(f=this.parseGeometry.linestring.apply(this,[g[i],!0])){j[i]=f}else{throw"Bad LinearRing geometry: "+i}}}return new OpenLayers.Geometry.Polygon(j)},multigeometry:function(h){for(var g,l=[],k=h.childNodes,j=0,i=k.length;j<i;++j){h=k[j],1==h.nodeType&&(g=this.parseGeometry[(h.prefix?h.nodeName.split(":")[1]:h.nodeName).toLowerCase()])&&l.push(g.apply(this,[h]))}return new OpenLayers.Geometry.Collection(l)}},parseAttributes:function(i){var h={},n=i.getElementsByTagName("ExtendedData");n.length&&(h=this.parseExtendedData(n[0]));for(var m,l,k,i=i.childNodes,n=0,j=i.length;n<j;++n){if(m=i[n],1==m.nodeType&&(l=m.childNodes,1<=l.length&&3>=l.length)){switch(l.length){case 1:k=l[0];break;case 2:k=l[0];l=l[1];k=3==k.nodeType||4==k.nodeType?k:l;break;default:k=l[1]}if(3==k.nodeType||4==k.nodeType){if(m=m.prefix?m.nodeName.split(":")[1]:m.nodeName,k=OpenLayers.Util.getXmlNodeValue(k)){k=k.replace(this.regExes.trimSpace,""),h[m]=k}}}}return h},parseExtendedData:function(r){var q={},p,o,n,m,l=r.getElementsByTagName("Data");p=0;for(o=l.length;p<o;p++){n=l[p];m=n.getAttribute("name");var k={},j=n.getElementsByTagName("value");j.length&&(k.value=this.getChildValue(j[0]));this.kvpAttributes?q[m]=k.value:(n=n.getElementsByTagName("displayName"),n.length&&(k.displayName=this.getChildValue(n[0])),q[m]=k)}r=r.getElementsByTagName("SimpleData");p=0;for(o=r.length;p<o;p++){k={},n=r[p],m=n.getAttribute("name"),k.value=this.getChildValue(n),this.kvpAttributes?q[m]=k.value:(k.displayName=m,q[m]=k)}return q},parseProperty:function(g,f,j){var i,g=this.getElementsByTagNameNS(g,f,j);try{i=OpenLayers.Util.getXmlNodeValue(g[0])}catch(h){i=null}return i},write:function(g){OpenLayers.Util.isArray(g)||(g=[g]);for(var f=this.createElementNS(this.kmlns,"kml"),j=this.createFolderXML(),i=0,h=g.length;i<h;++i){j.appendChild(this.createPlacemarkXML(g[i]))}f.appendChild(j);return OpenLayers.Format.XML.prototype.write.apply(this,[f])},createFolderXML:function(){var e=this.createElementNS(this.kmlns,"Folder");if(this.foldersName){var d=this.createElementNS(this.kmlns,"name"),f=this.createTextNode(this.foldersName);d.appendChild(f);e.appendChild(d)}this.foldersDesc&&(d=this.createElementNS(this.kmlns,"description"),f=this.createTextNode(this.foldersDesc),d.appendChild(f),e.appendChild(d));return e},createPlacemarkXML:function(f){var e=this.createElementNS(this.kmlns,"name");e.appendChild(this.createTextNode(f.style&&f.style.label?f.style.label:f.attributes.name||f.id));var h=this.createElementNS(this.kmlns,"description");h.appendChild(this.createTextNode(f.attributes.description||this.placemarksDesc));var g=this.createElementNS(this.kmlns,"Placemark");null!=f.fid&&g.setAttribute("id",f.fid);g.appendChild(e);g.appendChild(h);e=this.buildGeometryNode(f.geometry);g.appendChild(e);f.attributes&&(f=this.buildExtendedData(f.attributes))&&g.appendChild(f);return g},buildGeometryNode:function(e){var d=e.CLASS_NAME,d=this.buildGeometry[d.substring(d.lastIndexOf(".")+1).toLowerCase()],f=null;d&&(f=d.apply(this,[e]));return f},buildGeometry:{point:function(d){var c=this.createElementNS(this.kmlns,"Point");c.appendChild(this.buildCoordinatesNode(d));return c},multipoint:function(b){return this.buildGeometry.collection.apply(this,[b])},linestring:function(d){var c=this.createElementNS(this.kmlns,"LineString");c.appendChild(this.buildCoordinatesNode(d));return c},multilinestring:function(b){return this.buildGeometry.collection.apply(this,[b])},linearring:function(d){var c=this.createElementNS(this.kmlns,"LinearRing");c.appendChild(this.buildCoordinatesNode(d));return c},polygon:function(h){for(var g=this.createElementNS(this.kmlns,"Polygon"),h=h.components,l,k,j=0,i=h.length;j<i;++j){l=0==j?"outerBoundaryIs":"innerBoundaryIs",l=this.createElementNS(this.kmlns,l),k=this.buildGeometry.linearring.apply(this,[h[j]]),l.appendChild(k),g.appendChild(l)}return g},multipolygon:function(b){return this.buildGeometry.collection.apply(this,[b])},collection:function(g){for(var f=this.createElementNS(this.kmlns,"MultiGeometry"),j,i=0,h=g.components.length;i<h;++i){(j=this.buildGeometryNode.apply(this,[g.components[i]]))&&f.appendChild(j)}return f}},buildCoordinatesNode:function(h){var g=this.createElementNS(this.kmlns,"coordinates"),l;if(l=h.components){for(var k=l.length,j=Array(k),i=0;i<k;++i){h=l[i],j[i]=this.buildCoordinates(h)}l=j.join(" ")}else{l=this.buildCoordinates(h)}l=this.createTextNode(l);g.appendChild(l);return g},buildCoordinates:function(b){this.internalProjection&&this.externalProjection&&(b=b.clone(),b.transform(this.internalProjection,this.externalProjection));return b.x+","+b.y},buildExtendedData:function(h){var g=this.createElementNS(this.kmlns,"ExtendedData"),l;for(l in h){if(h[l]&&"name"!=l&&"description"!=l&&"styleUrl"!=l){var k=this.createElementNS(this.kmlns,"Data");k.setAttribute("name",l);var j=this.createElementNS(this.kmlns,"value");if("object"==typeof h[l]){if(h[l].value&&j.appendChild(this.createTextNode(h[l].value)),h[l].displayName){var i=this.createElementNS(this.kmlns,"displayName");i.appendChild(this.getXMLDoc().createCDATASection(h[l].displayName));k.appendChild(i)}}else{j.appendChild(this.createTextNode(h[l]))}k.appendChild(j);g.appendChild(k)}}return this.isSimpleContent(g)?null:g},CLASS_NAME:"OpenLayers.Format.KML"});OpenLayers.Protocol.WFS.v1=OpenLayers.Class(OpenLayers.Protocol,{version:null,srsName:"EPSG:4326",featureType:null,featureNS:null,geometryName:"the_geom",schema:null,featurePrefix:"feature",formatOptions:null,readFormat:null,readOptions:null,initialize:function(b){OpenLayers.Protocol.prototype.initialize.apply(this,[b]);b.format||(this.format=OpenLayers.Format.WFST(OpenLayers.Util.extend({version:this.version,featureType:this.featureType,featureNS:this.featureNS,featurePrefix:this.featurePrefix,geometryName:this.geometryName,srsName:this.srsName,schema:this.schema},this.formatOptions)));!b.geometryName&&1<parseFloat(this.format.version)&&this.setGeometryName(null)},destroy:function(){this.options&&!this.options.format&&this.format.destroy();this.format=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(e){OpenLayers.Protocol.prototype.read.apply(this,arguments);e=OpenLayers.Util.extend({},e);OpenLayers.Util.applyDefaults(e,this.options||{});var d=new OpenLayers.Protocol.Response({requestType:"read"}),f=OpenLayers.Format.XML.prototype.write.apply(this.format,[this.format.writeNode("wfs:GetFeature",e)]);d.priv=OpenLayers.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,d,e),params:e.params,headers:e.headers,data:f});return d},setFeatureType:function(b){this.featureType=b;this.format.featureType=b},setGeometryName:function(b){this.geometryName=b;this.format.geometryName=b},handleRead:function(e,d){d=OpenLayers.Util.extend({},d);OpenLayers.Util.applyDefaults(d,this.options);if(d.callback){var f=e.priv;200<=f.status&&300>f.status?(f=this.parseResponse(f,d.readOptions))&&!1!==f.success?(d.readOptions&&"object"==d.readOptions.output?OpenLayers.Util.extend(e,f):e.features=f,e.code=OpenLayers.Protocol.Response.SUCCESS):(e.code=OpenLayers.Protocol.Response.FAILURE,e.error=f):e.code=OpenLayers.Protocol.Response.FAILURE;d.callback.call(d.scope,e)}},parseResponse:function(f,e){var h=f.responseXML;if(!h||!h.documentElement){h=f.responseText}if(!h||0>=h.length){return null}h=null!==this.readFormat?this.readFormat.read(h):this.format.read(h,e);if(!this.featureNS){var g=this.readFormat||this.format;this.featureNS=g.featureNS;g.autoConfig=!1;this.geometryName||this.setGeometryName(g.geometryName)}return h},commit:function(e,d){d=OpenLayers.Util.extend({},d);OpenLayers.Util.applyDefaults(d,this.options);var f=new OpenLayers.Protocol.Response({requestType:"commit",reqFeatures:e});f.priv=OpenLayers.Request.POST({url:d.url,headers:d.headers,data:this.format.write(e,d),callback:this.createCallback(this.handleCommit,f,d)});return f},handleCommit:function(f,e){if(e.callback){var h=f.priv,g=h.responseXML;if(!g||!g.documentElement){g=h.responseText}h=this.format.read(g)||{};f.insertIds=h.insertIds||[];h.success?f.code=OpenLayers.Protocol.Response.SUCCESS:(f.code=OpenLayers.Protocol.Response.FAILURE,f.error=h);e.callback.call(e.scope,f)}},filterDelete:function(g,f){f=OpenLayers.Util.extend({},f);OpenLayers.Util.applyDefaults(f,this.options);new OpenLayers.Protocol.Response({requestType:"commit"});var j=this.format.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version}}),i=this.format.createElementNSPlus("wfs:Delete",{attributes:{typeName:(f.featureNS?this.featurePrefix+":":"")+f.featureType}});f.featureNS&&i.setAttribute("xmlns:"+this.featurePrefix,f.featureNS);var h=this.format.writeNode("ogc:Filter",g);i.appendChild(h);j.appendChild(i);j=OpenLayers.Format.XML.prototype.write.apply(this.format,[j]);return OpenLayers.Request.POST({url:this.url,callback:f.callback||function(){},data:j})},abort:function(b){b&&b.priv.abort()},CLASS_NAME:"OpenLayers.Protocol.WFS.v1"});OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:!1,citeCompliant:!1,mouseDown:!1,stoppedDown:null,lastDown:null,lastUp:null,persist:!1,stopDown:!1,stopUp:!1,layerOptions:null,pixelTolerance:5,touch:!1,lastTouchPx:null,initialize:function(e,d,f){if(!f||!f.layerOptions||!f.layerOptions.styleMap){this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})}OpenLayers.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments)){return !1}var b=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,b);this.map.addLayer(this.layer);return !0},createFeature:function(b){b=this.layer.getLonLatFromViewPortPx(b);b=new OpenLayers.Geometry.Point(b.lon,b.lat);this.point=new OpenLayers.Feature.Vector(b);this.callback("create",[this.point.geometry,this.point]);this.point.geometry.clearBounds();this.layer.addFeatures([this.point],{silent:!0})},deactivate:function(){if(!OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){return !1}this.cancel();null!=this.layer.map&&(this.destroyFeature(!0),this.layer.destroy(!1));this.layer=null;this.touch=!1;return !0},destroyFeature:function(b){this.layer&&(b||!this.persist)&&this.layer.destroyFeatures();this.point=null},destroyPersistedFeature:function(){var b=this.layer;b&&1<b.features.length&&this.layer.features[0].destroy()},finalize:function(b){this.mouseDown=!1;this.lastTouchPx=this.lastUp=this.lastDown=null;this.callback(b?"cancel":"done",[this.geometryClone()]);this.destroyFeature(b)},cancel:function(){this.finalize(!0)},click:function(b){OpenLayers.Event.stop(b);return !1},dblclick:function(b){OpenLayers.Event.stop(b);return !1},modifyFeature:function(b){this.point||this.createFeature(b);b=this.layer.getLonLatFromViewPortPx(b);this.point.geometry.x=b.lon;this.point.geometry.y=b.lat;this.callback("modify",[this.point.geometry,this.point,!1]);this.point.geometry.clearBounds();this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var b=this.point&&this.point.geometry;b&&this.multi&&(b=new OpenLayers.Geometry.MultiPoint([b]));return b},geometryClone:function(){var b=this.getGeometry();return b&&b.clone()},mousedown:function(b){return this.down(b)},touchstart:function(b){this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this}));this.lastTouchPx=b.xy;return this.down(b)},mousemove:function(b){return this.move(b)},touchmove:function(b){this.lastTouchPx=b.xy;return this.move(b)},mouseup:function(b){return this.up(b)},touchend:function(b){b.xy=this.lastTouchPx;return this.up(b)},down:function(b){this.mouseDown=!0;this.lastDown=b.xy;this.touch||this.modifyFeature(b.xy);this.stoppedDown=this.stopDown;return !this.stopDown},move:function(b){!this.touch&&(!this.mouseDown||this.stoppedDown)&&this.modifyFeature(b.xy);return !0},up:function(b){this.mouseDown=!1;this.stoppedDown=this.stopDown;return this.checkModifiers(b)&&(!this.lastUp||!this.lastUp.equals(b.xy))&&this.lastDown&&this.passesTolerance(this.lastDown,b.xy,this.pixelTolerance)?(this.touch&&this.modifyFeature(b.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=b.xy,this.finalize(),!this.stopUp):!0},mouseout:function(b){OpenLayers.Util.mouseLeft(b,this.map.viewPortDiv)&&(this.stoppedDown=this.stopDown,this.mouseDown=!1)},passesTolerance:function(f,e,h){var g=!0;null!=h&&f&&e&&f.distanceTo(e)>h&&(g=!1);return g},CLASS_NAME:"OpenLayers.Handler.Point"});OpenLayers.Handler.Path=OpenLayers.Class(OpenLayers.Handler.Point,{line:null,maxVertices:null,doubleTouchTolerance:20,freehand:!1,freehandToggle:"shiftKey",timerId:null,redoStack:null,createFeature:function(b){b=this.layer.getLonLatFromViewPortPx(b);b=new OpenLayers.Geometry.Point(b.lon,b.lat);this.point=new OpenLayers.Feature.Vector(b);this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.point.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.line,this.point],{silent:!0})},destroyFeature:function(b){OpenLayers.Handler.Point.prototype.destroyFeature.call(this,b);this.line=null},destroyPersistedFeature:function(){var b=this.layer;b&&2<b.features.length&&this.layer.features[0].destroy()},removePoint:function(){this.point&&this.layer.removeFeatures([this.point])},addPoint:function(b){this.layer.removeFeatures([this.point]);b=this.layer.getLonLatFromViewPortPx(b);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat));this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length);this.layer.addFeatures([this.point]);this.callback("point",[this.point.geometry,this.getGeometry()]);this.callback("modify",[this.point.geometry,this.getSketch()]);this.drawFeature();delete this.redoStack},insertXY:function(d,c){this.line.geometry.addComponent(new OpenLayers.Geometry.Point(d,c),this.getCurrentPointIndex());this.drawFeature();delete this.redoStack},insertDeltaXY:function(e,d){var f=this.line.geometry.components[this.getCurrentPointIndex()-1];f&&(!isNaN(f.x)&&!isNaN(f.y))&&this.insertXY(f.x+e,f.y+d)},insertDirectionLength:function(f,e){var f=f*(Math.PI/180),h=e*Math.cos(f),g=e*Math.sin(f);this.insertDeltaXY(h,g)},insertDeflectionLength:function(f,e){var h=this.getCurrentPointIndex()-1;if(0<h){var g=this.line.geometry.components[h],h=this.line.geometry.components[h-1];this.insertDirectionLength(180*Math.atan2(g.y-h.y,g.x-h.x)/Math.PI+f,e)}},getCurrentPointIndex:function(){return this.line.geometry.components.length-1},undo:function(){var e=this.line.geometry,d=e.components,f=this.getCurrentPointIndex()-1,d=d[f];if(e=e.removeComponent(d)){this.redoStack||(this.redoStack=[]),this.redoStack.push(d),this.drawFeature()}return e},redo:function(){var b=this.redoStack&&this.redoStack.pop();b&&(this.line.geometry.addComponent(b,this.getCurrentPointIndex()),this.drawFeature());return !!b},freehandMode:function(b){return this.freehandToggle&&b[this.freehandToggle]?!this.freehand:this.freehand},modifyFeature:function(e,d){this.line||this.createFeature(e);var f=this.layer.getLonLatFromViewPortPx(e);this.point.geometry.x=f.lon;this.point.geometry.y=f.lat;this.callback("modify",[this.point.geometry,this.getSketch(),d]);this.point.geometry.clearBounds();this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.line,this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.line},getGeometry:function(){var b=this.line&&this.line.geometry;b&&this.multi&&(b=new OpenLayers.Geometry.MultiLineString([b]));return b},touchstart:function(b){if(this.timerId&&this.passesTolerance(this.lastTouchPx,b.xy,this.doubleTouchTolerance)){return this.finishGeometry(),window.clearTimeout(this.timerId),this.timerId=null,!1}this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null);this.timerId=window.setTimeout(OpenLayers.Function.bind(function(){this.timerId=null},this),300);return OpenLayers.Handler.Point.prototype.touchstart.call(this,b)},down:function(d){var c=this.stopDown;this.freehandMode(d)&&(c=!0,this.touch&&(this.modifyFeature(d.xy,!!this.lastUp),OpenLayers.Event.stop(d)));!this.touch&&(!this.lastDown||!this.passesTolerance(this.lastDown,d.xy,this.pixelTolerance))&&this.modifyFeature(d.xy,!!this.lastUp);this.mouseDown=!0;this.lastDown=d.xy;this.stoppedDown=c;return !c},move:function(b){if(this.stoppedDown&&this.freehandMode(b)){return this.persist&&this.destroyPersistedFeature(),this.maxVertices&&this.line&&this.line.geometry.components.length===this.maxVertices?(this.removePoint(),this.finalize()):this.addPoint(b.xy),!1}!this.touch&&(!this.mouseDown||this.stoppedDown)&&this.modifyFeature(b.xy,!!this.lastUp);return !0},up:function(b){if(this.mouseDown&&(!this.lastUp||!this.lastUp.equals(b.xy))){this.stoppedDown&&this.freehandMode(b)?(this.persist&&this.destroyPersistedFeature(),this.removePoint(),this.finalize()):this.passesTolerance(this.lastDown,b.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(b.xy),null==this.lastUp&&this.persist&&this.destroyPersistedFeature(),this.addPoint(b.xy),this.lastUp=b.xy,this.line.geometry.components.length===this.maxVertices+1&&this.finishGeometry())}this.stoppedDown=this.stopDown;this.mouseDown=!1;return !this.stopUp},finishGeometry:function(){this.line.geometry.removeComponent(this.line.geometry.components[this.line.geometry.components.length-1]);this.removePoint();this.finalize()},dblclick:function(b){this.freehandMode(b)||this.finishGeometry();return !1},CLASS_NAME:"OpenLayers.Handler.Path"});OpenLayers.Control.Attribution=OpenLayers.Class(OpenLayers.Control,{separator:", ",template:"${layers}",destroy:function(){this.map.events.un({removelayer:this.updateAttribution,addlayer:this.updateAttribution,changelayer:this.updateAttribution,changebaselayer:this.updateAttribution,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.map.events.on({changebaselayer:this.updateAttribution,changelayer:this.updateAttribution,addlayer:this.updateAttribution,removelayer:this.updateAttribution,scope:this});this.updateAttribution();return this.div},updateAttribution:function(){var f=[];if(this.map&&this.map.layers){for(var e=0,h=this.map.layers.length;e<h;e++){var g=this.map.layers[e];g.attribution&&g.getVisibility()&&-1===OpenLayers.Util.indexOf(f,g.attribution)&&f.push(g.attribution)}this.div.innerHTML=OpenLayers.String.format(this.template,{layers:f.join(this.separator)})}},CLASS_NAME:"OpenLayers.Control.Attribution"});OpenLayers.Kinetic=OpenLayers.Class({threshold:0,deceleration:0.0035,nbPoints:100,delay:200,points:void 0,timerId:void 0,initialize:function(b){OpenLayers.Util.extend(this,b)},begin:function(){OpenLayers.Animation.stop(this.timerId);this.timerId=void 0;this.points=[]},update:function(b){this.points.unshift({xy:b,tick:(new Date).getTime()});this.points.length>this.nbPoints&&this.points.pop()},end:function(h){for(var g,l=(new Date).getTime(),k=0,j=this.points.length,i;k<j;k++){i=this.points[k];if(l-i.tick>this.delay){break}g=i}if(g&&(k=(new Date).getTime()-g.tick,l=Math.sqrt(Math.pow(h.x-g.xy.x,2)+Math.pow(h.y-g.xy.y,2)),k=l/k,!(0==k||k<this.threshold))){return l=Math.asin((h.y-g.xy.y)/l),g.xy.x<=h.x&&(l=Math.PI-l),{speed:k,theta:l}}},move:function(j,i){var p=j.speed,o=Math.cos(j.theta),n=-Math.sin(j.theta),m=(new Date).getTime(),l=0,k=0;this.timerId=OpenLayers.Animation.start(OpenLayers.Function.bind(function(){if(null!=this.timerId){var d=(new Date).getTime()-m,f=-this.deceleration*Math.pow(d,2)/2+p*d,e=f*o,f=f*n,b,c;b=!1;0>=-this.deceleration*d+p&&(OpenLayers.Animation.stop(this.timerId),this.timerId=null,b=!0);d=e-l;c=f-k;l=e;k=f;i(d,c,b)}},this))},CLASS_NAME:"OpenLayers.Kinetic"});OpenLayers.Layer.WMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"},isBaseLayer:!0,encodeBBOX:!1,noMagic:!1,yx:{},initialize:function(g,f,j,i){var h=[],j=OpenLayers.Util.upperCaseObject(j);1.3<=parseFloat(j.VERSION)&&!j.EXCEPTIONS&&(j.EXCEPTIONS="INIMAGE");h.push(g,f,j,i);OpenLayers.Layer.Grid.prototype.initialize.apply(this,h);OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));if(!this.noMagic&&this.params.TRANSPARENT&&"true"==this.params.TRANSPARENT.toString().toLowerCase()){if(null==i||!i.isBaseLayer){this.isBaseLayer=!1}"image/jpeg"==this.params.FORMAT&&(this.params.FORMAT=OpenLayers.Util.alphaHack()?"image/gif":"image/png")}},clone:function(b){null==b&&(b=new OpenLayers.Layer.WMS(this.name,this.url,this.params,this.getOptions()));return b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b])},reverseAxisOrder:function(){var b=this.projection.getCode();return 1.3<=parseFloat(this.params.VERSION)&&!(!this.yx[b]&&!OpenLayers.Projection.defaults[b].yx)},getURL:function(f){var f=this.adjustBounds(f),e=this.getImageSize(),h={},g=this.reverseAxisOrder();h.BBOX=this.encodeBBOX?f.toBBOX(null,g):f.toArray(g);h.WIDTH=e.w;h.HEIGHT=e.h;return this.getFullRequestString(h)},mergeNewParams:function(b){b=[OpenLayers.Util.upperCaseObject(b)];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,b)},getFullRequestString:function(e,d){var f=this.map.getProjectionObject(),f=this.projection&&this.projection.equals(f)?this.projection.getCode():f.getCode(),f="none"==f?null:f;1.3<=parseFloat(this.params.VERSION)?this.params.CRS=f:this.params.SRS=f;"boolean"==typeof this.params.TRANSPARENT&&(e.TRANSPARENT=this.params.TRANSPARENT?"TRUE":"FALSE");return OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.WMS"});OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15000,translationParameters:null,symbolMetrics:null,initialize:function(b){this.supported()&&(OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments),this.translationParameters={x:0,y:0},this.symbolMetrics={})},supported:function(){return document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#SVG","1.1")||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"))},inValidRange:function(e,d,f){e+=f?0:this.translationParameters.x;d+=f?0:this.translationParameters.y;return e>=-this.MAX_PIXEL&&e<=this.MAX_PIXEL&&d>=-this.MAX_PIXEL&&d<=this.MAX_PIXEL},setExtent:function(g,f){var j=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),i=this.getResolution(),h=-g.left/i,i=g.top/i;if(f){return this.left=h,this.top=i,this.rendererRoot.setAttributeNS(null,"viewBox","0 0 "+this.size.w+" "+this.size.h),this.translate(this.xOffset,0),!0}(h=this.translate(h-this.left+this.xOffset,i-this.top))||this.setExtent(g,!0);return j&&h},translate:function(e,d){if(this.inValidRange(e,d,!0)){var f="";if(e||d){f="translate("+e+","+d+")"}this.root.setAttributeNS(null,"transform",f);this.translationParameters={x:e,y:d};return !0}return !1},setSize:function(b){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);this.rendererRoot.setAttributeNS(null,"width",this.size.w);this.rendererRoot.setAttributeNS(null,"height",this.size.h)},getNodeType:function(e,d){var f=null;switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":f=d.externalGraphic?"image":this.isComplexSymbol(d.graphicName)?"svg":"circle";break;case"OpenLayers.Geometry.Rectangle":f="rect";break;case"OpenLayers.Geometry.LineString":f="polyline";break;case"OpenLayers.Geometry.LinearRing":f="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":f="path"}return f},setStyle:function(t,s,r){var s=s||t._style,r=r||t._options,q=parseFloat(t.getAttributeNS(null,"r")),p=1,o;if("OpenLayers.Geometry.Point"==t._geometryClass&&q){t.style.visibility="";if(!1===s.graphic){t.style.visibility="hidden"}else{if(s.externalGraphic){o=this.getPosition(t);s.graphicTitle&&(t.setAttributeNS(null,"title",s.graphicTitle),q=t.getElementsByTagName("title"),0<q.length?q[0].firstChild.textContent=s.graphicTitle:(q=this.nodeFactory(null,"title"),q.textContent=s.graphicTitle,t.appendChild(q)));s.graphicWidth&&s.graphicHeight&&t.setAttributeNS(null,"preserveAspectRatio","none");var q=s.graphicWidth||s.graphicHeight,n=s.graphicHeight||s.graphicWidth,q=q?q:2*s.pointRadius,n=n?n:2*s.pointRadius,m=void 0!=s.graphicYOffset?s.graphicYOffset:-(0.5*n),l=s.graphicOpacity||s.fillOpacity;t.setAttributeNS(null,"x",(o.x+(void 0!=s.graphicXOffset?s.graphicXOffset:-(0.5*q))).toFixed());t.setAttributeNS(null,"y",(o.y+m).toFixed());t.setAttributeNS(null,"width",q);t.setAttributeNS(null,"height",n);t.setAttributeNS(this.xlinkns,"href",s.externalGraphic);t.setAttributeNS(null,"style","opacity: "+l);t.onclick=OpenLayers.Renderer.SVG.preventDefault}else{if(this.isComplexSymbol(s.graphicName)){var q=3*s.pointRadius,n=2*q,k=this.importSymbol(s.graphicName);o=this.getPosition(t);p=3*this.symbolMetrics[k.id][0]/n;m=t.parentNode;l=t.nextSibling;m&&m.removeChild(t);t.firstChild&&t.removeChild(t.firstChild);t.appendChild(k.firstChild.cloneNode(!0));t.setAttributeNS(null,"viewBox",k.getAttributeNS(null,"viewBox"));t.setAttributeNS(null,"width",n);t.setAttributeNS(null,"height",n);t.setAttributeNS(null,"x",o.x-q);t.setAttributeNS(null,"y",o.y-q);l?m.insertBefore(t,l):m&&m.appendChild(t)}else{t.setAttributeNS(null,"r",s.pointRadius)}}}q=s.rotation;if((void 0!==q||void 0!==t._rotation)&&o){t._rotation=q,q|=0,"svg"!==t.nodeName?t.setAttributeNS(null,"transform","rotate("+q+" "+o.x+" "+o.y+")"):(o=this.symbolMetrics[k.id],t.firstChild.setAttributeNS(null,"transform","rotate("+q+" "+o[1]+" "+o[2]+")"))}}r.isFilled?(t.setAttributeNS(null,"fill",s.fillColor),t.setAttributeNS(null,"fill-opacity",s.fillOpacity)):t.setAttributeNS(null,"fill","none");r.isStroked?(t.setAttributeNS(null,"stroke",s.strokeColor),t.setAttributeNS(null,"stroke-opacity",s.strokeOpacity),t.setAttributeNS(null,"stroke-width",s.strokeWidth*p),t.setAttributeNS(null,"stroke-linecap",s.strokeLinecap||"round"),t.setAttributeNS(null,"stroke-linejoin","round"),s.strokeDashstyle&&t.setAttributeNS(null,"stroke-dasharray",this.dashStyle(s,p))):t.setAttributeNS(null,"stroke","none");s.pointerEvents&&t.setAttributeNS(null,"pointer-events",s.pointerEvents);null!=s.cursor&&t.setAttributeNS(null,"cursor",s.cursor);return t},dashStyle:function(f,e){var h=f.strokeWidth*e,g=f.strokeDashstyle;switch(g){case"solid":return"none";case"dot":return[1,4*h].join();case"dash":return[4*h,4*h].join();case"dashdot":return[4*h,4*h,1,4*h].join();case"longdash":return[8*h,4*h].join();case"longdashdot":return[8*h,4*h,1,4*h].join();default:return OpenLayers.String.trim(g).replace(/\s+/g,",")}},createNode:function(e,d){var f=document.createElementNS(this.xmlns,e);d&&f.setAttributeNS(null,"id",d);return f},nodeTypeCompare:function(d,c){return c==d.nodeName},createRenderRoot:function(){var b=this.nodeFactory(this.container.id+"_svgRoot","svg");b.style.display="block";return b},createRoot:function(b){return this.nodeFactory(this.container.id+b,"g")},createDefs:function(){var b=this.nodeFactory(this.container.id+"_defs","defs");this.rendererRoot.appendChild(b);return b},drawPoint:function(d,c){return this.drawCircle(d,c,1)},drawCircle:function(g,f,j){var i=this.getResolution(),h=(f.x-this.featureDx)/i+this.left,f=this.top-f.y/i;return this.inValidRange(h,f)?(g.setAttributeNS(null,"cx",h),g.setAttributeNS(null,"cy",f),g.setAttributeNS(null,"r",j),g):!1},drawLineString:function(e,d){var f=this.getComponentsString(d.components);return f.path?(e.setAttributeNS(null,"points",f.path),f.complete?e:null):!1},drawLinearRing:function(e,d){var f=this.getComponentsString(d.components);return f.path?(e.setAttributeNS(null,"points",f.path),f.complete?e:null):!1},drawPolygon:function(r,q){for(var p="",o=!0,n=!0,m,l,k=0,j=q.components.length;k<j;k++){p+=" M",m=this.getComponentsString(q.components[k].components," "),(l=m.path)?(p+=" "+l,n=m.complete&&n):o=!1}return o?(r.setAttributeNS(null,"d",p+" z"),r.setAttributeNS(null,"fill-rule","evenodd"),n?r:null):!1},drawRectangle:function(g,f){var j=this.getResolution(),i=(f.x-this.featureDx)/j+this.left,h=this.top-f.y/j;return this.inValidRange(i,h)?(g.setAttributeNS(null,"x",i),g.setAttributeNS(null,"y",h),g.setAttributeNS(null,"width",f.width/j),g.setAttributeNS(null,"height",f.height/j),g):!1},drawText:function(x,w,v){var u=!!w.labelOutlineWidth;if(u){var t=OpenLayers.Util.extend({},w);t.fontColor=t.labelOutlineColor;t.fontStrokeColor=t.labelOutlineColor;t.fontStrokeWidth=w.labelOutlineWidth;delete t.labelOutlineWidth;this.drawText(x,t,v)}var s=this.getResolution(),t=(v.x-this.featureDx)/s+this.left,r=v.y/s-this.top,u=u?this.LABEL_OUTLINE_SUFFIX:this.LABEL_ID_SUFFIX,s=this.nodeFactory(x+u,"text");s.setAttributeNS(null,"x",t);s.setAttributeNS(null,"y",-r);w.fontColor&&s.setAttributeNS(null,"fill",w.fontColor);w.fontStrokeColor&&s.setAttributeNS(null,"stroke",w.fontStrokeColor);w.fontStrokeWidth&&s.setAttributeNS(null,"stroke-width",w.fontStrokeWidth);w.fontOpacity&&s.setAttributeNS(null,"opacity",w.fontOpacity);w.fontFamily&&s.setAttributeNS(null,"font-family",w.fontFamily);w.fontSize&&s.setAttributeNS(null,"font-size",w.fontSize);w.fontWeight&&s.setAttributeNS(null,"font-weight",w.fontWeight);w.fontStyle&&s.setAttributeNS(null,"font-style",w.fontStyle);!0===w.labelSelect?(s.setAttributeNS(null,"pointer-events","visible"),s._featureId=x):s.setAttributeNS(null,"pointer-events","none");r=w.labelAlign||OpenLayers.Renderer.defaultSymbolizer.labelAlign;s.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[r[0]]||"middle");!0===OpenLayers.IS_GECKO&&s.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[r[1]]||"central");for(var q=w.label.split("\n"),p=q.length;s.childNodes.length>p;){s.removeChild(s.lastChild)}for(var o=0;o<p;o++){var n=this.nodeFactory(x+u+"_tspan_"+o,"tspan");!0===w.labelSelect&&(n._featureId=x,n._geometry=v,n._geometryClass=v.CLASS_NAME);!1===OpenLayers.IS_GECKO&&n.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[r[1]]||"-35%");n.setAttribute("x",t);if(0==o){var l=OpenLayers.Renderer.SVG.LABEL_VFACTOR[r[1]];null==l&&(l=-0.5);n.setAttribute("dy",l*(p-1)+"em")}else{n.setAttribute("dy","1em")}n.textContent=""===q[o]?" ":q[o];n.parentNode||s.appendChild(n)}s.parentNode||this.textRoot.appendChild(s)},getComponentsString:function(j,i){for(var p=[],o=!0,n=j.length,m=[],l,k=0;k<n;k++){l=j[k],p.push(l),(l=this.getShortString(l))?m.push(l):(0<k&&this.getShortString(j[k-1])&&m.push(this.clipLine(j[k],j[k-1])),k<n-1&&this.getShortString(j[k+1])&&m.push(this.clipLine(j[k],j[k+1])),o=!1)}return{path:m.join(i||","),complete:o}},clipLine:function(r,q){if(q.equals(r)){return""}var p=this.getResolution(),o=this.MAX_PIXEL-this.translationParameters.x,n=this.MAX_PIXEL-this.translationParameters.y,m=(q.x-this.featureDx)/p+this.left,l=this.top-q.y/p,k=(r.x-this.featureDx)/p+this.left,p=this.top-r.y/p,j;if(k<-o||k>o){j=(p-l)/(k-m),k=0>k?-o:o,p=l+(k-m)*j}if(p<-n||p>n){j=(k-m)/(p-l),p=0>p?-n:n,k=m+(p-l)*j}return k+","+p},getShortString:function(e){var d=this.getResolution(),f=(e.x-this.featureDx)/d+this.left,e=this.top-e.y/d;return this.inValidRange(f,e)?f+","+e:!1},getPosition:function(b){return{x:parseFloat(b.getAttributeNS(null,"cx")),y:parseFloat(b.getAttributeNS(null,"cy"))}},importSymbol:function(r){this.defs||(this.defs=this.createDefs());var q=this.container.id+"-"+r,p=document.getElementById(q);if(null!=p){return p}var o=OpenLayers.Renderer.symbol[r];if(!o){throw Error(r+" is not a valid symbol name")}var r=this.nodeFactory(q,"symbol"),n=this.nodeFactory(null,"polygon");r.appendChild(n);for(var p=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),m=[],l,k,j=0;j<o.length;j+=2){l=o[j],k=o[j+1],p.left=Math.min(p.left,l),p.bottom=Math.min(p.bottom,k),p.right=Math.max(p.right,l),p.top=Math.max(p.top,k),m.push(l,",",k)}n.setAttributeNS(null,"points",m.join(" "));o=p.getWidth();n=p.getHeight();r.setAttributeNS(null,"viewBox",[p.left-o,p.bottom-n,3*o,3*n].join(" "));this.symbolMetrics[q]=[Math.max(o,n),p.getCenterLonLat().lon,p.getCenterLonLat().lat];this.defs.appendChild(r);return r},getFeatureIdFromEvent:function(d){var c=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);c||(c=d.target,c=c.parentNode&&c!=this.rendererRoot?c.parentNode._featureId:void 0);return c},CLASS_NAME:"OpenLayers.Renderer.SVG"});OpenLayers.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"};OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"};OpenLayers.Renderer.SVG.LABEL_VFACTOR={t:0,b:-1};OpenLayers.Renderer.SVG.preventDefault=function(b){b.preventDefault&&b.preventDefault()};OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:!1,nativeJSON:function(){return !(!window.JSON||!("function"==typeof JSON.parse&&"function"==typeof JSON.stringify))}(),read:function(a,b){var c;if(this.nativeJSON){c=JSON.parse(a,b)}else{try{if(/^[\],:{}\s]*$/.test(a.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))&&(c=eval("("+a+")"),"function"===typeof b)){var d=function(a,c){if(c&&"object"===typeof c){for(var e in c){c.hasOwnProperty(e)&&(c[e]=d(e,c[e]))}}return b(a,c)};c=d("",c)}}catch(e){}}this.keepData&&(this.data=c);return c},write:function(g,f){this.pretty=!!f;var j=null,i=typeof g;if(this.serialize[i]){try{j=!this.pretty&&this.nativeJSON?JSON.stringify(g):this.serialize[i].apply(this,[g])}catch(h){OpenLayers.Console.error("Trouble serializing: "+h)}}return j},writeIndent:function(){var d=[];if(this.pretty){for(var c=0;c<this.level;++c){d.push(this.indent)}}return d.join("")},writeNewline:function(){return this.pretty?this.newline:""},writeSpace:function(){return this.pretty?this.space:""},serialize:{object:function(h){if(null==h){return"null"}if(h.constructor==Date){return this.serialize.date.apply(this,[h])}if(h.constructor==Array){return this.serialize.array.apply(this,[h])}var g=["{"];this.level+=1;var l,k,j,i=!1;for(l in h){h.hasOwnProperty(l)&&(k=OpenLayers.Format.JSON.prototype.write.apply(this,[l,this.pretty]),j=OpenLayers.Format.JSON.prototype.write.apply(this,[h[l],this.pretty]),null!=k&&null!=j&&(i&&g.push(","),g.push(this.writeNewline(),this.writeIndent(),k,":",this.writeSpace(),j),i=!0))}this.level-=1;g.push(this.writeNewline(),this.writeIndent(),"}");return g.join("")},array:function(g){var f,j=["["];this.level+=1;for(var i=0,h=g.length;i<h;++i){f=OpenLayers.Format.JSON.prototype.write.apply(this,[g[i],this.pretty]),null!=f&&(0<i&&j.push(","),j.push(this.writeNewline(),this.writeIndent(),f))}this.level-=1;j.push(this.writeNewline(),this.writeIndent(),"]");return j.join("")},string:function(d){var c={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return/["\\\x00-\x1f]/.test(d)?'"'+d.replace(/([\x00-\x1f\\"])/g,function(b,g){var f=c[g];if(f){return f}f=g.charCodeAt();return"\\u00"+Math.floor(f/16).toString(16)+(f%16).toString(16)})+'"':'"'+d+'"'},number:function(b){return isFinite(b)?""+b:"null"},"boolean":function(b){return""+b},date:function(d){function c(b){return 10>b?"0"+b:b}return'"'+d.getFullYear()+"-"+c(d.getMonth()+1)+"-"+c(d.getDate())+"T"+c(d.getHours())+":"+c(d.getMinutes())+":"+c(d.getSeconds())+'"'}},CLASS_NAME:"OpenLayers.Format.JSON"});OpenLayers.Format.GeoJSON=OpenLayers.Class(OpenLayers.Format.JSON,{ignoreExtraDims:!1,read:function(v,u,t){var u=u?u:"FeatureCollection",s=null,r=null;if(r="string"==typeof v?OpenLayers.Format.JSON.prototype.read.apply(this,[v,t]):v){if("string"!=typeof r.type){OpenLayers.Console.error("Bad GeoJSON - no type: "+v)}else{if(this.isValidType(r,u)){switch(u){case"Geometry":try{s=this.parseGeometry(r)}catch(q){OpenLayers.Console.error(q)}break;case"Feature":try{s=this.parseFeature(r),s.type="Feature"}catch(p){OpenLayers.Console.error(p)}break;case"FeatureCollection":switch(s=[],r.type){case"Feature":try{s.push(this.parseFeature(r))}catch(o){s=null,OpenLayers.Console.error(o)}break;case"FeatureCollection":v=0;for(u=r.features.length;v<u;++v){try{s.push(this.parseFeature(r.features[v]))}catch(n){s=null,OpenLayers.Console.error(n)}}break;default:try{var m=this.parseGeometry(r);s.push(new OpenLayers.Feature.Vector(m))}catch(l){s=null,OpenLayers.Console.error(l)}}}}}}else{OpenLayers.Console.error("Bad JSON: "+v)}return s},isValidType:function(e,d){var f=!1;switch(d){case"Geometry":-1==OpenLayers.Util.indexOf("Point MultiPoint LineString MultiLineString Polygon MultiPolygon Box GeometryCollection".split(" "),e.type)?OpenLayers.Console.error("Unsupported geometry type: "+e.type):f=!0;break;case"FeatureCollection":f=!0;break;default:e.type==d?f=!0:OpenLayers.Console.error("Cannot convert types from "+e.type+" to "+d)}return f},parseFeature:function(g){var f,j,i;j=g.properties?g.properties:{};i=g.geometry&&g.geometry.bbox||g.bbox;try{f=this.parseGeometry(g.geometry)}catch(h){throw h}f=new OpenLayers.Feature.Vector(f,j);i&&(f.bounds=OpenLayers.Bounds.fromArray(i));g.id&&(f.fid=g.id);return f},parseGeometry:function(g){if(null==g){return null}var f,j=!1;if("GeometryCollection"==g.type){if(!OpenLayers.Util.isArray(g.geometries)){throw"GeometryCollection must have geometries array: "+g}f=g.geometries.length;for(var j=Array(f),i=0;i<f;++i){j[i]=this.parseGeometry.apply(this,[g.geometries[i]])}f=new OpenLayers.Geometry.Collection(j);j=!0}else{if(!OpenLayers.Util.isArray(g.coordinates)){throw"Geometry must have coordinates array: "+g}if(!this.parseCoords[g.type.toLowerCase()]){throw"Unsupported geometry type: "+g.type}try{f=this.parseCoords[g.type.toLowerCase()].apply(this,[g.coordinates])}catch(h){throw h}}this.internalProjection&&(this.externalProjection&&!j)&&f.transform(this.externalProjection,this.internalProjection);return f},parseCoords:{point:function(b){if(!1==this.ignoreExtraDims&&2!=b.length){throw"Only 2D points are supported: "+b}return new OpenLayers.Geometry.Point(b[0],b[1])},multipoint:function(h){for(var g=[],l=null,k=0,j=h.length;k<j;++k){try{l=this.parseCoords.point.apply(this,[h[k]])}catch(i){throw i}g.push(l)}return new OpenLayers.Geometry.MultiPoint(g)},linestring:function(h){for(var g=[],l=null,k=0,j=h.length;k<j;++k){try{l=this.parseCoords.point.apply(this,[h[k]])}catch(i){throw i}g.push(l)}return new OpenLayers.Geometry.LineString(g)},multilinestring:function(h){for(var g=[],l=null,k=0,j=h.length;k<j;++k){try{l=this.parseCoords.linestring.apply(this,[h[k]])}catch(i){throw i}g.push(l)}return new OpenLayers.Geometry.MultiLineString(g)},polygon:function(i){for(var h=[],n,m,l=0,k=i.length;l<k;++l){try{m=this.parseCoords.linestring.apply(this,[i[l]])}catch(j){throw j}n=new OpenLayers.Geometry.LinearRing(m.components);h.push(n)}return new OpenLayers.Geometry.Polygon(h)},multipolygon:function(h){for(var g=[],l=null,k=0,j=h.length;k<j;++k){try{l=this.parseCoords.polygon.apply(this,[h[k]])}catch(i){throw i}g.push(l)}return new OpenLayers.Geometry.MultiPolygon(g)},box:function(b){if(2!=b.length){throw"GeoJSON box coordinates must have 2 elements"}return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(b[0][0],b[0][1]),new OpenLayers.Geometry.Point(b[1][0],b[0][1]),new OpenLayers.Geometry.Point(b[1][0],b[1][1]),new OpenLayers.Geometry.Point(b[0][0],b[1][1]),new OpenLayers.Geometry.Point(b[0][0],b[0][1])])])}},write:function(h,g){var l={type:null};if(OpenLayers.Util.isArray(h)){l.type="FeatureCollection";var k=h.length;l.features=Array(k);for(var j=0;j<k;++j){var i=h[j];if(!i instanceof OpenLayers.Feature.Vector){throw"FeatureCollection only supports collections of features: "+i}l.features[j]=this.extract.feature.apply(this,[i])}}else{0==h.CLASS_NAME.indexOf("OpenLayers.Geometry")?l=this.extract.geometry.apply(this,[h]):h instanceof OpenLayers.Feature.Vector&&(l=this.extract.feature.apply(this,[h]),h.layer&&h.layer.projection&&(l.crs=this.createCRSObject(h)))}return OpenLayers.Format.JSON.prototype.write.apply(this,[l,g])},createCRSObject:function(d){var d=d.layer.projection.toString(),c={};d.match(/epsg:/i)&&(d=parseInt(d.substring(d.indexOf(":")+1)),c=4326==d?{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}:{type:"name",properties:{name:"EPSG:"+d}});return c},extract:{feature:function(d){var c=this.extract.geometry.apply(this,[d.geometry]),c={type:"Feature",properties:d.attributes,geometry:c};null!=d.fid&&(c.id=d.fid);return c},geometry:function(d){if(null==d){return null}this.internalProjection&&this.externalProjection&&(d=d.clone(),d.transform(this.internalProjection,this.externalProjection));var c=d.CLASS_NAME.split(".")[2],d=this.extract[c.toLowerCase()].apply(this,[d]);return"Collection"==c?{type:"GeometryCollection",geometries:d}:{type:c,coordinates:d}},point:function(b){return[b.x,b.y]},multipoint:function(f){for(var e=[],h=0,g=f.components.length;h<g;++h){e.push(this.extract.point.apply(this,[f.components[h]]))}return e},linestring:function(f){for(var e=[],h=0,g=f.components.length;h<g;++h){e.push(this.extract.point.apply(this,[f.components[h]]))}return e},multilinestring:function(f){for(var e=[],h=0,g=f.components.length;h<g;++h){e.push(this.extract.linestring.apply(this,[f.components[h]]))}return e},polygon:function(f){for(var e=[],h=0,g=f.components.length;h<g;++h){e.push(this.extract.linestring.apply(this,[f.components[h]]))}return e},multipolygon:function(f){for(var e=[],h=0,g=f.components.length;h<g;++h){e.push(this.extract.polygon.apply(this,[f.components[h]]))}return e},collection:function(f){for(var e=f.components.length,h=Array(e),g=0;g<e;++g){h[g]=this.extract.geometry.apply(this,[f.components[g]])}return h}},CLASS_NAME:"OpenLayers.Format.GeoJSON"});OpenLayers.Control.DrawFeature=OpenLayers.Class(OpenLayers.Control,{layer:null,callbacks:null,multi:!1,featureAdded:function(){},handlerOptions:null,initialize:function(e,d,f){OpenLayers.Control.prototype.initialize.apply(this,[f]);this.callbacks=OpenLayers.Util.extend({done:this.drawFeature,modify:function(g,c){this.layer.events.triggerEvent("sketchmodified",{vertex:g,feature:c})},create:function(g,c){this.layer.events.triggerEvent("sketchstarted",{vertex:g,feature:c})}},this.callbacks);this.layer=e;this.handlerOptions=this.handlerOptions||{};this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{renderers:e.renderers,rendererOptions:e.rendererOptions});"multi" in this.handlerOptions||(this.handlerOptions.multi=this.multi);if(e=this.layer.styleMap&&this.layer.styleMap.styles.temporary){this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({"default":e})})}this.handler=new d(this,this.callbacks,this.handlerOptions)},drawFeature:function(b){b=new OpenLayers.Feature.Vector(b);!1!==this.layer.events.triggerEvent("sketchcomplete",{feature:b})&&(b.state=OpenLayers.State.INSERT,this.layer.addFeatures([b]),this.featureAdded(b),this.events.triggerEvent("featureadded",{feature:b}))},insertXY:function(d,c){this.handler&&this.handler.line&&this.handler.insertXY(d,c)},insertDeltaXY:function(d,c){this.handler&&this.handler.line&&this.handler.insertDeltaXY(d,c)},insertDirectionLength:function(d,c){this.handler&&this.handler.line&&this.handler.insertDirectionLength(d,c)},insertDeflectionLength:function(d,c){this.handler&&this.handler.line&&this.handler.insertDeflectionLength(d,c)},undo:function(){return this.handler.undo&&this.handler.undo()},redo:function(){return this.handler.redo&&this.handler.redo()},finishSketch:function(){this.handler.finishGeometry()},cancel:function(){this.handler.cancel()},CLASS_NAME:"OpenLayers.Control.DrawFeature"});OpenLayers.Handler.Pinch=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!1,pinching:!1,last:null,start:null,touchstart:function(d){var c=!0;this.pinching=!1;OpenLayers.Event.isMultiTouch(d)?(this.started=!0,this.last=this.start={distance:this.getDistance(d.touches),delta:0,scale:1},this.callback("start",[d,this.start]),c=!this.stopDown):(this.started=!1,this.last=this.start=null);OpenLayers.Event.stop(d);return c},touchmove:function(d){if(this.started&&OpenLayers.Event.isMultiTouch(d)){this.pinching=!0;var c=this.getPinchData(d);this.callback("move",[d,c]);this.last=c;OpenLayers.Event.stop(d)}return !0},touchend:function(b){this.started&&(this.pinching=this.started=!1,this.callback("done",[b,this.start,this.last]),this.last=this.start=null);return !0},activate:function(){var b=!1;OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.pinching=!1,b=!0);return b},deactivate:function(){var b=!1;OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.pinching=this.started=!1,this.last=this.start=null,b=!0);return b},getDistance:function(d){var c=d[0],d=d[1];return Math.sqrt(Math.pow(c.clientX-d.clientX,2)+Math.pow(c.clientY-d.clientY,2))},getPinchData:function(b){b=this.getDistance(b.touches);return{distance:b,delta:this.last.distance-b,scale:b/this.start.distance}},CLASS_NAME:"OpenLayers.Handler.Pinch"});OpenLayers.Handler.Polygon=OpenLayers.Class(OpenLayers.Handler.Path,{holeModifier:null,drawingHole:!1,polygon:null,createFeature:function(b){b=this.layer.getLonLatFromViewPortPx(b);b=new OpenLayers.Geometry.Point(b.lon,b.lat);this.point=new OpenLayers.Feature.Vector(b);this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing([this.point.geometry]));this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([this.line.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.polygon,this.point],{silent:!0})},addPoint:function(g){if(!this.drawingHole&&this.holeModifier&&this.evt&&this.evt[this.holeModifier]){for(var f=this.point.geometry,j=this.control.layer.features,i,h=j.length-1;0<=h;--h){if(i=j[h].geometry,(i instanceof OpenLayers.Geometry.Polygon||i instanceof OpenLayers.Geometry.MultiPolygon)&&i.intersects(f)){f=j[h];this.control.layer.removeFeatures([f],{silent:!0});this.control.layer.events.registerPriority("sketchcomplete",this,this.finalizeInteriorRing);this.control.layer.events.registerPriority("sketchmodified",this,this.enforceTopology);f.geometry.addComponent(this.line.geometry);this.polygon=f;this.drawingHole=!0;break}}}OpenLayers.Handler.Path.prototype.addPoint.apply(this,arguments)},getCurrentPointIndex:function(){return this.line.geometry.components.length-2},enforceTopology:function(d){var d=d.vertex,c=this.line.geometry.components;this.polygon.geometry.intersects(d)||(c=c[c.length-3],d.x=c.x,d.y=c.y)},finishGeometry:function(){this.line.geometry.removeComponent(this.line.geometry.components[this.line.geometry.components.length-2]);this.removePoint();this.finalize()},finalizeInteriorRing:function(){var i=this.line.geometry,h=0!==i.getArea();if(h){for(var n=this.polygon.geometry.components,m=n.length-2;0<=m;--m){if(i.intersects(n[m])){h=!1;break}}if(h){m=n.length-2;i:for(;0<m;--m){for(var l=n[m].components,k=0,j=l.length;k<j;++k){if(i.containsPoint(l[k])){h=!1;break i}}}}}h?this.polygon.state!==OpenLayers.State.INSERT&&(this.polygon.state=OpenLayers.State.UPDATE):this.polygon.geometry.removeComponent(i);this.restoreFeature();return !1},cancel:function(){this.drawingHole&&(this.polygon.geometry.removeComponent(this.line.geometry),this.restoreFeature(!0));return OpenLayers.Handler.Path.prototype.cancel.apply(this,arguments)},restoreFeature:function(b){this.control.layer.events.unregister("sketchcomplete",this,this.finalizeInteriorRing);this.control.layer.events.unregister("sketchmodified",this,this.enforceTopology);this.layer.removeFeatures([this.polygon],{silent:!0});this.control.layer.addFeatures([this.polygon],{silent:!0});this.drawingHole=!1;b||this.control.layer.events.triggerEvent("sketchcomplete",{feature:this.polygon})},destroyFeature:function(b){OpenLayers.Handler.Path.prototype.destroyFeature.call(this,b);this.polygon=null},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.polygon},getGeometry:function(){var b=this.polygon&&this.polygon.geometry;b&&this.multi&&(b=new OpenLayers.Geometry.MultiPolygon([b]));return b},CLASS_NAME:"OpenLayers.Handler.Polygon"});OpenLayers.Control.Geolocate=OpenLayers.Class(OpenLayers.Control,{geolocation:navigator.geolocation,bind:!0,watch:!1,geolocationOptions:null,destroy:function(){this.deactivate();OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return !this.geolocation?(this.events.triggerEvent("locationuncapable"),!1):OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.watch?this.watchId=this.geolocation.watchPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions):this.getCurrentLocation(),!0):!1},deactivate:function(){this.active&&null!==this.watchId&&this.geolocation.clearWatch(this.watchId);return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},geolocate:function(d){var c=(new OpenLayers.LonLat(d.coords.longitude,d.coords.latitude)).transform(new OpenLayers.Projection("EPSG:4326"),this.map.getProjectionObject());this.bind&&this.map.setCenter(c);this.events.triggerEvent("locationupdated",{position:d,point:new OpenLayers.Geometry.Point(c.lon,c.lat)})},getCurrentLocation:function(){if(!this.active||this.watch){return !1}this.geolocation.getCurrentPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions);return !0},failure:function(b){this.events.triggerEvent("locationfailed",{error:b})},CLASS_NAME:"OpenLayers.Control.Geolocate"});OpenLayers.Protocol.HTTP=OpenLayers.Class(OpenLayers.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:!1,updateWithPOST:!1,deleteWithPOST:!1,wildcarded:!1,srsInBBOX:!1,initialize:function(d){d=d||{};this.params={};this.headers={};OpenLayers.Protocol.prototype.initialize.apply(this,arguments);if(!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var c=new OpenLayers.Format.QueryStringFilter({wildcarded:this.wildcarded,srsInBBOX:this.srsInBBOX});this.filterToParams=function(b,e){return c.write(b,e)}}},destroy:function(){this.headers=this.params=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(e){OpenLayers.Protocol.prototype.read.apply(this,arguments);e=e||{};e.params=OpenLayers.Util.applyDefaults(e.params,this.options.params);e=OpenLayers.Util.applyDefaults(e,this.options);e.filter&&this.filterToParams&&(e.params=this.filterToParams(e.filter,e.params));var d=void 0!==e.readWithPOST?e.readWithPOST:this.readWithPOST,f=new OpenLayers.Protocol.Response({requestType:"read"});d?(d=e.headers||{},d["Content-Type"]="application/x-www-form-urlencoded",f.priv=OpenLayers.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,f,e),data:OpenLayers.Util.getParameterString(e.params),headers:d})):f.priv=OpenLayers.Request.GET({url:e.url,callback:this.createCallback(this.handleRead,f,e),params:e.params,headers:e.headers});return f},handleRead:function(d,c){this.handleResponse(d,c)},create:function(e,d){var d=OpenLayers.Util.applyDefaults(d,this.options),f=new OpenLayers.Protocol.Response({reqFeatures:e,requestType:"create"});f.priv=OpenLayers.Request.POST({url:d.url,callback:this.createCallback(this.handleCreate,f,d),headers:d.headers,data:this.format.write(e)});return f},handleCreate:function(d,c){this.handleResponse(d,c)},update:function(f,e){var e=e||{},h=e.url||f.url||this.options.url+"/"+f.fid,e=OpenLayers.Util.applyDefaults(e,this.options),g=new OpenLayers.Protocol.Response({reqFeatures:f,requestType:"update"});g.priv=OpenLayers.Request[this.updateWithPOST?"POST":"PUT"]({url:h,callback:this.createCallback(this.handleUpdate,g,e),headers:e.headers,data:this.format.write(f)});return g},handleUpdate:function(d,c){this.handleResponse(d,c)},"delete":function(g,f){var f=f||{},j=f.url||g.url||this.options.url+"/"+g.fid,f=OpenLayers.Util.applyDefaults(f,this.options),i=new OpenLayers.Protocol.Response({reqFeatures:g,requestType:"delete"}),h=this.deleteWithPOST?"POST":"DELETE",j={url:j,callback:this.createCallback(this.handleDelete,i,f),headers:f.headers};this.deleteWithPOST&&(j.data=this.format.write(g));i.priv=OpenLayers.Request[h](j);return i},handleDelete:function(d,c){this.handleResponse(d,c)},handleResponse:function(e,d){var f=e.priv;d.callback&&(200<=f.status&&300>f.status?("delete"!=e.requestType&&(e.features=this.parseFeatures(f)),e.code=OpenLayers.Protocol.Response.SUCCESS):e.code=OpenLayers.Protocol.Response.FAILURE,d.callback.call(d.scope,e))},parseFeatures:function(d){var c=d.responseXML;if(!c||!c.documentElement){c=d.responseText}return !c||0>=c.length?null:this.format.read(c)},commit:function(D,C){function B(f){for(var d=f.features?f.features.length:0,h=Array(d),g=0;g<d;++g){h[g]=f.features[g].fid}p.insertIds=h;A.apply(this,[f])}function A(b){this.callUserCallback(b,C);q=q&&b.success();y++;y>=s&&C.callback&&(p.code=q?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE,C.callback.apply(C.scope,[p]))}var C=OpenLayers.Util.applyDefaults(C,this.options),z=[],y=0,x={};x[OpenLayers.State.INSERT]=[];x[OpenLayers.State.UPDATE]=[];x[OpenLayers.State.DELETE]=[];for(var w,v,u=[],t=0,r=D.length;t<r;++t){if(w=D[t],v=x[w.state]){v.push(w),u.push(w)}}var s=(0<x[OpenLayers.State.INSERT].length?1:0)+x[OpenLayers.State.UPDATE].length+x[OpenLayers.State.DELETE].length,q=!0,p=new OpenLayers.Protocol.Response({reqFeatures:u});w=x[OpenLayers.State.INSERT];0<w.length&&z.push(this.create(w,OpenLayers.Util.applyDefaults({callback:B,scope:this},C.create)));w=x[OpenLayers.State.UPDATE];for(t=w.length-1;0<=t;--t){z.push(this.update(w[t],OpenLayers.Util.applyDefaults({callback:A,scope:this},C.update)))}w=x[OpenLayers.State.DELETE];for(t=w.length-1;0<=t;--t){z.push(this["delete"](w[t],OpenLayers.Util.applyDefaults({callback:A,scope:this},C["delete"])))}return z},abort:function(b){b&&b.priv.abort()},callUserCallback:function(e,d){var f=d[e.requestType];f&&f.callback&&f.callback.call(f.scope,e)},CLASS_NAME:"OpenLayers.Protocol.HTTP"});OpenLayers.Control.DragPan=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:!1,interval:1,documentDrag:!1,kinetic:null,enableKinetic:!1,kineticInterval:10,draw:function(){if(this.enableKinetic){var b={interval:this.kineticInterval};"object"===typeof this.enableKinetic&&(b=OpenLayers.Util.extend(b,this.enableKinetic));this.kinetic=new OpenLayers.Kinetic(b)}this.handler=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone,down:this.panMapStart},{interval:this.interval,documentDrag:this.documentDrag})},panMapStart:function(){this.kinetic&&this.kinetic.begin()},panMap:function(b){this.kinetic&&this.kinetic.update(b);this.panned=!0;this.map.pan(this.handler.last.x-b.x,this.handler.last.y-b.y,{dragging:!0,animate:!1})},panMapDone:function(e){if(this.panned){var d=null;this.kinetic&&(d=this.kinetic.end(e));this.map.pan(this.handler.last.x-e.x,this.handler.last.y-e.y,{dragging:!!d,animate:!1});if(d){var f=this;this.kinetic.move(d,function(g,c,h){f.map.pan(g,c,{dragging:!h,animate:!1})})}this.panned=!1}},CLASS_NAME:"OpenLayers.Control.DragPan"});OpenLayers.Control.PinchZoom=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,containerCenter:null,pinchOrigin:null,currentCenter:null,autoActivate:!0,initialize:function(b){OpenLayers.Control.prototype.initialize.apply(this,arguments);this.handler=new OpenLayers.Handler.Pinch(this,{start:this.pinchStart,move:this.pinchMove,done:this.pinchDone},this.handlerOptions)},activate:function(){var b=OpenLayers.Control.prototype.activate.apply(this,arguments);b&&(this.map.events.on({moveend:this.updateContainerCenter,scope:this}),this.updateContainerCenter());return b},deactivate:function(){var b=OpenLayers.Control.prototype.deactivate.apply(this,arguments);this.map&&this.map.events&&this.map.events.un({moveend:this.updateContainerCenter,scope:this});return b},updateContainerCenter:function(){var b=this.map.layerContainerDiv;this.containerCenter={x:parseInt(b.style.left,10)+50,y:parseInt(b.style.top,10)+50}},pinchStart:function(b){this.currentCenter=this.pinchOrigin=b.xy},pinchMove:function(i,h){var n=h.scale,m=this.containerCenter,l=this.pinchOrigin,k=i.xy,j=Math.round(k.x-l.x+(n-1)*(m.x-l.x)),m=Math.round(k.y-l.y+(n-1)*(m.y-l.y));this.applyTransform("translate("+j+"px, "+m+"px) scale("+n+")");this.currentCenter=k},applyTransform:function(d){var c=this.map.layerContainerDiv.style;c["-webkit-transform"]=d;c["-moz-transform"]=d},pinchDone:function(g,f,j){this.applyTransform("");g=this.map.getZoomForResolution(this.map.getResolution()/j.scale,!0);if(g!==this.map.getZoom()||!this.currentCenter.equals(this.pinchOrigin)){var f=this.map.getResolutionForZoom(g),j=this.map.getLonLatFromPixel(this.pinchOrigin),i=this.currentCenter,h=this.map.getSize();j.lon+=f*(h.w/2-i.x);j.lat-=f*(h.h/2-i.y);this.map.div.clientWidth=this.map.div.clientWidth;this.map.setCenter(j,g)}},CLASS_NAME:"OpenLayers.Control.PinchZoom"});OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,{delay:300,single:!0,"double":!1,pixelTolerance:0,dblclickTolerance:13,stopSingle:!1,stopDouble:!1,timerId:null,touch:!1,down:null,last:null,first:null,rightclickTimerId:null,touchstart:function(b){this.touch||(this.unregisterMouseListeners(),this.touch=!0);this.down=this.getEventInfo(b);this.last=this.getEventInfo(b);return !0},touchmove:function(b){this.last=this.getEventInfo(b);return !0},touchend:function(b){this.down&&(b.xy=this.last.xy,b.lastTouches=this.last.touches,this.handleSingle(b),this.down=null);return !0},unregisterMouseListeners:function(){this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,click:this.click,dblclick:this.dblclick,scope:this})},mousedown:function(b){this.down=this.getEventInfo(b);this.last=this.getEventInfo(b);return !0},mouseup:function(d){var c=!0;this.checkModifiers(d)&&(this.control.handleRightClicks&&OpenLayers.Event.isRightClick(d))&&(c=this.rightclick(d));return c},rightclick:function(b){if(this.passesTolerance(b)){if(null!=this.rightclickTimerId){return this.clearTimer(),this.callback("dblrightclick",[b]),!this.stopDouble}b=this["double"]?OpenLayers.Util.extend({},b):this.callback("rightclick",[b]);b=OpenLayers.Function.bind(this.delayedRightCall,this,b);this.rightclickTimerId=window.setTimeout(b,this.delay)}return !this.stopSingle},delayedRightCall:function(b){this.rightclickTimerId=null;b&&this.callback("rightclick",[b])},click:function(b){this.last||(this.last=this.getEventInfo(b));this.handleSingle(b);return !this.stopSingle},dblclick:function(b){this.handleDouble(b);return !this.stopDouble},handleDouble:function(b){this.passesDblclickTolerance(b)&&(this["double"]&&this.callback("dblclick",[b]),this.clearTimer())},handleSingle:function(b){this.passesTolerance(b)&&(null!=this.timerId?(this.last.touches&&1===this.last.touches.length&&(this["double"]&&OpenLayers.Event.stop(b),this.handleDouble(b)),(!this.last.touches||2!==this.last.touches.length)&&this.clearTimer()):(this.first=this.getEventInfo(b),this.queuePotentialClick(this.single?OpenLayers.Util.extend({},b):null)))},queuePotentialClick:function(b){this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,b),this.delay)},passesTolerance:function(e){var d=!0;if(null!=this.pixelTolerance&&this.down&&this.down.xy&&(d=this.pixelTolerance>=this.down.xy.distanceTo(e.xy))&&this.touch&&this.down.touches.length===this.last.touches.length){for(var e=0,f=this.down.touches.length;e<f;++e){if(this.getTouchDistance(this.down.touches[e],this.last.touches[e])>this.pixelTolerance){d=!1;break}}}return d},getTouchDistance:function(d,c){return Math.sqrt(Math.pow(d.clientX-c.clientX,2)+Math.pow(d.clientY-c.clientY,2))},passesDblclickTolerance:function(){var b=!0;this.down&&this.first&&(b=this.down.xy.distanceTo(this.first.xy)<=this.dblclickTolerance);return b},clearTimer:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null);null!=this.rightclickTimerId&&(window.clearTimeout(this.rightclickTimerId),this.rightclickTimerId=null)},delayedCall:function(b){this.timerId=null;b&&this.callback("click",[b])},getEventInfo:function(g){var f;if(g.touches){var j=g.touches.length;f=Array(j);for(var i,h=0;h<j;h++){i=g.touches[h],f[h]={clientX:i.clientX,clientY:i.clientY}}}return{xy:g.xy,touches:f}},deactivate:function(){var b=!1;OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),this.last=this.first=this.down=null,this.touch=!1,b=!0);return b},CLASS_NAME:"OpenLayers.Handler.Click"});OpenLayers.Control.TouchNavigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,clickHandlerOptions:null,documentDrag:!1,autoActivate:!0,initialize:function(b){this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate();this.dragPan&&this.dragPan.destroy();this.dragPan=null;this.pinchZoom&&(this.pinchZoom.destroy(),delete this.pinchZoom);OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.dragPan.activate(),this.handlers.click.activate(),this.pinchZoom.activate(),!0):!1},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.dragPan.deactivate(),this.handlers.click.deactivate(),this.pinchZoom.deactivate(),!0):!1},draw:function(){var d={click:this.defaultClick,dblclick:this.defaultDblClick},c=OpenLayers.Util.extend({"double":!0,stopDouble:!0,pixelTolerance:2},this.clickHandlerOptions);this.handlers.click=new OpenLayers.Handler.Click(this,d,c);this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions));this.dragPan.draw();this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions))},defaultClick:function(b){b.lastTouches&&2==b.lastTouches.length&&this.map.zoomOut()},defaultDblClick:function(b){this.map.setCenter(this.map.getLonLatFromViewPortPx(b.xy),this.map.zoom+1)},CLASS_NAME:"OpenLayers.Control.TouchNavigation"});OpenLayers.Protocol.WFS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.0.0",CLASS_NAME:"OpenLayers.Protocol.WFS.v1_0_0"});